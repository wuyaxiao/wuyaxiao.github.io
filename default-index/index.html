<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wuyaxiao.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"posthide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="学习小屋">
<meta property="og:url" content="https://wuyaxiao.github.io/default-index/index.html">
<meta property="og:site_name" content="学习小屋">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wuyaxiao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wuyaxiao.github.io/default-index/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>学习小屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">学习小屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/" class="post-title-link" itemprop="url">把项目部署到华为云服务器上</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-14 13:33:00" itemprop="dateCreated datePublished" datetime="2025-04-14T13:33:00+08:00">2025-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-15 12:48:02" itemprop="dateModified" datetime="2025-04-15T12:48:02+08:00">2025-04-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>想要把项目部署到云服务器上，但是看了一下别人的博文总感觉写得太简略了，所以把那些博文整理了一下写了自己把项目部署到服务器上的经历。</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><ul>
<li>服务器：华为云Ubuntu24.04.1 LTS x64-based PC</li>
<li>前后端分离项目项目：<a target="_blank" rel="noopener" href="https://github.com/wuyaxiao/AiQuestion">AiQuestion</a></li>
<li>前端项目用的是webstorm软件，后端项目用的是intelij idea软件</li>
<li>完成后的效果: <a target="_blank" rel="noopener" href="http://110.41.130.6:8080/">http://110.41.130.6:8080</a></li>
<li>IP设置为了方便服务器端口设置成了允许所有IP通过，但在实际生产环节为了安全应该设置成某一个特定IP地址</li>
</ul>
<h1 id="后端部署（springboot）"><a href="#后端部署（springboot）" class="headerlink" title="后端部署（springboot）"></a>后端部署（springboot）</h1><h2 id="在服务器安装mysql"><a href="#在服务器安装mysql" class="headerlink" title="在服务器安装mysql"></a>在服务器安装mysql</h2><blockquote>
<p>参考博文：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45626288/article/details/133220238">https://blog.csdn.net/weixin_45626288/article/details/133220238</a></p>
</blockquote>
<p>完成mysql安装和相关配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y mysql-server  or  <span class="built_in">sudo</span> apt install -y mysql-server-8.0</span><br><span class="line"><span class="comment"># 启动mysql服务</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start mysql</span><br><span class="line"><span class="comment"># 设置为开机自启动</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> mysql</span><br></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status mysql</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250412203105792.png" alt="image-20250412203105792"></p>
<p>修改密码权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录mysql，在默认安装时如果没有让我们设置密码，则直接回车就能登录成功。</span></span><br><span class="line"><span class="built_in">sudo</span> mysql -uroot -p</span><br><span class="line"><span class="comment"># 设置密码 mysql8.0</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;新密码&#x27;</span>;</span><br><span class="line"><span class="comment"># 设置密码 mysql5.7</span></span><br><span class="line"><span class="built_in">set</span> password=password(<span class="string">&#x27;新密码&#x27;</span>);</span><br><span class="line"><span class="comment"># 配置IP 5.7</span></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;密码&#x27;</span>;  </span><br><span class="line"><span class="comment"># 刷新缓存</span></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p>注意：配置8.0版本参考：我这里通过这种方式没有实现所有IP都能访问；我是通过直接修改配置文件才实现的，MySQL8.0版本把配置文件 my.cnf 拆分成mysql.cnf 和mysqld.cnf，我们需要修改的是mysqld.cnf文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br></pre></td></tr></table></figure>

<p>修改配置文件，保存后重启MySQL,并允许 <code>3306</code> 端口的 TCP 连接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bind-address = 0.0.0.0</span><br><span class="line">max_connections = XXXX#设置最大连接数</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart mysql</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 3306/tcp  </span><br></pre></td></tr></table></figure>

<p>在华为云服务器中添加安全配置规则</p>
<ul>
<li><p>更多-网络&#x2F;安全组-安全组规则配置-配置规则</p>
</li>
<li><p>快速添加规则：</p>
<p>在Mysql前面打勾</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250412232051836.png" alt="image-20250412232051836"></p>
<p>源地址如下设置</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250412232128017.png" alt="image-20250412232128017"></p>
</li>
</ul>
<p>本地idea连接服务器的mysql</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250412233759065.png" alt="image-20250412233759065"></p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413003727850.png" alt="image-20250413003727850"></p>
<h2 id="在服务器安装redis"><a href="#在服务器安装redis" class="headerlink" title="在服务器安装redis"></a>在服务器安装redis</h2><p>安装redis</p>
<blockquote>
<p>因为我在安装的时候报了很多错误，感觉自己会误导别人，所以还是不写这部分了。</p>
</blockquote>
<p>访问redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p>要让 IntelliJ IDEA 连接云服务器上的 Redis，需要完成以下配置步骤：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>

<p>修改以下关键参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0  # 允许所有IP访问（或指定特定IP）</span><br><span class="line">protected-mode no  # 关闭保护模式（生产环境建议配合密码使用）</span><br><span class="line">requirepass yourpassword  # 设置密码（可选但推荐）</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>port</td>
<td>6379</td>
<td>redis的端口</td>
</tr>
<tr>
<td>bind</td>
<td>127.0.0.1</td>
<td>绑定的ip地址，默认是127.0.0.1 。如果本机有多个网卡，且限制只能通过其中一个网卡对应的IP才能访问redis时，可绑定该IP，例：bind IP</td>
</tr>
<tr>
<td>protected-mode</td>
<td>yes</td>
<td>保护模式，默认为yes，如果要其他网络能访问，改为no即可</td>
</tr>
<tr>
<td>requirepass</td>
<td>-</td>
<td>登录密码，默认是空</td>
</tr>
<tr>
<td>maxclients</td>
<td>0</td>
<td>同一时间能够连接到redis的客户端数量，默认是无限制，0表示不限制</td>
</tr>
<tr>
<td>maxmemory</td>
<td>-</td>
<td>redis能够使用的最大内存 单位byte, 默认无限制</td>
</tr>
</tbody></table>
<p>重启 Redis 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart redis-server</span><br></pre></td></tr></table></figure>

<p>开放防火墙端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开放6379端口</span></span><br><span class="line"><span class="built_in">sudo</span> ufw allow 6379/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw reload</span><br></pre></td></tr></table></figure>

<p>在华为云服务器中添加安全配置规则</p>
<ul>
<li><p>更多-网络&#x2F;安全组-安全组规则配置-配置规则</p>
</li>
<li><p>快速添加规则：</p>
<p>在Redis前面打勾</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250412232051836.png" alt="image-20250412232051836"></p>
<p>源地址如下设置</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250412232128017.png" alt="image-20250412232128017"></p>
</li>
</ul>
<p>验证远程连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从本地测试连接</span></span><br><span class="line">redis-cli -h 110.41.130.6 -p 6379 -a wu139057 ping</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413143209501.png" alt="image-20250413143209501"></p>
<p>在 IDEA 中配置 Redis 连接</p>
<ol>
<li><p>打开 <code>Database</code> 面板（右侧边栏或 <code>View</code> → <code>Tool Windows</code> → <code>Database</code>）</p>
</li>
<li><p>点击 <code>+</code> → <code>Data Source</code> → <code>Redis</code></p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413003512463.png" alt="image-20250413003512463"></p>
</li>
<li><p>填写连接信息：</p>
<ul>
<li><strong>Host</strong>: 填入公网IP地址</li>
<li><strong>Port</strong>: <code>6379</code></li>
<li><strong>Database</strong>: <code>0</code>（默认）</li>
<li><strong>Auth</strong>: 输入密码（如果设置了 <code>requirepass</code>）</li>
</ul>
<p>点击 <code>Test Connection</code>，确认显示成功。</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413143240825.png" alt="image-20250413143240825"></p>
</li>
</ol>
<h2 id="测试项目"><a href="#测试项目" class="headerlink" title="测试项目"></a>测试项目</h2><p>更改配置文件，在本地用云服务器上的mysql和redis进行测试</p>
<h2 id="服务器后台运行后端项目"><a href="#服务器后台运行后端项目" class="headerlink" title="服务器后台运行后端项目"></a>服务器后台运行后端项目</h2><p>运行<code>clean</code>,<code>package</code>两条命令生成jar文件</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250415124415277.png" alt="image-20250415124415277"></p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250415124758994.png" alt="image-20250415124758994"></p>
<p>把jar文件上传到服务器</p>
<h3 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h3><h4 id="快速启动"><a href="#快速启动" class="headerlink" title="快速启动"></a>快速启动</h4><p>创建一个名为 start.sh 的文件，内容如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清理旧的nohup.out（可选）</span></span><br><span class="line">&gt; nohup.out <span class="number">2</span>&gt;/dev/null || true</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动应用并获取PID</span></span><br><span class="line">nohup java <span class="literal">-jar</span> AiQuestion<span class="literal">-backend-0</span>.<span class="number">0.1</span><span class="literal">-SNAPSHOT</span>.jar &gt; nohup.out <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line">APP_PID=<span class="variable">$</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证启动是否成功</span></span><br><span class="line"><span class="built_in">sleep</span> <span class="number">5</span>  <span class="comment"># 等待5秒让应用初始化</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">ps</span> <span class="literal">-p</span> <span class="variable">$APP_PID</span> &gt; /dev/null; then</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;启动成功！PID: <span class="variable">$APP_PID</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;日志输出：tail -f nohup.out&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;启动失败！检查日志：&quot;</span></span><br><span class="line">  tail <span class="literal">-n</span> <span class="number">20</span> nohup.out</span><br><span class="line">  <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>再通过命令启动，命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh start.sh <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/c36dca0a250692cc171824ec2f57948a.png" alt="在这里插入图片描述"></p>
<p>可以看到项目已经启动，会把日志输出到名为 nohup.out 的文件中。</p>
<h4 id="完成服务器配置"><a href="#完成服务器配置" class="headerlink" title="完成服务器配置"></a>完成服务器配置</h4><p>开放服务器8101端口（这里应该是你的后端端口）</p>
<ul>
<li><p>服务器内防火墙允许8101端口通行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw allow 8101/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw reload</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413183019595.png" alt="image-20250413183019595"></p>
</li>
<li><p>在华为云服务器中添加安全配置规则</p>
<ul>
<li><p>更多-网络&#x2F;安全组-安全组规则配置-配置规则</p>
</li>
<li><p>添加规则：</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413183218671.png" alt="image-20250413183218671"></p>
</li>
</ul>
</li>
</ul>
<h4 id="验证是否启动成功"><a href="#验证是否启动成功" class="headerlink" title="验证是否启动成功"></a>验证是否启动成功</h4><p>在浏览器打开后端接口文档<code>http://110.41.130.6:8101/api/doc.html#/home</code></p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413183642561.png" alt="image-20250413183642561"></p>
<p>后端部署成功</p>
<h3 id="停止项目"><a href="#停止项目" class="headerlink" title="停止项目"></a>停止项目</h3><p>创建一个名为 stop.sh 的文件，内容如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps -ef | grep -v grep | grep jeecg-boot-module-system-2.4.2.jar | awk &#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 表示只输出“jeecg-boot-module-system-2.4.2.jar”的进程ID，就是PID，“awk &#x27;&#123;print $2&#125;&#x27;”表示只输出第二列，第二列就是PID所在列</span></span><br><span class="line">PID=<span class="variable">$</span>(<span class="built_in">ps</span> <span class="literal">-ef</span> | grep <span class="literal">-v</span> grep | grep AiQuestion<span class="literal">-backend-0</span>.<span class="number">0.1</span><span class="literal">-SNAPSHOT</span>.jar | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Current PID：<span class="variable">$PID</span>&quot;</span></span><br><span class="line"><span class="built_in">kill</span> <span class="literal">-9</span> <span class="variable">$PID</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Stop Success!&quot;</span></span><br></pre></td></tr></table></figure>

<p>再通过命令停止，命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh stop.sh <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413183818537.png" alt="image-20250413183818537"></p>
<p>可以看到项目已经停止。</p>
<p>再次打开接口文档进行验证</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413183852181.png" alt="image-20250413183852181"></p>
<p>成功停止项目运行</p>
<h2 id="开启HTTPS安全访问：正在努力解决中"><a href="#开启HTTPS安全访问：正在努力解决中" class="headerlink" title="开启HTTPS安全访问：正在努力解决中"></a>开启HTTPS安全访问：正在努力解决中</h2><h1 id="前端部署（vue）"><a href="#前端部署（vue）" class="headerlink" title="前端部署（vue）"></a>前端部署（vue）</h1><h2 id="连接到服务器后端"><a href="#连接到服务器后端" class="headerlink" title="连接到服务器后端"></a>连接到服务器后端</h2><h3 id="更改代码"><a href="#更改代码" class="headerlink" title="更改代码"></a>更改代码</h3><p><code>ctrl+shift+R</code>把所有localhost替换成公网ip地址</p>
<p>点击serve前的运行按钮</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413230932703.png" alt="image-20250413230932703"></p>
<p>成功连接到后端服务器</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413231756145.png" alt="image-20250413231756145"></p>
<h2 id="解决跨域问题（CORS）：正在努力解决中"><a href="#解决跨域问题（CORS）：正在努力解决中" class="headerlink" title="解决跨域问题（CORS）：正在努力解决中"></a>解决跨域问题（CORS）：正在努力解决中</h2><p>只要 协议、域名、端口号，任何一个不同,就是不同域；是否同域与路径无关。跨域请求一般会被浏览器阻止掉</p>
<p>虽然我前后端都部署在了一个云服务器上，但是为了测试方便还是决定写一下</p>
<ul>
<li><p>Nginx解决跨域问题（适用于HTTP和HTTPS）：使用Nginx通过路径转发到真是的后端，由于我并没有研究过，所以不多赘述</p>
</li>
<li><p>后端Cookie配置（使用于HTTPS）：</p>
<ul>
<li><p><code>SameSite=None</code><br>允许 Cookie 在跨站请求中发送（解决跨域场景下的 Cookie 传输问题）</p>
</li>
<li><p><code>Secure=true</code><br>确保 Cookie 仅通过 HTTPS 加密连接传输（增强安全性）。这是浏览器的强制要求</p>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8101</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">session:</span></span><br><span class="line">      <span class="attr">cookie:</span></span><br><span class="line">        <span class="comment"># 解决跨域</span></span><br><span class="line">        <span class="attr">same-site:</span> <span class="string">none</span></span><br><span class="line">        <span class="attr">secure:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250413232307680.png" alt="image-20250413232307680"></p>
<h2 id="服务器后台运行前端项目"><a href="#服务器后台运行前端项目" class="headerlink" title="服务器后台运行前端项目"></a>服务器后台运行前端项目</h2><h3 id="将项目上传到云服务器"><a href="#将项目上传到云服务器" class="headerlink" title="将项目上传到云服务器"></a>将项目上传到云服务器</h3><p>在本地进入你的项目目录，打开控制台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>运行完成后会出现一个名为dist的文件夹，这个就是你要上传给服务器的</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250414134027551.png" alt="image-20250414134027551"></p>
<p>接着将上面说的dist文件夹上传到云服务器</p>
<h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><p>如果没有nginx的话安装nginx</p>
<ul>
<li>更新包索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>

<ul>
<li>安装nginx</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>确认安装成功并检查Nginx版本</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br></pre></td></tr></table></figure>

<ul>
<li>启动Nginx服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>设置Nginx开机自启</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在浏览器中访问 http:&#x2F;&#x2F;&lt;your_server_IP&gt; 来确认Nginx安装并运行正常。</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250414142313690.png" alt="image-20250414142313690"></p>
</li>
<li><p>配置nginx</p>
<p>配置<code>/etc/nginx/nginx.conf</code>（以下是我的配置，可供参考）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include /etc/nginx/mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 8080;# 监听端口</span><br><span class="line">        server_name 110.41.130.6;# 服务器公网IP地址</span><br><span class="line">        root /root/AiQuestion/dist;# dist文件夹位置</span><br><span class="line"></span><br><span class="line">        # 前端路由回退</span><br><span class="line">        location / &#123;</span><br><span class="line">            try_files $uri /index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新加载nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart <span class="comment">#完全停止 Nginx 服务，然后再重新启动。</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl reload nginx <span class="comment">#让 Nginx 重新加载配置文件，而不中断正在运行的进程。</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="开放端口"><a href="#开放端口" class="headerlink" title="开放端口"></a>开放端口</h3><p>查看已防火墙开放端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw status verbose</span><br></pre></td></tr></table></figure>

<p>若没有开放前端项目端口则运行以下指令开放</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw allow 8080/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw reload</span><br></pre></td></tr></table></figure>

<p>在华为云服务器中添加安全配置规则</p>
<ul>
<li><p>更多-网络&#x2F;安全组-安全组规则配置-配置规则</p>
</li>
<li><p>添加规则：</p>
<p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250414145050829.png" alt="image-20250414145050829"></p>
</li>
</ul>
<h1 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h1><p><img src="/2025/04/14/%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A/image-20250414174555073.png" alt="image-20250414174555073"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/" class="post-title-link" itemprop="url">HTTP/HTTPS交互过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-07 18:34:40" itemprop="dateCreated datePublished" datetime="2025-04-07T18:34:40+08:00">2025-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-05-03 21:46:03" itemprop="dateModified" datetime="2025-05-03T21:46:03+08:00">2025-05-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">web技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>对于传输关键字段的一个生活化理解</p>
<ul>
<li><p>FIN&#x3D;1:数据传送完毕</p>
</li>
<li><p>ACK&#x3D;1:接收到你的消息</p>
</li>
<li><p>ack &#x3D; 对方上次的seq + 数据长度（Len） + 1：期望收到的下一个字节的序列号</p>
</li>
<li><p>seq &#x3D; 上一个发送包的seq + 上一个包的数据长度（Len） + 控制标志占用：当前数据包的第一个字节的序列号</p>
<p><code>SYN</code>、<code>FIN</code>各占用<strong>1个虚拟序号</strong>（即使<code>Len=0</code>）。</p>
</li>
</ul>
<h2 id="http交互过程"><a href="#http交互过程" class="headerlink" title="http交互过程"></a>http交互过程</h2><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221720457.png" alt="image-20250406221720457"></p>
<p>用wireshark抓包后利用百度ip地址过滤数据包ipv6.src &#x3D;&#x3D; 240e:ff:e020:966:0:ff:b042:f296 || ipv6.dst &#x3D;&#x3D; 240e:ff:e020:966:0:ff:b042:f296</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221743565.png" alt="image-20250406221743565"></p>
<h3 id="“三次握手”建立TCP连接"><a href="#“三次握手”建立TCP连接" class="headerlink" title="“三次握手”建立TCP连接"></a>“三次握手”建立TCP连接</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250407220856284.png" alt="image-20250407220856284"></p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221755801.png" alt="image-20250406221755801"></p>
<h3 id="数据传输阶段"><a href="#数据传输阶段" class="headerlink" title="数据传输阶段"></a>数据传输阶段</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250407222015156.png" alt="image-20250407222015156"></p>
<h4 id="客户端发送HTTP请求"><a href="#客户端发送HTTP请求" class="headerlink" title="客户端发送HTTP请求"></a>客户端发送HTTP请求</h4><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221808248.png" alt="image-20250406221808248"></p>
<p>客户端向服务器发送HTTP请求消息。请求消息通常包括以下部分：</p>
<ul>
<li>请求行：包含请求方法（如GET、POST）、请求的资源路径、HTTP版本。<ul>
<li>Request Method：请求方法，这里的请求方法是GET；</li>
<li>Request URI：请求的URI，没指定默认是&#x2F;，因为我们只请求了域名<a target="_blank" rel="noopener" href="http://www.baidu.com,并没指定要获取的资源,所以是默认的/%EF%BC%9B">www.baidu.com，并没指定要获取的资源，所以是默认的/；</a></li>
<li>Request Version：请求的版本，因为用的是HTTP协议，所以这里显示HTTP协议的版本。</li>
</ul>
</li>
<li>请求头：包含客户端信息、请求参数等，例如User-Agent、Accept、Cookie等。<ul>
<li><p>Host：目标主机；</p>
</li>
<li><p>User-Agent：用户代理，也就是浏览器的类型。由于我们没用浏览器，所以这里显示的是命令curl，版本为8.4.0；</p>
</li>
<li><p>Accept：浏览器可接受的MIME（Multipurpose Internet Mail Extensions）类型。</p>
</li>
</ul>
</li>
<li>请求体：对于某些请求方法（如POST），可能包含额外的数据，用于向服务器发送信息。</li>
</ul>
<h4 id="服务器发送HTTP响应"><a href="#服务器发送HTTP响应" class="headerlink" title="服务器发送HTTP响应"></a>服务器发送HTTP响应</h4><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221827193.png" alt="image-20250406221827193"></p>
<p>服务器接收到请求后，会检查请求头和请求体，然后根据请求方法（如GET、POST）和资源路径来决定如何响应。服务器生成的响应消息，包括状态行、响应体。</p>
<p>当打开响应体会发现它的内容是明文的，对于机密通信来说HTTP通信很容易产生信息泄露。另外，以上介绍的整个交互过程中并不验证通信方的身份，第三方可以冒充他人身份参与通信。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221839504.png" alt="image-20250406221839504"></p>
<h4 id="HTTP-响应结构"><a href="#HTTP-响应结构" class="headerlink" title="HTTP 响应结构"></a>HTTP 响应结构</h4><p>这个内容是一个标准的HTTP响应示例，使用的是HTTP&#x2F;1.1协议。响应的结构主要分为几个部分：</p>
<ol>
<li><p><strong>状态行</strong>： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Response Version</strong>: 表示使用的HTTP协议版本（HTTP&#x2F;1.1）。</li>
<li><strong>Status Code</strong>: 200，表示请求成功。</li>
<li><strong>Status Code Description</strong>: “OK”是对状态代码的描述，表示没有错误。</li>
</ul>
</li>
<li><p><strong>响应头部</strong>：<br>接下来是一系列以<code>字段名: 字段值</code>方式排列的响应头部信息，其中包括：</p>
<ul>
<li><strong>Connection</strong>: <code>keep-alive</code>指示连接是否保持活动状态，允许在一个TCP连接上处理多个请求。</li>
<li><strong>Content-Length</strong>: <code>413830</code>表示响应主体的长度（字节数）。</li>
<li><strong>Content-Type</strong>: <code>text/html; charset=utf-8</code>表明返回内容的类型为HTML，并使用UTF-8字符集编码。</li>
<li><strong>Date</strong>: 指示服务器发送响应的日期和时间（GMT）。</li>
<li><strong>Server</strong>: <code>BWS/1.1</code>表示服务器使用的Web服务器软件名称和版本。</li>
<li><strong>Set-Cookie</strong>: 多个<code>Set-Cookie</code>字段设置会话 cookie，以便客户端可以在后续请求中识别用户。这些设置包括：<ul>
<li><strong>BIDUPSID</strong>: 用于标识用户的会话 ID。</li>
<li><strong>PSTM</strong>: 时间戳。</li>
<li><strong>H_PS_PSSID</strong>: 字段用于会话跟踪。</li>
<li><strong>BAIDUID</strong>: 用户ID，通常用于个性化和跟踪。</li>
</ul>
</li>
<li><strong>Traceid</strong>: <code>1727528586052408013810636502756405498072</code>是用于跟踪请求的唯一标识符。</li>
<li><strong>Vary</strong>: <code>Accept-Encoding</code>表示响应可能会根据请求头中的<code>Accept-Encoding</code>进行变化。</li>
<li><strong>X-Ua-Compatible</strong>: 浏览器兼容性设置，指定最优渲染引擎。</li>
<li><strong>X-Xss-Protection</strong>: <code>1;mode=block</code>用于防止跨站脚本攻击（XSS）。</li>
</ul>
</li>
<li><p><strong>响应主体</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Response: True&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="“四次挥手”断开TCP连接"><a href="#“四次挥手”断开TCP连接" class="headerlink" title="“四次挥手”断开TCP连接"></a>“四次挥手”断开TCP连接</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250407220936520.png" alt="image-20250407220936520"></p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221855258.png" alt="image-20250406221855258"></p>
<p>请求完成后，客户端和服务器可以关闭连接。通常情况下，HTTP 1.0使用的是短连接，请求完成后关闭连接。HTTP 1.1默认使用长连接，多个请求可以复用同一个连接，直到连接超时或被关闭。</p>
<h2 id="https交互过程"><a href="#https交互过程" class="headerlink" title="https交互过程"></a>https交互过程</h2><p>HTTP协议有三大缺点：</p>
<ul>
<li><strong>机密性问题</strong>：通信使用了明文，第三方可以拦截并获悉通信内容；</li>
<li><strong>完整性问题</strong>：未验证报文的完整性，第三方可以篡改通信内容；</li>
<li><strong>认证问题</strong>：未验证对方的身份，第三方可以冒充他人身份参与通信。</li>
</ul>
<p>为了解决以上三个问题，便诞生了HTTPS。</p>
<p>HTTPS 被称为 HTTP Over SSL (基于SSL加密的HTTP)，这里的SSL (Secure Socket Layer) 被称为安全套接层，它是一种加密协议，不仅可应用于HTTP协议、还可应用于POP3协议、SMTP协议、VPN等。</p>
<p>TLS (Transport Layer Security) 被称为传输层安全，TLS相对于SSL 3.0版本做了些修改和功能增强，相当于SSL的升级版本，所以有时也一起统称为 SSL，接入来本文若不明显强调，SSL就默认表示SSL&#x2F;TLS。</p>
<p>我们可以用公式HTTPS &#x3D; HTTP + SSL &#x2F; TLS来表示HTTPS。<br><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221911301.png" alt="image-20250406221911301"></p>
<h3 id="阶段一：TCP三次握手建立连接"><a href="#阶段一：TCP三次握手建立连接" class="headerlink" title="阶段一：TCP三次握手建立连接"></a>阶段一：TCP三次握手建立连接</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250407220911416.png" alt="image-20250407220911416"></p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221942057.png" alt="image-20250406221942057"></p>
<h3 id="阶段二：TLS握手建立安全通道"><a href="#阶段二：TLS握手建立安全通道" class="headerlink" title="阶段二：TLS握手建立安全通道"></a>阶段二：TLS握手建立安全通道</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406221951935.png" alt="image-20250406221951935"></p>
<p>第一次握手报文：我-&gt;百度 发送TLS消息「Client Hello」（22）；<br>第二次握手报文：</p>
<p>百度-&gt;我 发送TLS消息「Server Hello」（65）；<br>百度-&gt;我 发送TLS消息「Certificate」，「Server Key Exchange」，「Server Hello Done」（86）</p>
<p>第三次握手报文：我-&gt;百度 发送TLS消息「Client Key Exchange」，「Change Cipher Spec」，「Encrypted Handshake Message」（88）<br>第四次握手报文（85）：百度-&gt;我 发送TLS消息「Change Cipher Spec」，「Encrypted Handshake Message」（98）<br>为了直观展示TLS报文交互，基于抓包分析的数据包可以绘制得到下图。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222010322.png" alt="image-20250406222010322"></p>
<h4 id="TLS第一次握手：client-server-Client-Hello"><a href="#TLS第一次握手：client-server-Client-Hello" class="headerlink" title="TLS第一次握手：client -&gt; server (Client Hello)"></a>TLS第一次握手：client -&gt; server (Client Hello)</h4><p>客户端向服务端发送：</p>
<ol>
<li>客户端支持的协议；</li>
<li>已经使用的TLS版本；</li>
<li>随机数Random；</li>
<li>支持的密码套件。</li>
</ol>
<p>从下图中，我们也可以看出SSL层是基于TCP层又进行封装的一层协议。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222026174.png" alt="image-20250406222026174"></p>
<p>接下来我们看几个TLS协议中的重要字段（Version、Random、SessionID和Cipher Suites）。</p>
<ul>
<li>version</li>
</ul>
<p>从上图中可以看到当前通信安全层协议版本（Version）为TLS 1.2。其实TLS共总有4个版本，最新为TLS 1.3，具体如下：</p>
<p>TLS 1.3：发布于2018年，TLS 1.3是TLS协议的最新版本，大幅简化了握手过程，提高了性能和安全性。它删除了一些不安全的加密算法，并引入了0-RTT（零往返时间）握手，以减少延迟。<br>TLS 1.2：TLS 1.2发布于2008年，它引入了更强的加密算法和更灵活的密码套件选择，修复了许多安全漏洞，是目前广泛使用的版本。（当前样例中百度网站使用的就是TLS 1.2协议）<br>TLS 1.1：TLS 1.1发布于2006年，引入了一些改进，包括对CBC（Cipher Block Chaining）模式的安全性改进，但仍然存在一些已知的安全问题。<br>TLS 1.0：TLS 1.0于1999年发布，是SSL 3.0的升级版本，修复了一些安全漏洞，但仍然存在一些安全问题。</p>
<ul>
<li>Random</li>
</ul>
<p>Random用于密钥的制作。这里我们将第一次握手中客户端发送给服务端的随机数记为Client Random，记住这个随机数，后面还会用到。</p>
<ul>
<li>SessionID</li>
</ul>
<p>SessionID用来表示客户端是否想复用先前存在的session。如果不复用，则此字段为0；如果想要复用，则此字段为想要复用的sessionID。是否复用由服务端确定。</p>
<ul>
<li>Cipher Suites</li>
</ul>
<p>密码套件列表会全部发给服务端，服务端从中挑选一个最安全的密码套件返回客户端。</p>
<p>将Cipher Suites字段展开，如下图。代表客户端支持的密码套件列表。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222044546.png" alt="image-20250406222044546"></p>
<p>密码套件的格式通常由一系列的加密算法和相关参数组成。一般来说，它的格式包含以下几个部分：</p>
<p>密钥交换算法：用于协商会话密钥，例如 Diffie-Hellman（DHE）、ECDHE等。<br>身份验证算法：也称签名算法用于验证对端身份，例如RSA。<br>加密算法：用于实际数据传输的加解密，例如 AES（Advanced Encryption Standard）、RC4 等。<br>数据摘要算法：用于计算哈希，主要是用于验证数据的完整性，防止信息被篡改。</p>
<p>格式：「密钥交换算法 + 签名算法（认证算法） + 对称加密算法 + 摘要算法」。其中密钥交换算法和签名算法可以相同，此时就会合二为一。</p>
<p>比如上面密码套件列表中的第9个TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384。<br><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222056722.png" alt="image-20250406222056722"></p>
<p>在这个例子中：</p>
<p>ECDHE表示密钥交换算法是基于椭圆曲线的 Diffie-Hellman（ECDHE）。<br>RSA表示使用RSA算法（私钥加密、公钥解密）验证对方身份。<br>AES_256_GCM表示使用 256 位的 AES 加密算法和 GCM 模式。<br>SHA384表示使用 SHA-384 作为消息摘要算法。</p>
<p>不同的密码套件组合提供了不同的安全性和性能特点，服务器和客户端在进行 TLS 握手时会协商选择双方都支持的 Cipher Suite 来建立安全连接。</p>
<p>客户端发送完「Client Hello」（第22个报文），第62个报文则是服务端向客户端发送的ACK确认消息，代表上面的「Client Hello」已经收到。这里也可以看出服务端是通过普通的TCP 的ACK消息去应答「Client Hello」。<br><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222111873.png" alt="image-20250406222111873"></p>
<h4 id="TLS第二次握手：server-client-1-Server-Hello-2-Certificate-Server-key-Exchange-Server-Hello-Done"><a href="#TLS第二次握手：server-client-1-Server-Hello-2-Certificate-Server-key-Exchange-Server-Hello-Done" class="headerlink" title="TLS第二次握手：server -&gt; client (1.Server Hello; 2.Certificate,Server key Exchange,Server Hello Done)"></a>TLS第二次握手：server -&gt; client (1.Server Hello; 2.Certificate,Server key Exchange,Server Hello Done)</h4><p>这一次握手时，server向client连续发送了两个报文：</p>
<p>Server Hello：服务端为了证明自己的身份，会发送「Server Certificate」给客户端，这个消息里含有数字证书；<br>Certificate,Server key Exchange,Server Hello Done：目的是告诉客户端，我已经把该给你的东西都给你了，本次打招呼完毕。</p>
<h5 id="服务端发送报文：Server-Hello"><a href="#服务端发送报文：Server-Hello" class="headerlink" title="服务端发送报文：Server Hello"></a>服务端发送报文：Server Hello</h5><p>服务端向客户端发送：</p>
<ol>
<li>服务端支持的协议；</li>
<li>使用的TLS版本；</li>
<li>随机数Random；</li>
<li>服务端选用的密码套件。</li>
</ol>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222126505.png" alt="image-20250406222126505"></p>
<p>上图中可以看到，服务端也生成了一个随机数，并发送给了客户端，服务端生成的随机数记为<code>Server Random</code>。</p>
<p>客户端和服务端就已确认了 TLS 版本和使用的密码套件<code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 </code>。</p>
<h5 id="服务端发送报文：Certificate-Server-key-Exchange-Server-Hello-Done"><a href="#服务端发送报文：Certificate-Server-key-Exchange-Server-Hello-Done" class="headerlink" title="服务端发送报文：Certificate,Server key Exchange,Server Hello Done"></a>服务端发送报文：Certificate,Server key Exchange,Server Hello Done</h5><p>这里服务端在一个数据包中发送了三个TLS消息：</p>
<ul>
<li>Certificate</li>
<li>Server key Exchange</li>
<li>Server Hello Done</li>
</ul>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222141946.png" alt="image-20250406222141946"></p>
<h6 id="certificate"><a href="#certificate" class="headerlink" title="certificate"></a>certificate</h6><p>可以看到当前数据包中包含了三个数字证书，三个证书实际构成了一个完整的证书链。</p>
<p>最下面的为根证书，最上面的为网站证书。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222153092.png" alt="image-20250406222153092"></p>
<h6 id="Server-Key-Exchange"><a href="#Server-Key-Exchange" class="headerlink" title="Server Key Exchange"></a>Server Key Exchange</h6><p>之前由于服务端选用ECDHE进行密钥协商，所以可以看到「Sever Key Exchange」消息中主要包括密钥交换算法EC Diffie-Hellman（简称ECDHE）以及携带的额外数据（Server Params）。Server Params参数包含：Curve Type、Named Curve以及Pubkey，分别代表曲线类型、曲线名称以及椭圆曲线公钥（用于实现密钥交换算法）。为了防止公钥被篡改，这里服务端使用RSA私钥对椭圆曲线公钥进行签名并发送给客户端。<br><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222204616.png" alt="image-20250406222204616"></p>
<p>实质上这个过程服务器做了三件事情：</p>
<ol>
<li>选择了名为 named_curve 的椭圆曲线，选好了椭圆曲线相当于椭圆曲线基点 G 也定好了，这些都会公开给客户端；</li>
<li>生成随机数会作为服务端椭圆曲线的私钥，保留到本地；</li>
<li>根据基点 G 和私钥计算出服务端的椭圆曲线公钥，这个会公开给客户端。</li>
</ol>
<h6 id="Server-Hello-Done"><a href="#Server-Hello-Done" class="headerlink" title="Server Hello Done"></a>Server Hello Done</h6><p>表明Server Hello消息结束，这个消息中没有额外的其他字段。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222217832.png" alt="image-20250406222217832"></p>
<h4 id="TLS第三次握手client-server-Client-Key-Exchange-Change-Cipher-Spec-Encrypted-Handshake-Message"><a href="#TLS第三次握手client-server-Client-Key-Exchange-Change-Cipher-Spec-Encrypted-Handshake-Message" class="headerlink" title="TLS第三次握手client -&gt; server (Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message)"></a>TLS第三次握手client -&gt; server (Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message)</h4><p>该报文中，也是将TLS的三个消息合并到一个中发送。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222228493.png" alt="image-20250406222228493"></p>
<h5 id="Client-Key-Exchange"><a href="#Client-Key-Exchange" class="headerlink" title="Client Key Exchange"></a>Client Key Exchange</h5><p>客户端收到了服务端的证书及「Server Hello Done」消息后，会先校验证书，校验通过后会将Client Params数据传递给服务端，其中包含自身生成的椭圆曲线公钥（Pubkey），数据内容如图所示：</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222316867.png" alt="image-20250406222316867"></p>
<p>客户端会生成一个随机数作为客户端椭圆曲线的私钥，然后再根据服务端前面给的信息，生成客户端的椭圆曲线公钥，然后用「Client Key Exchange」消息发给服务端。</p>
<p>至此，双方都有对方的椭圆曲线公钥、自己的椭圆曲线私钥、椭圆曲线基点 G。于是，双方都可计算椭圆曲线的交点（x，y）。</p>
<p>最终的会话密钥，就是用「客户端随机数 + 服务端随机数 + x（ECDHE 算法算出的共享密钥） 」三者结合生成的。</p>
<h5 id="Change-Cipher-Spec"><a href="#Change-Cipher-Spec" class="headerlink" title="Change Cipher Spec"></a>Change Cipher Spec</h5><p>「Change Cipher Spec」消息表示客户端已经生成密钥，并切换到对称加密模式。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222328763.png" alt="image-20250406222328763"></p>
<h5 id="Encrypted-Handshake-Message"><a href="#Encrypted-Handshake-Message" class="headerlink" title="Encrypted Handshake Message"></a>Encrypted Handshake Message</h5><p>发送这个消息有两个目的：</p>
<p>告诉服务端，客户端在握手的过程中收到和发送的数据做一个摘要并用会话密钥加密发送给服务端做校验，保证TSL握手过程中报文没有被修改过；</p>
<p>如果服务端收到这个消息并能解密成功，就能说明对称密钥是正确的。</p>
<p>「Encrypted Handshake Message」消息其实不只是客户端会发送，之后服务端也会发送一个。</p>
<h4 id="TLS-第四次握手server-client-Change-Cipher-Spec-Encrypted-Handshake-Message"><a href="#TLS-第四次握手server-client-Change-Cipher-Spec-Encrypted-Handshake-Message" class="headerlink" title="TLS 第四次握手server -&gt; client (Change Cipher Spec,Encrypted Handshake Message)"></a>TLS 第四次握手server -&gt; client (Change Cipher Spec,Encrypted Handshake Message)</h4><p>服务器也是同样的操作，发送「Change Cipher Spec」和「Encrypted Handshake Message」消息，如果双方都验证加密和解密没问题，那么TLS握手正式完成。</p>
<p>最后，就用会话密钥加解密 HTTPS 请求和响应了，即开启了阶段三的加密通信。</p>
<h3 id="阶段三：加密通信"><a href="#阶段三：加密通信" class="headerlink" title="阶段三：加密通信"></a>阶段三：加密通信</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250407222109385.png" alt="image-20250407222109385"></p>
<p>TLS握手完成后，客户端与服务端的所有通信内容均被加密，如果没有会话密钥则无法解密通信内容。</p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222340929.png" alt="image-20250406222340929"></p>
<h3 id="阶段四：TCP四次挥手断开连接"><a href="#阶段四：TCP四次挥手断开连接" class="headerlink" title="阶段四：TCP四次挥手断开连接"></a>阶段四：TCP四次挥手断开连接</h3><p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250407220936520.png" alt="image-20250407220936520"></p>
<p><img src="/2025/04/07/HTTP-HTTPS%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B-0/image-20250406222350469.png" alt="image-20250406222350469"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/07/%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E5%8D%9A%E6%96%87%E6%88%96%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/07/%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E5%8D%9A%E6%96%87%E6%88%96%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">实用小玩意儿集锦</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-07 12:41:52" itemprop="dateCreated datePublished" datetime="2025-04-07T12:41:52+08:00">2025-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-14 22:21:33" itemprop="dateModified" datetime="2025-04-14T22:21:33+08:00">2025-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>写一些我觉得很有用的博文和项目等等，不定期更新。</p>
<p>Note:由于我使用的是windows系统所以一些博文和项目中的内容可能不适用于其它操作系统。</p>
<h2 id="优质博文"><a href="#优质博文" class="headerlink" title="优质博文"></a>优质博文</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://xiaofucode.com/guide/interview/tools/%E6%89%8B%E6%8A%8A%E6%89%8B%EF%BC%8C%E6%95%99%E4%BD%A0%E5%85%8D%E8%B4%B9%E6%90%AD%E4%B8%80%E4%B8%AA%E9%AB%98%E9%80%BC%E6%A0%BC%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2.html">如何搭建个人博客网站</a></p>
<blockquote>
<p>搭建完成后如果使用的是<a target="_blank" rel="noopener" href="https://github.com/next-theme/hexo-theme-next">Next主题</a>关于配置可以参考我的博文<a href="https://wuyaxiao.github.io/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/">hexo的使用方法(在Next主题下)</a></p>
</blockquote>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Zhudi1145/article/details/140519215?ops_request_misc=%257B%2522request%255Fid%2522%253A%252262bd8fa17d9ae93175167c34a513891a%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=62bd8fa17d9ae93175167c34a513891a&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-13-140519215-null-null.142">Alist安装教程</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://support.huaweicloud.com/bestpractice-ecs/zh-cn_topic_0000001956778641.html">快速搭建FTP站点</a></p>
</li>
</ul>
<h2 id="优质项目"><a href="#优质项目" class="headerlink" title="优质项目"></a>优质项目</h2><ul>
<li><p>我的终端配置</p>
<ul>
<li><p>实现好看、好用的终端：因为我是windows系统所以我用的是<a target="_blank" rel="noopener" href="https://github.com/nushell/nushell">nushell</a>，<a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh">Oh My Zsh</a>需要借助WSL2，看起来比较麻烦，不过也是可以的，linux系统还是推荐Oh My Zsh。</p>
<p>windows系统安装好后如果想要设置为默认终端或者想在windows终端上添加nushell可以参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/terminal/install">微软官方文档</a></p>
</li>
<li><p>如何在终端实现翻译功能：<a target="_blank" rel="noopener" href="https://github.com/Karmenzind/kd">kd</a></p>
<p>Go语言实现的简洁好用的命令行词典，跨平台、易于安装、持续维护更新</p>
</li>
<li><p>如何在终端和chatgpt等大模型交流：<a target="_blank" rel="noopener" href="https://github.com/Aider-AI/aider">aider</a></p>
<p>安装，配置以及使用可依据<a target="_blank" rel="noopener" href="https://aider.chat/docs/llms.html">官网文档</a></p>
</li>
<li><p>在终端进行待办事项管理：<a target="_blank" rel="noopener" href="https://github.com/klaudiosinani/taskbook">Taskbook</a></p>
<p><img src="/2025/04/07/%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E5%8D%9A%E6%96%87%E6%88%96%E9%A1%B9%E7%9B%AE/header-boards.png" alt="Boards"></p>
</li>
</ul>
</li>
<li><p>把各大网盘聚合起来的网盘挂载工具：<a target="_blank" rel="noopener" href="https://github.com/AlistGo/alist">Alist</a></p>
<p>关于如何安装可以参考优质博文中的Alist安装教程。</p>
</li>
<li><p>科学上网：直接在github上搜就可以了，我有一个比较好用而且非常便宜的订阅节点，是<a target="_blank" rel="noopener" href="https://dash.fscloud.cc/">FSCLoud</a></p>
</li>
<li><p>如果你是CSU的学生并且在选课的时候总是手慢并为此苦恼的话，推荐一个本校学生开发的选课脚本：<a target="_blank" rel="noopener" href="https://github.com/Rui-li023/CSUAutoSelect">CSUAutoSelect</a></p>
</li>
<li><p>动漫资源(非常全而且免费)：<a target="_blank" rel="noopener" href="https://github.com/Predidit/Kazumi">Kazumi</a></p>
</li>
</ul>
<h2 id="优质软件及其破解"><a href="#优质软件及其破解" class="headerlink" title="优质软件及其破解"></a>优质软件及其破解</h2><ul>
<li><p>Jebrains全家桶(对我来讲professional版本最好的地方就是增加了数据库工具，测试的时候非常方便)：淘宝上有一个一键破解软件，一块钱，可以试试。</p>
<blockquote>
<p>【淘宝】99%买家好评 <a target="_blank" rel="noopener" href="https://e.tb.cn/h.65FGg8hXyNyve4G?tk=7ZwNeBo7HSx">https://e.tb.cn/h.65FGg8hXyNyve4G?tk=7ZwNeBo7HSx</a> MF168 「pycharm2025永久激活码2099年 jetbrains全家桶激活 idea  cloin」<br>点击链接直接打开 或者 淘宝搜索直接打开</p>
</blockquote>
<p><img src="/2025/04/07/%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84%E5%8D%9A%E6%96%87%E6%88%96%E9%A1%B9%E7%9B%AE/image-20250407133855263.png" alt="image-20250407133855263"></p>
</li>
<li><p>markdown：<a target="_blank" rel="noopener" href="https://github.com/markyin0707/typora-activation">typora-activation</a>，亲测有效。</p>
</li>
<li><p>KeePass Password Safe：本地存储密码</p>
</li>
</ul>
<h2 id="优质网站"><a href="#优质网站" class="headerlink" title="优质网站"></a>优质网站</h2><p>一些耳熟能详的网站比如菜鸟驿站、bilibili、stackoverflow，我觉得大家应该都知道所以就不收录了。</p>
<ul>
<li>知识星球：可以在上面找实战项目。</li>
<li><a target="_blank" rel="noopener" href="https://mox.moe/">漫画资源网站</a>，资源很全，完全免费</li>
</ul>
<h2 id="待使用的项目"><a href="#待使用的项目" class="headerlink" title="待使用的项目"></a>待使用的项目</h2><p>放一些我没使用过但是很感兴趣以及将来会使用的项目,大多数都是从<a target="_blank" rel="noopener" href="https://github.com/521xueweihan/HelloGitHub">HelloGitHub</a>上找到的，我觉得这个项目还是蛮有意思的。</p>
<ul>
<li>一款结构化的 Markdown 引擎，支持 Go 和 JavaScript：<a target="_blank" rel="noopener" href="https://github.com/88250/lute">Lute</a></li>
<li>电脑分屏工具,你可以在主显示屏)写代码，左边显示器看文档、查资料，并通过窗口固定在屏幕的左右两侧。：<a target="_blank" rel="noopener" href="https://github.com/jigish/slate">Slate</a></li>
</ul>
<h2 id="关于浏览器"><a href="#关于浏览器" class="headerlink" title="关于浏览器"></a>关于浏览器</h2><p>推荐<a target="_blank" rel="noopener" href="https://www.google.com/intl/zh-CN/chrome/">Google Chrome</a>，因为有一次我在firefox上拿某一网站cookie值用来配置，结果一直显示出错，后来用Google Chrome立马就成功了。</p>
<p>关于切换默认浏览器可以参考<a target="_blank" rel="noopener" href="https://support.microsoft.com/zh-cn/windows/%E5%9C%A8-windows-%E4%B8%AD%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E5%BA%94%E7%94%A8-e5d82cad-17d1-c53b-3505-f10a32e1894d">微软官方文档</a></p>
<h2 id="免费的AI工具"><a href="#免费的AI工具" class="headerlink" title="免费的AI工具"></a>免费的AI工具</h2><ul>
<li>deepseek：网站免费，API付费。</li>
<li>codegeex：codegeex免费，codegeex还提供免费的API，还是不错的。</li>
<li>免费API获取：如果要获取免费API的话比较推荐<a target="_blank" rel="noopener" href="https://aistudio.google.com/app/apikey">Get API key | Google AI Studio</a>。还可以使用github项目<a target="_blank" rel="noopener" href="https://github.com/chatanywhere/GPT_API_free">GPT_API_Free</a>，但是效果没有Google AI Studio的好,主要是一些上传文件之类的功能受限。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">PE文件格式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-07 00:30:24 / 修改时间：00:35:39" itemprop="dateCreated datePublished" datetime="2025-04-07T00:30:24+08:00">2025-04-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">软件安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="PE文件格式"><a href="#PE文件格式" class="headerlink" title="PE文件格式"></a>PE文件格式</h2><img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103174529532.png" alt="image-20250103174529532" style="zoom:50%;">

<h4 id="DOS头"><a href="#DOS头" class="headerlink" title="DOS头"></a>DOS头</h4><img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103181902992.png" alt="image-20250103181902992" style="zoom:50%;">

<h5 id="MZ文件头：IMAGE-DOS-HEADER-结构体"><a href="#MZ文件头：IMAGE-DOS-HEADER-结构体" class="headerlink" title="MZ文件头：IMAGE_DOS_HEADER 结构体"></a>MZ文件头：IMAGE_DOS_HEADER 结构体</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//注释掉的不需要重点分析</span><br><span class="line">struct _IMAGE_DOS_HEADER&#123;</span><br><span class="line">  0X00 WORD e_magic;      //※Magic DOS signature MZ(4Dh 5Ah):MZ标记:用于标记是否是可执行文件;用于判断PE文件的标识。如果不是MZ即不是十六进制值：0x5A4D。计算机存储顺序是低位在前高位在后，所以存储为：0x4D5A。  </span><br><span class="line">  //0X02 WORD e_cblp;     //Bytes on last page of file</span><br><span class="line">  //0X04 WORD e_cp;       //Pages in file</span><br><span class="line">  //0X06 WORD e_crlc;     //Relocations</span><br><span class="line">  //0X08 WORD e_cparhdr;  //Size of header in paragraphs</span><br><span class="line">  //0X0A WORD e_minalloc; //Minimun extra paragraphs needs</span><br><span class="line">  //0X0C WORD e_maxalloc; //Maximun extra paragraphs needs</span><br><span class="line">  //0X0E WORD e_ss;       //intial(relative)SS value</span><br><span class="line">  //0X10 WORD e_sp;       //intial SP value</span><br><span class="line">  //0X12 WORD e_csum;     //Checksum</span><br><span class="line">  //0X14 WORD e_ip;       //intial IP value</span><br><span class="line">  //0X16 WORD e_cs;       //intial(relative)CS value</span><br><span class="line">  //0X18 WORD e_lfarlc;   //File Address of relocation table</span><br><span class="line">  //0X1A WORD e_ovno;     //Overlay number</span><br><span class="line">  //0x1C WORD e_res[4];   //Reserved words</span><br><span class="line">  //0x24 WORD e_oemid;    //OEM identifier(for e_oeminfo)</span><br><span class="line">  //0x26 WORD e_oeminfo;  //OEM information;e_oemid specific</span><br><span class="line">  //0x28 WORD e_res2[10]; //Reserved words</span><br><span class="line">  0x3C DWORD e_lfanew;    //※Offset to start of PE header:定位PE文件，PE头相对于文件的偏移量</span><br><span class="line">&#125;;</span><br><span class="line">//一个word是对应2个字节，该结构体大小为64个字节，因为里面定义了两个word型数组。  </span><br></pre></td></tr></table></figure>

<h5 id="Dos-Stub-汇编代码"><a href="#Dos-Stub-汇编代码" class="headerlink" title="Dos Stub:汇编代码"></a>Dos Stub:汇编代码</h5><p>其功能是当该EXE运行在16位环境下，输出一段文字：“This program cannot be run in DOS mode”，然后并退出该进程。  </p>
<h4 id="PE头-IMAGE-NT-HEADERS"><a href="#PE头-IMAGE-NT-HEADERS" class="headerlink" title="PE头:IMAGE_NT_HEADERS"></a>PE头:IMAGE_NT_HEADERS</h4><p><code>PNTHeader = ImageBase + dosHeader-&gt;e_lfanew</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef struct IMAGE_NT_HEADERS&#123;  </span><br><span class="line">  DWORD Signature;  </span><br><span class="line">  IMAGE_FILE_HEADER FileHeader;  </span><br><span class="line">  IMAGE_OPTIONAL_HEADER32 OptionalHeader;  </span><br><span class="line">&#125;IMAGE_NT_HEADERS,*PIMAGE_NT_HEADERS;   </span><br></pre></td></tr></table></figure>

<h5 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h5><p>将文件标识为 PE 映像的 4 字节签名。字节为“PE\0\0”。</p>
<h5 id="IMAGE-FILE-HEADER"><a href="#IMAGE-FILE-HEADER" class="headerlink" title="IMAGE_FILE_HEADER"></a>IMAGE_FILE_HEADER</h5><p>IMAGE_FILE_HEADER（映像头文件）结构包含了文件的物理层信息及文件属性。共20字节的数据，其结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_FILE_HEADER &#123;  </span><br><span class="line">WORD    Machine;                    //运行平台</span><br><span class="line">常见【机器：标识】：Intel I386 14ch、MIPS R3000 162h、Alpha AXP 184h、Power PC 1F0h、MIPS R4000 184h  </span><br><span class="line">比如这里的014c，就是在Intel I386机器上运行。  </span><br><span class="line">WORD    NumberOfSections;           //文件的区块数目  </span><br><span class="line">节表中 IMAGE\_SECTION\_HEADER结构的总数总是由PE文件头IMAGE\_NT\_HEADERS(注：即本资料中的NT头) 结构中的FileHeader.NumberOfSections 字段来指定的。</span><br><span class="line">DWORD   TimeDateStamp;              //文件创建日期和时间  </span><br><span class="line">DWORD   PointerToSymbolTable;       //指向符号表（用于调试）  </span><br><span class="line">DWORD   NumberOfSymbols;            //符号表中符号个数（用于调试）  </span><br><span class="line">WORD    SizeOfOptionalHeader;       //IMAGE_OPTIONAL_HEADER32结构大小  </span><br><span class="line">紧跟着IMAGE\_FILE\_HEADER后面的数据大小，这也是一个数据结构，它叫做IMAGE\_OPTIONAL\_HEADER,其大小依赖于是64位还是32位文件。32位文件值通常是00E0h，对于64位值通常为00F0h。  </span><br><span class="line">WORD    Characteristics;            //文件属性  </span><br><span class="line">Characteristics：文件属性，普通EXE文件这个字段值为010fh，DLL文件这个字段一般是0210h。保存在winnt.h头文件中有个有个表，然后其中有一些二进制及其代表的属性，可以用或的方式去组合这些属性。  </span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;  </span><br></pre></td></tr></table></figure>

<h5 id="IMAGE-OPTIONAL-HEADER32（可选映像头）"><a href="#IMAGE-OPTIONAL-HEADER32（可选映像头）" class="headerlink" title="IMAGE_OPTIONAL_HEADER32（可选映像头）"></a>IMAGE_OPTIONAL_HEADER32（可选映像头）</h5><p>程序入口点记录在这里，是imagebase+AddressOfEntryPoint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_OPTIONAL_HEADER </span><br><span class="line">&#123;</span><br><span class="line">  //</span><br><span class="line">  // Standard fields. </span><br><span class="line">  //</span><br><span class="line">+18h  WORD  Magic;     // 标志字, ROM 映像（0107h）,普通可执行文件（010Bh）</span><br><span class="line">+1Ah  BYTE   MajorLinkerVersion;   // 链接程序的主版本号</span><br><span class="line">+1Bh  BYTE   MinorLinkerVersion;   // 链接程序的次版本号</span><br><span class="line">+1Ch  DWORD  SizeOfCode;   // 所有含代码的节的总大小</span><br><span class="line">+20h  DWORD  SizeOfInitializedData;  // 所有含已初始化数据的节的总大小</span><br><span class="line">+24h  DWORD  SizeOfUninitializedData; // 所有含未初始化数据的节的大小</span><br><span class="line">+28h  DWORD  AddressOfEntryPoint;  // 程序执行入口RVA</span><br><span class="line">程序入口的RVA，对于exe可以理解为WinMain的RVA。对于DLL可以理解为DllMain的RVA，对于驱动程序，可以理解为DriverEntry的RVA。写壳的时候这个地址相当重要。  </span><br><span class="line">+2Ch  DWORD  BaseOfCode;   // 代码的区块的起始RVA</span><br><span class="line">+30h  DWORD  BaseOfData;   // 数据的区块的起始RVA</span><br><span class="line">  //</span><br><span class="line">  // NT additional fields.  以下是属于NT结构增加的领域。</span><br><span class="line">  //</span><br><span class="line">+34h  DWORD  ImageBase;   // *********程序的首选装载地址</span><br><span class="line">+38h  DWORD  SectionAlignment;   // *********内存中的区块的对齐大小</span><br><span class="line">节对齐，PE中的节被加载到内存时会按照这个域指定的值来对齐，比如这个值是0x1000，那么每个节的起始地址的低12位都为0。  </span><br><span class="line">+3Ch  DWORD  FileAlignment;   // *********文件中的区块的对齐大小</span><br><span class="line">节在文件中按此值对齐，SectionAlignment必须大于或等于FileAlignment。  </span><br><span class="line">实际上这两个对齐方式很重要，在后续RVA和偏移地址的转化中有用到。  </span><br><span class="line">+40h  WORD  MajorOperatingSystemVersion; // 要求操作系统最低版本号的主版本号</span><br><span class="line">+42h  WORD  MinorOperatingSystemVersion; // 要求操作系统最低版本号的副版本号</span><br><span class="line">+44h  WORD  MajorImageVersion;    // 可运行于操作系统的主版本号</span><br><span class="line">+46h  WORD  MinorImageVersion;    // 可运行于操作系统的次版本号</span><br><span class="line">+48h  WORD  MajorSubsystemVersion; // 要求最低子系统版本的主版本号</span><br><span class="line">+4Ah  WORD  MinorSubsystemVersion; // 要求最低子系统版本的次版本号</span><br><span class="line">+4Ch  DWORD  Win32VersionValue;    // 莫须有字段，不被病毒利用的话一般为0</span><br><span class="line">+50h  DWORD  SizeOfImage;    // 映像装入内存后的总尺寸</span><br><span class="line">+54h  DWORD  SizeOfHeaders;    // 文件头的长度之和</span><br><span class="line">+58h  DWORD  CheckSum;    // 映像的校检和</span><br><span class="line">+5Ch  WORD  Subsystem;    // 可执行文件期望的GUI或CUI</span><br><span class="line">图形用户界面，字符用户界面</span><br><span class="line">+5Eh  WORD  DllCharacteristics;    // DllMain()函数何时被调用，默认为 0</span><br><span class="line">+60h  DWORD  SizeOfStackReserve;    // 初始化时的栈大小</span><br><span class="line">+64h  DWORD  SizeOfStackCommit;    // 初始化时实际提交的栈大小</span><br><span class="line">+68h  DWORD  SizeOfHeapReserve;    // 初始化时保留的堆大小</span><br><span class="line">+6Ch  DWORD  SizeOfHeapCommit;    // 初始化时实际提交的堆大小</span><br><span class="line">+70h  DWORD  LoaderFlags;    // 与调试有关，默认为 0 </span><br><span class="line">+74h  DWORD  NumberOfRvaAndSizes; // 下边数据目录的项数，这个字段自Windows NT 发布以来    // 一直是16</span><br><span class="line">+78h  DWORD  DataDirctory[16];     // ********* 数据目录表</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure>

<h6 id="DataDirectory"><a href="#DataDirectory" class="headerlink" title="DataDirectory"></a><strong>DataDirectory</strong></h6><p>构建原因：数据目录表-每个结构给出一个重要数据结构的起始RVA和大小信息。节表可以看作是PE文件各节的根目录的话，也可以认为 data directory 是存储在这些节里的逻辑元素的根目录。</p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103195427884.png" alt="image-20250103195427884" style="zoom: 33%;">

<p>数据目录，这是一个数组，数组的项定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typedefstruct _IMAGE_DATA_DIRECTORY &#123;</span><br><span class="line">DWORD   VirtualAddress;</span><br><span class="line">DWORD   Size;</span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY,*PIMAGE_DATA_DIRECTORY;VirtualAddress</span><br></pre></td></tr></table></figure>

<p>有16个这样的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#define IMAGE_DIRECTORY_ENTRY_EXPORT          0   //0 导出表</span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_IMPORT          1   //1 导入表   </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_RESOURCE        2   //2 资源目录</span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   //3 异常目录</span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_SECURITY        4   //4 安全目录</span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_BASERELOC       5   /5 重定位基本表</span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_DEBUG           6   // Debug Directory  </span><br><span class="line">   // IMAGE_DIRECTORY_ENTRY_COPYRIGHT       7   // (X86 usage)  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    7   // Architecture Specific Data  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR       8   // RVA of GP  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_TLS             9   // TLS Directory  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    10   // Load Configuration Directory  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   11   // Bound Import Directory in headers  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_IAT            12   // 导入地址表</span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   13   // Delay Load Import Descriptors  </span><br><span class="line">#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14   // COM Runtime descriptor  </span><br></pre></td></tr></table></figure>

<p><strong>动态链接</strong></p>
<p>DataDirectory在动态链接过程中起着重要作用</p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103205655208.png" alt="image-20250103205655208">

<p> 动态链接后IAT的内容会被替换为地址</p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103205711132.png" alt="image-20250103205711132">

<p>该过程主要涉及以下三个表：</p>
<ul>
<li><p>导入表：一个引入函数是被某模块调用但又不在调用模块中的函数，位于一个或者更多的DLL里，因而要保留一些函数信息，包括函数名及其驻留的DLL名。（给出函数定义）</p>
<p>装载器首先读入IMAGE_IMPORT_DESCRIPTOR，获得需要加载的动态库User32.DLL。</p>
<p>然后如上图所示会创建两个并列的指向IMAGE_IMPORT_BY_NAME结构的指针数组。第一个数组（由Characteristics域指向的那一个）总是保留原样，系统并不修改。第二个数组（由FirstThunk域指向的那一个）要被PE加载器修改。改成引入函数真实地址 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123;</span><br><span class="line">    union &#123;</span><br><span class="line">        DWORD Characteristics; // 0 for terminating null import descriptor  别名</span><br><span class="line">        DWORD OriginalFirstThunk; // RVA to original unbound IAT，指向导入函数的定义</span><br><span class="line">         (指向IMAGE_THUNK_DATA结构数组的RVA)</span><br><span class="line">    &#125;;</span><br><span class="line">    DWORD TimeDateStamp; // 0 if not bound,</span><br><span class="line">    // -1 if bound, and real date\time stamp</span><br><span class="line">    // in IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT (new BIND)</span><br><span class="line">    // O.W. date/time stamp of DLL bound to (Old BIND)</span><br><span class="line"></span><br><span class="line">    DWORD ForwarderChain; // -1 if no forwarders</span><br><span class="line"></span><br><span class="line">    DWORD Name;  // RVA，指向字符串，是这个可执行文件的名字。指向名字的指针</span><br><span class="line">                                      例如“kernel32.dll&quot;</span><br><span class="line"></span><br><span class="line">    DWORD FirstThunk; // RVA to IAT (if bound this IAT has actual addresses)，在加载前给出导入函数的定义（对齐：前面函数对齐，后面就可以与其地址进行一一对应），在加载后指向导入函数的地址</span><br><span class="line">    (指向IMAGE_THUNK_DATA结构数组的RVA)</span><br><span class="line"></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_THUNK_DATA32 &#123;</span><br><span class="line">    union &#123;</span><br><span class="line">        DWORD ForwarderString; // 一个RVA地址，指向forwarder string </span><br><span class="line">        DWORD Function; // PDWORD，被导入的函数的入口地址</span><br><span class="line">        DWORD Ordinal; // 该函数的序数</span><br><span class="line">        DWORD AddressOfData; // 一个RVA地址，指向IMAGE_IMPORT_BY_NAME</span><br><span class="line">    &#125; u1;</span><br><span class="line">&#125; IMAGE_THUNK_DATA32; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_IMPORT_BY_NAME&#123;</span><br><span class="line">     WORD Hint;// 函数输出序号</span><br><span class="line">     BYTE Name1[i];//输出函数名称</span><br><span class="line">&#125; IMAGE_IMPORT_BY_NAME,*PIMAGE_IMPORT_BY_NAME</span><br></pre></td></tr></table></figure>
</li>
<li><p>导出表：存储导入函数地址</p>
<p>根据IMAGE_IMPORT_BY_NAME的序号或名称到导入的DLL(user32.dll)函数导出表中获取导入函数的地址。然后把这个地址替换掉FirstThunk所指向的函数输入地址表中的数据。</p>
<p>可以按照序号导出也可以按照名称导出 </p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103214737276.png">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_EXPORT_DIRECTORY &#123;</span><br><span class="line"> DWORD  Characteristics;       // 一般为0</span><br><span class="line"> DWORD  TimeDateStamp;         // 文件生成时间</span><br><span class="line"> WORD   MajorVersion;          // 主版本号</span><br><span class="line"> WORD   MinorVersion;          // 次版本号</span><br><span class="line"> DWORD  Name;                  // 指向DLL的名字</span><br><span class="line"> DWORD  Base;                  // 基数，加上序数就是函数地址数组的索引值</span><br><span class="line"> DWORD  NumberOfFunctions;     // AddressOfFunctions数组的项数</span><br><span class="line"> DWORD  NumberOfNames;         // AddressOfNames数组的项数</span><br><span class="line"> DWORD  AddressOfFunctions;    // RVA from base of image（每个函数具体导出的地址值）</span><br><span class="line"> DWORD  AddressOfNames;        // RVA from base of image（按名称导出）</span><br><span class="line"> DWORD  AddressOfNameOrdinals; // RVA from base of image（把序号和名称做了一个对，使其能按序号导出）</span><br><span class="line">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入地址表：IAT</p>
<p>而JMP DWORD PTR [XXXXXXXX]这条指令中的[XXXXXXXX]部分就是这个FirstThunk数组中的某个元素的值。由于被加载器覆盖的这个指针数组最终保存的是导入函数的地址，因此它被称为导入地址表（Import Address Table，IAT）。</p>
<p>对应输入表位置和大小</p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/4d838f3ad4a25abbbf64a80aa161984b.png">

<p>采用PEinfo所查到输入表位置与大小  </p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/e674ae54460c7da4c8ce5c777996162c.png"></li>
</ul>
<h4 id="节表-区块表-IMAGE-SECTION-HEADER-一定数量"><a href="#节表-区块表-IMAGE-SECTION-HEADER-一定数量" class="headerlink" title="节表&#x2F;区块表:_IMAGE_SECTION_HEADER*一定数量"></a>节表&#x2F;区块表:_IMAGE_SECTION_HEADER*一定数量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_SECTION_HEADER &#123;  </span><br><span class="line">Name                        //8个字节的块名  </span><br><span class="line">区块名。这是一个由8个ASCII码组成，用来定义区块的名称的数组。多数区块名都习惯性以一个“.”作为开头（例如：.text），这个“.”实际上是不是必须的。</span><br><span class="line">union//2选1                         </span><br><span class="line">&#123;  </span><br><span class="line">    DWORD PhysicalAddress;  </span><br><span class="line">    DWORD VirtualSize;  //本节的实际字节数，默认就是这个值</span><br><span class="line">&#125; Misc;                     //区块尺寸</span><br><span class="line">DWORD VirtualAddress;       //本节的相对虚拟地址</span><br><span class="line">该块时装载到内存中的RVA，注意这个地址是按内存页对齐的，她总是SectionAlignment的整数倍，在工具中第一个块默认RVA为1000，在OBJ中为0。</span><br><span class="line">DWORD SizeOfRawData;        //在文件中对齐后的尺寸  </span><br><span class="line">该块在磁盘中所占的大小,在可执行文件中，该字段包括经过FileAlignment调整后块的长度。例如FileAlignment的大小为200h，如果VirtualSize中的块长度为19Ah个字节，这一块保存的长度为200h个字节。  </span><br><span class="line">DWORD PointerToRawData;     //在文件中偏移  </span><br><span class="line">该块在磁盘文件中的偏移，程序编译或汇编后生成原始数据，这个字段用于给出原始数据块在文件的偏移，如果程序自装载PE或COFF文件（而不是由OS装载），这种情况，必须完全使用线性映像方法装入文件，需要在该块处找到块的数据。  </span><br><span class="line">DWORD PointerToRelocations; //在OBJ文件中使用，重定位的偏移  </span><br><span class="line">DWORD PointerToLinenumbers; //行号表的偏移（供调试使用地）  </span><br><span class="line">WORD NumberOfRelocations;   //在OBJ文件中使用，重定位项数目  </span><br><span class="line">WORD NumberOfLinenumbers;   //行号表中行号的数目  </span><br><span class="line">DWORD Characteristics;      //区块属性如可读，可写，可执行等  </span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;  </span><br></pre></td></tr></table></figure>

<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250103215704121.png">

<h4 id="PE文件加载过程"><a href="#PE文件加载过程" class="headerlink" title="PE文件加载过程"></a>PE文件加载过程</h4><p>Windows 装载器在装载的时候仅仅建立好虚拟地址和PE文件之间的映射关系。当且仅当真正执行到某个内存页中的指令或者访问某一页中的数据时，这个页面才会被从磁盘提交到物理内存</p>
<img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/2f8dadfaa1513f15cffda7ce1576bb35.png">  

<p>当一个PE文件被加载到内存中以后，我们称之为“映象”（image），一般来说，PE文件在硬盘上和在内存里是不完全一样的，被加载到内存以后其占用的虚拟地址空间要比在硬盘上占用的空间大一些，这是因为各个节在硬盘上是连续的，而在内存中是按页对齐的，所以加载到内存以后节之间会出现一些“空洞”【补的0】。 </p>
<p><img src="/2025/04/07/PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/image-20250407003153563.png" alt="image-20250407003153563"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/" class="post-title-link" itemprop="url">操作系统实验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-06 22:03:48" itemprop="dateCreated datePublished" datetime="2025-04-06T22:03:48+08:00">2025-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-08 13:14:14" itemprop="dateModified" datetime="2025-04-08T13:14:14+08:00">2025-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8A%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">操作系统及安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>rCore-Tutorial-v3实验</p>
<h1 id="lab1"><a href="#lab1" class="headerlink" title="lab1"></a>lab1</h1><h2 id="编程作业"><a href="#编程作业" class="headerlink" title="编程作业"></a>编程作业</h2><h3 id="总结编程内容"><a href="#总结编程内容" class="headerlink" title="总结编程内容"></a>总结编程内容</h3><h4 id="Log-Info"><a href="#Log-Info" class="headerlink" title="Log Info"></a>Log Info</h4><ol>
<li><p>实现自定义日志记录器结构体 SimpleLogger：</p>
<ul>
<li>创建一个名为 <code>SimpleLogger</code> 的结构体，实现 Log trait 中的方法： <code>enabled</code>、 <code>log</code> 和 <code>flush</code>。这些方法用于判断日志记录是否启用、记录日志消息以及刷新日志。</li>
<li>在 <code>enabled</code> 方法中，始终返回 <code>true</code>，表示日志记录一直是启用状态。</li>
<li>在 <code>log</code> 方法中，根据日志级别设置不同的终端文字颜色，然后使用 <code>println!</code> 打印彩色日志消息。</li>
<li><code>flush</code> 方法在这里留空。</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Log</span> <span class="keyword">for</span> <span class="title class_">SimpleLogger</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">enabled</span>(&amp;<span class="keyword">self</span>, _metadata: &amp;Metadata) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">log</span>(&amp;<span class="keyword">self</span>, record: &amp;Record) &#123;</span><br><span class="line">        <span class="keyword">if</span> !<span class="keyword">self</span>.<span class="title function_ invoke__">enabled</span>(record.<span class="title function_ invoke__">metadata</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">color</span> = <span class="keyword">match</span> record.<span class="title function_ invoke__">level</span>() &#123;</span><br><span class="line">            Level::Error =&gt; <span class="number">31</span>, <span class="comment">// Red</span></span><br><span class="line">            Level::Warn =&gt; <span class="number">93</span>,  <span class="comment">// BrightYellow</span></span><br><span class="line">            Level::Info =&gt; <span class="number">34</span>,  <span class="comment">// Blue</span></span><br><span class="line">            Level::<span class="built_in">Debug</span> =&gt; <span class="number">32</span>, <span class="comment">// Green</span></span><br><span class="line">            Level::Trace =&gt; <span class="number">90</span>, <span class="comment">// BrightBlack</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//&quot;\x1b[31mhello world\x1b[0m&quot;</span></span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;\u&#123;1B&#125;[&#123;&#125;m[&#123;:&gt;5&#125;] &#123;&#125;\u&#123;1B&#125;[0m&quot;</span>,</span><br><span class="line">            color,</span><br><span class="line">            record.<span class="title function_ invoke__">level</span>(),</span><br><span class="line">            record.<span class="title function_ invoke__">args</span>(),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">flush</span>(&amp;<span class="keyword">self</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化日志记录器：</p>
</li>
</ol>
<ul>
<li>创建一个 <code>init</code> 函数，在函数内部进行日志记录器的初始化工作。</li>
<li>定义一个静态变量 <code>LOGGER</code>，其类型为生成的 <code>SimpleLogger</code> 实例。</li>
<li>将 <code>LOGGER</code> 设置为全局默认的日志记录器，确保它在整个程序生命周期中使用相同的日志实例。</li>
<li>使用 log crate 中的 <code>set_max_level</code> 方法，根据环境变量 “LOG” 的值，选择相应的日志级别。通过 match 匹配语句将环境变量的值转换为对应的 log crate 中的 <code>LevelFilter</code> 类型的日志级别。</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init</span>() &#123;</span><br><span class="line">    <span class="keyword">static</span> LOGGER: SimpleLogger = SimpleLogger;</span><br><span class="line">    log::<span class="title function_ invoke__">set_logger</span>(&amp;LOGGER).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    log::<span class="title function_ invoke__">set_max_level</span>(<span class="keyword">match</span> <span class="built_in">option_env!</span>(<span class="string">&quot;LOG&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="string">&quot;ERROR&quot;</span>) =&gt; LevelFilter::Error,</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="string">&quot;WARN&quot;</span>) =&gt; LevelFilter::Warn,</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="string">&quot;INFO&quot;</span>) =&gt; LevelFilter::Info,</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="string">&quot;DEBUG&quot;</span>) =&gt; LevelFilter::<span class="built_in">Debug</span>,</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="string">&quot;TRACE&quot;</span>) =&gt; LevelFilter::Trace,</span><br><span class="line">        _ =&gt; LevelFilter::Off,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Kernel-Info"><a href="#Kernel-Info" class="headerlink" title="Kernel Info"></a>Kernel Info</h4><ol>
<li>实验思路总结：</li>
</ol>
<ul>
<li>在 <code>rust_main</code> 函数中，首先通过 <code>extern &quot;C&quot;</code> 声明了一系列外部函数，这些函数用于获取内核各个段（text、rodata、data、bss）的起止地址，以及栈的上下界。</li>
<li>调用 <code>logging::init()</code> 函数，初始化日志记录器。</li>
<li>使用 <code>info!</code>、 <code>error!</code>、 <code>warn!</code>、 <code>debug!</code> 宏输出不同级别的日志信息，包括各个段的起止地址等内核信息。使用println输出”hello world”。</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">rust_main</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">stext</span>(); <span class="comment">// begin addr of text segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">etext</span>(); <span class="comment">// end addr of text segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">srodata</span>(); <span class="comment">// start addr of Read-Only data segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">erodata</span>(); <span class="comment">// end addr of Read-Only data ssegment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">sdata</span>(); <span class="comment">// start addr of data segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">edata</span>(); <span class="comment">// end addr of data segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">sbss</span>(); <span class="comment">// start addr of BSS segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">ebss</span>(); <span class="comment">// end addr of BSS segment</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">boot_stack_lower_bound</span>(); <span class="comment">// stack lower bound</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">boot_stack_top</span>(); <span class="comment">// stack top</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">clear_bss</span>();</span><br><span class="line">    logging::<span class="title function_ invoke__">init</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;[kernel] Hello, world!&quot;</span>);</span><br><span class="line">    info!(</span><br><span class="line">        <span class="string">&quot;[kernel] .text [&#123;:#x&#125;, &#123;:#x&#125;)&quot;</span>,</span><br><span class="line">        stext <span class="keyword">as</span> <span class="type">usize</span>,</span><br><span class="line">        etext <span class="keyword">as</span> <span class="type">usize</span></span><br><span class="line">    );</span><br><span class="line">    error!(</span><br><span class="line">        <span class="string">&quot;[kernel] .rodata [&#123;:#x&#125;, &#123;:#x&#125;)&quot;</span>,</span><br><span class="line">        srodata <span class="keyword">as</span> <span class="type">usize</span>, erodata <span class="keyword">as</span> <span class="type">usize</span></span><br><span class="line">    );</span><br><span class="line">    warn!(</span><br><span class="line">        <span class="string">&quot;[kernel] .data [&#123;:#x&#125;, &#123;:#x&#125;)&quot;</span>,</span><br><span class="line">        sdata <span class="keyword">as</span> <span class="type">usize</span>, edata <span class="keyword">as</span> <span class="type">usize</span></span><br><span class="line">    );</span><br><span class="line">    debug!(</span><br><span class="line">        <span class="string">&quot;[kernel] boot_stack top=bottom=&#123;:#x&#125;, lower_bound=&#123;:#x&#125;&quot;</span>,</span><br><span class="line">        boot_stack_top <span class="keyword">as</span> <span class="type">usize</span>, boot_stack_lower_bound <span class="keyword">as</span> <span class="type">usize</span></span><br><span class="line">    );</span><br><span class="line">    info!(<span class="string">&quot;[kernel] .bss [&#123;:#x&#125;, &#123;:#x&#125;)&quot;</span>, sbss <span class="keyword">as</span> <span class="type">usize</span>, ebss <span class="keyword">as</span> <span class="type">usize</span>);</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240525213549206.png" alt="image-20240525213549206"></p>
<h2 id="问答作业"><a href="#问答作业" class="headerlink" title="问答作业"></a>问答作业</h2><h3 id="请学习-gdb-调试工具的使用-这对后续调试很重要-，并通过-gdb-简单跟踪从机器加电到跳转到-0x80200000-的简单过程。只需要描述重要的跳转即可，只需要描述在-qemu-上的情况。"><a href="#请学习-gdb-调试工具的使用-这对后续调试很重要-，并通过-gdb-简单跟踪从机器加电到跳转到-0x80200000-的简单过程。只需要描述重要的跳转即可，只需要描述在-qemu-上的情况。" class="headerlink" title="请学习 gdb 调试工具的使用(这对后续调试很重要)，并通过 gdb 简单跟踪从机器加电到跳转到 0x80200000 的简单过程。只需要描述重要的跳转即可，只需要描述在 qemu 上的情况。"></a>请学习 gdb 调试工具的使用(这对后续调试很重要)，并通过 gdb 简单跟踪从机器加电到跳转到 0x80200000 的简单过程。只需要描述重要的跳转即可，只需要描述在 qemu 上的情况。</h3><p>Qemu 启动后 PC 被初始化为 <code>0x1000</code> 。我们可以检查一下 Qemu 的启动固件的内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/10i <span class="variable">$pc</span></span><br><span class="line">=&gt; 0x1000:  auipc   t0,0x0</span><br><span class="line">0x1004:     addi    a1,t0,32</span><br><span class="line">0x1008:     csrr    a0,mhartid</span><br><span class="line">0x100c:     ld      t0,24(t0)</span><br><span class="line">0x1010:     jr      t0</span><br><span class="line">0x1014:     unimp</span><br><span class="line">0x1016:     unimp</span><br><span class="line">0x1018:     unimp</span><br><span class="line">0x101a:     0x8000</span><br><span class="line">0x101c:     unimp</span><br></pre></td></tr></table></figure>

<p> Qemu 的固件仅包含 5 条指令，从 <code>0x1014</code> 开始都是数据，当数据为 0 的时候则会被反汇编为 <code>unimp</code> 指令。 <code>0x101a</code> 处的数据 <code>0x8000</code> 是能够跳转到 <code>0x80000000</code> 进入启动下一阶段的关键。在执行位于 <code>0x1010</code> 的指令之前，寄存器 <code>t0</code> 的值恰好为 <code>0x80000000</code> ，随后通过 <code>jr t0</code> 便可以跳转到该地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(gdb) si</span><br><span class="line">0x0000000000001004 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000000001008 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x000000000000100c <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000000001010 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) p/x <span class="variable">$t0</span></span><br><span class="line">1 = 0x80000000</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000080000000 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>可以看到，当位于 <code>0x1010</code> 的指令执行完毕后，下一条待执行的指令位于 RustSBI 的入口，也即 <code>0x80000000</code> ，这意味着我们即将把控制权转交给 RustSBI 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/10i $pc</span><br><span class="line">=&gt; 0x80000000:      auipc   sp,0x28</span><br><span class="line">0x80000004: mv      sp,sp</span><br><span class="line">0x80000008: lui     t0,0x4</span><br><span class="line">0x8000000a: addi    t1,a0,1</span><br><span class="line">0x8000000e: add     sp,sp,t0</span><br><span class="line">0x80000010: addi    t1,t1,-1</span><br><span class="line">0x80000012: bnez    t1,0x8000000e</span><br><span class="line">0x80000016: j       0x8001125a</span><br><span class="line">0x8000001a: unimp</span><br><span class="line">0x8000001c: addi    sp,sp,-48</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000080000004 in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000080000008 in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x000000008000000a in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x000000008000000e in ?? ()</span><br></pre></td></tr></table></figure>

<p>接下来我们检查控制权能否被移交给我们的内核：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b *0x80200000</span><br><span class="line">Breakpoint 1 at 0x80200000</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000080200000 in ?? ()</span><br></pre></td></tr></table></figure>

<h1 id="lab2"><a href="#lab2" class="headerlink" title="lab2"></a>lab2</h1><h2 id="编程作业-1"><a href="#编程作业-1" class="headerlink" title="编程作业"></a>编程作业</h2><h3 id="总结编程内容-1"><a href="#总结编程内容-1" class="headerlink" title="总结编程内容"></a>总结编程内容</h3><ol>
<li>这里对于每次的输出都检查<code>str</code>地址是否在加载运行程序的地址范围内。</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_write</span>(fd: <span class="type">usize</span>, buf: *<span class="keyword">const</span> <span class="type">u8</span>, len: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> fd &#123;</span><br><span class="line">        FD_STDOUT =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (((buf <span class="keyword">as</span> <span class="type">usize</span>)  &gt;= USER_STACK.<span class="title function_ invoke__">get_sp</span>() - USER_STACK_SIZE) &amp;&amp; ((buf <span class="keyword">as</span> <span class="type">usize</span>) + len &lt;= USER_STACK.<span class="title function_ invoke__">get_sp</span>())) </span><br><span class="line">            || (((buf <span class="keyword">as</span> <span class="type">usize</span>) + len &lt;= APP_SIZE_LIMIT + APP_BASE_ADDRESS) &amp;&amp; ((buf <span class="keyword">as</span> <span class="type">usize</span>) &gt;= APP_BASE_ADDRESS))&#123;</span><br><span class="line">                ……</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                ……</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        ……</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/Cache_-b461d57e7cbe281..jpg" alt="Cache_-b461d57e7cbe281."></p>
<h2 id="问答作业-1"><a href="#问答作业-1" class="headerlink" title="问答作业"></a>问答作业</h2><h3 id="正确进入-U-态后，程序的特征还应有：使用-S-态特权指令，访问-S-态寄存器后会报错。-请同学们可以自行测试这些内容-运行-Rust-三个-bad-测例-ch2b-bad-rs-，-注意在编译时至少需要指定-LOG-ERROR-才能观察到内核的报错信息-，-描述程序出错行为，同时注意注明你使用的-sbi-及其版本。"><a href="#正确进入-U-态后，程序的特征还应有：使用-S-态特权指令，访问-S-态寄存器后会报错。-请同学们可以自行测试这些内容-运行-Rust-三个-bad-测例-ch2b-bad-rs-，-注意在编译时至少需要指定-LOG-ERROR-才能观察到内核的报错信息-，-描述程序出错行为，同时注意注明你使用的-sbi-及其版本。" class="headerlink" title="正确进入 U 态后，程序的特征还应有：使用 S 态特权指令，访问 S 态寄存器后会报错。 请同学们可以自行测试这些内容 (运行 Rust 三个 bad  测例 (ch2b_bad_*.rs) ， 注意在编译时至少需要指定 LOG&#x3D;ERROR 才能观察到内核的报错信息) ，  描述程序出错行为，同时注意注明你使用的 sbi 及其版本。"></a>正确进入 U 态后，程序的特征还应有：使用 S 态特权指令，访问 S 态寄存器后会报错。 请同学们可以自行测试这些内容 (运行 Rust 三个 bad  测例 (ch2b_bad_*.rs) ， 注意在编译时至少需要指定 LOG&#x3D;ERROR 才能观察到内核的报错信息) ，  描述程序出错行为，同时注意注明你使用的 sbi 及其版本。</h3><p>Rustsbi 版本为: 0.2.0-alpha.2</p>
<p>出现报错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[kernel] PageFault in application, bad addr = 0x0, bad instruction = 0x804003c4, kernel killed it.</span><br><span class="line">[kernel] IllegalInstruction in application, kernel killed it.</span><br><span class="line">[kernel] IllegalInstruction in application, kernel killed it.</span><br></pre></td></tr></table></figure>

<p>ch2b_bad_address.rs<code> 由于除0错误触发异常退出</code> </p>
<p>ch2b_bad_instructions.rs<code> 在用户态非法使用指令</code>sret</p>
<p>ch2b_bad_register.rs<code> 在用户态非法使用指令</code>csrr</p>
<h3 id="深入理解-trap-S-中两个函数-alltraps-和-restore-的作用，并回答如下问题"><a href="#深入理解-trap-S-中两个函数-alltraps-和-restore-的作用，并回答如下问题" class="headerlink" title="深入理解 trap.S 中两个函数 __alltraps 和 __restore 的作用，并回答如下问题:"></a>深入理解 trap.S 中两个函数 __alltraps 和 __restore 的作用，并回答如下问题:</h3><h4 id="L40：刚进入-restore-时，a0-代表了什么值。请指出-restore-的两种使用情景。"><a href="#L40：刚进入-restore-时，a0-代表了什么值。请指出-restore-的两种使用情景。" class="headerlink" title="L40：刚进入 __restore 时，a0 代表了什么值。请指出 __restore 的两种使用情景。"></a>L40：刚进入 __restore 时，a0 代表了什么值。请指出 __restore 的两种使用情景。</h4><blockquote>
<ol>
<li>刚进入 __restore 时，a0 代表了系统调用的第一个参数</li>
<li>__restore 的作用包括:</li>
</ol>
<ul>
<li>从系统调用和异常返回时, 恢复要返回的用户态的上下文信息</li>
<li>任务切换时, 恢复要切换的任务的上下文信息</li>
</ul>
</blockquote>
<h4 id="L43-L48：这几行汇编代码特殊处理了哪些寄存器？这些寄存器的的值对于进入用户态有何意义？请分别解释。"><a href="#L43-L48：这几行汇编代码特殊处理了哪些寄存器？这些寄存器的的值对于进入用户态有何意义？请分别解释。" class="headerlink" title="L43-L48：这几行汇编代码特殊处理了哪些寄存器？这些寄存器的的值对于进入用户态有何意义？请分别解释。"></a>L43-L48：这几行汇编代码特殊处理了哪些寄存器？这些寄存器的的值对于进入用户态有何意义？请分别解释。</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ld t0, 32*8(sp) # 内核栈 32*8(sp) 处存储了原 sstatus 寄存器的值, 将其读取到 t0</span><br><span class="line">ld t1, 33*8(sp) # 内核栈 32*8(sp) 处存储了原 sepc 寄存器的值, 将其读取到 t1</span><br><span class="line">ld t2, 2*8(sp) # 内核栈 32*8(sp) 处存储了原 sscratch 寄存器的值, 将其读取到 t2</span><br><span class="line">csrw sstatus, t0 # 将 t0中原 sstatus 寄存器的值读取到 sstatus</span><br><span class="line">csrw sepc, t1 # 将 t0中原 sepc 寄存器的值读取到 sepc</span><br><span class="line">csrw sscratch, t2 # 将 t0中原 sscratch 寄存器的值读取到 sscratch</span><br></pre></td></tr></table></figure>

<h4 id="L50-L56：为何跳过了-x2-和-x4？"><a href="#L50-L56：为何跳过了-x2-和-x4？" class="headerlink" title="L50-L56：为何跳过了 x2 和 x4？"></a>L50-L56：为何跳过了 x2 和 x4？</h4><ol>
<li>跳过<code>x2</code>是因为<code>x2</code>对应的用户栈指针保存到了sscratch寄存器, 不需要从内核栈中进行恢复</li>
<li>跳过<code>x4</code>是因为并没有使用它, 所以无需恢复</li>
</ol>
<h4 id="L60：该指令之后，sp-和-sscratch-中的值分别有什么意义？"><a href="#L60：该指令之后，sp-和-sscratch-中的值分别有什么意义？" class="headerlink" title="L60：该指令之后，sp 和 sscratch 中的值分别有什么意义？"></a>L60：该指令之后，sp 和 sscratch 中的值分别有什么意义？</h4><p><code>sp</code>指向用户栈, <code>sscratch</code>指向内核栈</p>
<h4 id="restore：中发生状态切换在哪一条指令？为何该指令执行之后会进入用户态？"><a href="#restore：中发生状态切换在哪一条指令？为何该指令执行之后会进入用户态？" class="headerlink" title="__restore：中发生状态切换在哪一条指令？为何该指令执行之后会进入用户态？"></a>__restore：中发生状态切换在哪一条指令？为何该指令执行之后会进入用户态？</h4><p><code>sret</code>后发生了状态切换, 执行该指令后, PC设置为 <code>sepc</code> 寄存器的值。<code>sepc</code> 存储着产生中断或异常前的指令地址，因此这实现了到原始代码的返回。</p>
<h4 id="L13：该指令之后，sp-和-sscratch-中的值分别有什么意义？"><a href="#L13：该指令之后，sp-和-sscratch-中的值分别有什么意义？" class="headerlink" title="L13：该指令之后，sp 和 sscratch 中的值分别有什么意义？"></a>L13：该指令之后，sp 和 sscratch 中的值分别有什么意义？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csrrw sp, sscratch, sp</span><br></pre></td></tr></table></figure>

<p><code>sp</code>, <code>sscratch</code>寄存器的内容被交换, <code>sp</code>保存了原<code>sscratch</code>中的内核栈指针, <code>sscratch</code>保存了原<code>sp</code>中的用户栈栈指针</p>
<h4 id="从-U-态进入-S-态是哪一条指令发生的？"><a href="#从-U-态进入-S-态是哪一条指令发生的？" class="headerlink" title="从 U 态进入 S 态是哪一条指令发生的？"></a>从 U 态进入 S 态是哪一条指令发生的？</h4><p><code>ecall</code>指令</p>
<h3 id="对于任何中断，-alltraps-中都需要保存所有寄存器吗？你有没有想到一些加速-alltraps-的方法？简单描述你的想法。"><a href="#对于任何中断，-alltraps-中都需要保存所有寄存器吗？你有没有想到一些加速-alltraps-的方法？简单描述你的想法。" class="headerlink" title="对于任何中断，__alltraps 中都需要保存所有寄存器吗？你有没有想到一些加速 __alltraps 的方法？简单描述你的想法。"></a>对于任何中断，<code>__alltraps</code> 中都需要保存所有寄存器吗？你有没有想到一些加速 <code>__alltraps</code> 的方法？简单描述你的想法。</h3><p>在处理中断时，通常会在<code>__alltraps</code>函数中保存所有寄存器的状态，以确保在中断处理完成后能够正确恢复现场。然而，并非所有寄存器都需要保存，因为某些寄存器可能在中断处理过程中并不会被修改。</p>
<p>一些加速<code>__alltraps</code>的方法包括：</p>
<ol>
<li>只保存和恢复中断处理过程中需要的寄存器。可以通过分析中断处理过程中的代码，确定哪些寄存器是必须保存的，而哪些是可以不保存的。</li>
<li>使用内联汇编或者手动优化汇编代码，避免不必要的寄存器保存和恢复操作，从而减少中断处理的开销。</li>
<li>将一些处理逻辑移到中断处理程序之外，减少<code>__alltraps</code>函数中的代码量，提高处理效率。</li>
</ol>
<p>总的来说，通过精心设计中断处理过程，只保存必要的寄存器状态，避免不必要的操作，并尽可能减少中断处理的复杂性，可以加速<code>__alltraps</code>函数的执行。希望这些想法对你有所帮助！如果有任何问题，请随时告诉我。</p>
<h1 id="lab3"><a href="#lab3" class="headerlink" title="lab3"></a>lab3</h1><h2 id="编程作业-2"><a href="#编程作业-2" class="headerlink" title="编程作业"></a>编程作业</h2><h3 id="总结编程内容-2"><a href="#总结编程内容-2" class="headerlink" title="总结编程内容"></a>总结编程内容</h3><h4 id="在TaskControl中增加相应的元素来记录需要的值"><a href="#在TaskControl中增加相应的元素来记录需要的值" class="headerlink" title="在TaskControl中增加相应的元素来记录需要的值"></a>在TaskControl中增加相应的元素来记录需要的值</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	os/src/task/task.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">TaskControlBlock</span> &#123;</span><br><span class="line">    <span class="comment">/// 任务状态</span></span><br><span class="line">    <span class="keyword">pub</span> task_status: TaskStatus,</span><br><span class="line">    <span class="comment">/// 任务上下文</span></span><br><span class="line">    <span class="keyword">pub</span> task_cx: TaskContext,</span><br><span class="line">    <span class="comment">/// 系统调用次数</span></span><br><span class="line">    <span class="keyword">pub</span> syscall_times: [<span class="type">u32</span>; MAX_SYSCALL_NUM],	<span class="comment">//lab3 adds</span></span><br><span class="line">    <span class="comment">/// 启动时间</span></span><br><span class="line">    <span class="keyword">pub</span> start_time: <span class="type">usize</span>	<span class="comment">//lab3 addds</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中start_time用来记录task第一次被调用的时间。</p>
<h4 id="在所有初始化和赋值TaskControl的函数增加对应域的初始化和赋值"><a href="#在所有初始化和赋值TaskControl的函数增加对应域的初始化和赋值" class="headerlink" title="在所有初始化和赋值TaskControl的函数增加对应域的初始化和赋值"></a>在所有初始化和赋值TaskControl的函数增加对应域的初始化和赋值</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">static</span> <span class="keyword">ref</span> TASK_MANAGER: TaskManager = &#123;</span><br><span class="line">	……</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">tasks</span> = [TaskControlBlock &#123;</span><br><span class="line">            task_cx: TaskContext::<span class="title function_ invoke__">zero_init</span>(),</span><br><span class="line">            task_status: TaskStatus::UnInit,</span><br><span class="line">            syscall_times: [<span class="number">0</span>; MAX_SYSCALL_NUM],</span><br><span class="line">            start_time: <span class="number">0</span></span><br><span class="line">     &#125;; MAX_APP_NUM];</span><br><span class="line">     ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="在task第一次被调度时为其start-time赋值"><a href="#在task第一次被调度时为其start-time赋值" class="headerlink" title="在task第一次被调度时为其start_time赋值"></a>在task第一次被调度时为其start_time赋值</h4><p>这里采用了一个小trick，用start_time本身来做一个flag，当调度到其task时发现其start_time为0，则说明start_time为0，则说明该task第一次被调度，将start_time设计为当前时间，否则说明该task已经被调度过，不修改其start_time。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">run_next_task</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(next) = <span class="keyword">self</span>.<span class="title function_ invoke__">find_next_task</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">inner</span> = <span class="keyword">self</span>.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">current</span> = inner.current_task;</span><br><span class="line">            inner.tasks[next].task_status = TaskStatus::Running;</span><br><span class="line">            <span class="keyword">if</span> inner.tasks[next].start_time == <span class="number">0</span>&#123;</span><br><span class="line">        	inner.tasks[next].start_time = <span class="title function_ invoke__">get_time_us</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            ……</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="增加pub方法使得其它模块也能获取当前task的start-time和taskstatus，从而获取想要的信息。"><a href="#增加pub方法使得其它模块也能获取当前task的start-time和taskstatus，从而获取想要的信息。" class="headerlink" title="增加pub方法使得其它模块也能获取当前task的start_time和taskstatus，从而获取想要的信息。"></a>增加pub方法使得其它模块也能获取当前task的start_time和taskstatus，从而获取想要的信息。</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">TaskManager</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_current_start_time</span>(&amp;<span class="keyword">self</span>)<span class="punctuation">-&gt;</span><span class="type">usize</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">inner</span>=<span class="keyword">self</span>.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">current</span>=inner.current_task;</span><br><span class="line">        inner.tasks[current].start_time</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">fn</span> <span class="title function_">get_current_status</span>(&amp;<span class="keyword">self</span>)<span class="punctuation">-&gt;</span>TaskStatus&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">inner</span>=<span class="keyword">self</span>.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">current</span>=inner.current_task;</span><br><span class="line">        inner.tasks[current].task_status</span><br><span class="line">    &#125;</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_current_start_time</span>()<span class="punctuation">-&gt;</span><span class="type">usize</span>&#123;</span><br><span class="line">	TASK_MANAGER.<span class="title function_ invoke__">get_current_start_time</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_current_status</span>()<span class="punctuation">-&gt;</span>TaskStatus&#123;</span><br><span class="line">	TASK_MANAGER.<span class="title function_ invoke__">get_current_status</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="增加syscall-times的记录和处理"><a href="#增加syscall-times的记录和处理" class="headerlink" title="增加syscall_times的记录和处理"></a>增加syscall_times的记录和处理</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/task/mod.rs</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TaskManager</span> &#123;</span><br><span class="line">    ……</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_syscall_times</span>(&amp;<span class="keyword">self</span>)<span class="punctuation">-&gt;</span>[<span class="type">u32</span>;<span class="number">500</span>]&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">inner</span>=<span class="keyword">self</span>.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">current</span>=inner.current_task;</span><br><span class="line">        inner.tasks[current].syscall_times</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">update_syscall_times</span>(&amp;<span class="keyword">self</span>,syscall_id: <span class="type">usize</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">inner</span> = <span class="keyword">self</span>.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">current</span> = inner.current_task;</span><br><span class="line">        inner.tasks[current].syscall_times[syscall_id] += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br><span class="line">……</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_syscall_times</span>()<span class="punctuation">-&gt;</span>[<span class="type">u32</span>;<span class="number">500</span>]&#123;</span><br><span class="line">	TASK_MANAGER.<span class="title function_ invoke__">get_syscall_times</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">update_syscall_times</span>(syscall_id: <span class="type">usize</span>) &#123;</span><br><span class="line">    TASK_MANAGER.<span class="title function_ invoke__">update_syscall_times</span>(syscall_id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">syscall</span>(syscall_id: <span class="type">usize</span>, args: [<span class="type">usize</span>; <span class="number">3</span>]) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">update_syscall_times</span>(syscall_id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现系统调用sys-task-info"><a href="#实现系统调用sys-task-info" class="headerlink" title="实现系统调用sys_task_info"></a>实现系统调用sys_task_info</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_task_info</span>(ti: *<span class="keyword">mut</span> TaskInfo) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    trace!(<span class="string">&quot;kernel: sys_task_info&quot;</span>);</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        *ti = TaskInfo &#123;</span><br><span class="line">            status: <span class="title function_ invoke__">get_current_status</span>(),</span><br><span class="line">            syscall_times: <span class="title function_ invoke__">get_syscall_times</span>(),</span><br><span class="line">            time:(<span class="title function_ invoke__">get_time_us</span>()-<span class="title function_ invoke__">get_current_start_time</span>())/<span class="number">1000</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240525204941485.png" alt="image-20240525204941485"></p>
<h2 id="问答作业-2"><a href="#问答作业-2" class="headerlink" title="问答作业"></a>问答作业</h2><h3 id="正确进入-U-态后，程序的特征还应有：使用-S-态特权指令，访问-S-态寄存器后会报错。-请同学们可以自行测试这些内容-运行-Rust-两个-bad-测例-ch2b-bad-rs-，-描述程序出错行为，同时注意注明你使用的-sbi-及其版本。"><a href="#正确进入-U-态后，程序的特征还应有：使用-S-态特权指令，访问-S-态寄存器后会报错。-请同学们可以自行测试这些内容-运行-Rust-两个-bad-测例-ch2b-bad-rs-，-描述程序出错行为，同时注意注明你使用的-sbi-及其版本。" class="headerlink" title="正确进入 U 态后，程序的特征还应有：使用 S 态特权指令，访问 S 态寄存器后会报错。 请同学们可以自行测试这些内容 (运行 Rust 两个 bad 测例 (ch2b_bad_*.rs) ) ， 描述程序出错行为，同时注意注明你使用的 sbi 及其版本。"></a>正确进入 U 态后，程序的特征还应有：使用 S 态特权指令，访问 S 态寄存器后会报错。 请同学们可以自行测试这些内容 (运行 <a target="_blank" rel="noopener" href="https://github.com/LearningOS/rCore-Tutorial-Test-2022S/tree/master/src/bin">Rust 两个 bad 测例 (ch2b_bad_*.rs)</a> ) ， 描述程序出错行为，同时注意注明你使用的 sbi 及其版本。</h3><p>Rustsbi 版本为: 0.2.0-alpha.2</p>
<p>出现报错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[kernel] PageFault in application, bad addr = 0x0, bad instruction = 0x804003c4, kernel killed it.</span><br><span class="line">[kernel] IllegalInstruction in application, kernel killed it.</span><br><span class="line">[kernel] IllegalInstruction in application, kernel killed it.</span><br></pre></td></tr></table></figure>

<p>ch2b_bad_address.rs<code> 由于除0错误触发异常退出</code> </p>
<p>ch2b_bad_instructions.rs<code> 在用户态非法使用指令</code>sret</p>
<p>ch2b_bad_register.rs<code> 在用户态非法使用指令</code>csrr</p>
<h3 id="请通过-gdb-跟踪或阅读源代码了解机器从加电到跳转到-0x80200000-的过程，并描述重要的跳转。回答内核是如何进入-S-态的？"><a href="#请通过-gdb-跟踪或阅读源代码了解机器从加电到跳转到-0x80200000-的过程，并描述重要的跳转。回答内核是如何进入-S-态的？" class="headerlink" title="请通过 gdb 跟踪或阅读源代码了解机器从加电到跳转到 0x80200000 的过程，并描述重要的跳转。回答内核是如何进入 S 态的？"></a>请通过 gdb 跟踪或阅读源代码了解机器从加电到跳转到 0x80200000 的过程，并描述重要的跳转。回答内核是如何进入 S 态的？</h3><ul>
<li>事实上进入 rustsbi (0x80000000) 之后就不需要使用 gdb 调试了。可以直接阅读 <a target="_blank" rel="noopener" href="https://github.com/rustsbi/rustsbi-qemu/blob/7d71bfb7b3ad8e36f06f92c2ffe2066bbb0f9254/rustsbi-qemu/src/main.rs#L56">代码</a> 。</li>
<li>可以使用 Makefile 中的 <code>make debug</code> 指令。</li>
<li>一些可能用到的 gdb 指令：<ul>
<li><code>x/10i 0x80000000</code> : 显示 0x80000000 处的10条汇编指令。</li>
<li><code>x/10i $pc</code> : 显示即将执行的10条汇编指令。</li>
<li><code>x/10xw 0x80000000</code> : 显示 0x80000000 处的10条数据，格式为16进制32bit。</li>
<li><code>info register</code>: 显示当前所有寄存器信息。</li>
<li><code>info r t0</code>: 显示 t0 寄存器的值。</li>
<li><code>break funcname</code>: 在目标函数第一条指令处设置断点。</li>
<li><code>break *0x80200000</code>: 在 0x80200000 出设置断点。</li>
<li><code>continue</code>: 执行直到碰到断点。</li>
<li><code>si</code>: 单步执行一条汇编指令。</li>
</ul>
</li>
</ul>
<p>Qemu 启动后 PC 被初始化为 <code>0x1000</code> 。我们可以检查一下 Qemu 的启动固件的内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/10i <span class="variable">$pc</span></span><br><span class="line">=&gt; 0x1000:  auipc   t0,0x0</span><br><span class="line">0x1004:     addi    a1,t0,32</span><br><span class="line">0x1008:     csrr    a0,mhartid</span><br><span class="line">0x100c:     ld      t0,24(t0)</span><br><span class="line">0x1010:     jr      t0</span><br><span class="line">0x1014:     unimp</span><br><span class="line">0x1016:     unimp</span><br><span class="line">0x1018:     unimp</span><br><span class="line">0x101a:     0x8000</span><br><span class="line">0x101c:     unimp</span><br></pre></td></tr></table></figure>

<p> Qemu 的固件仅包含 5 条指令，从 <code>0x1014</code> 开始都是数据，当数据为 0 的时候则会被反汇编为 <code>unimp</code> 指令。 <code>0x101a</code> 处的数据 <code>0x8000</code> 是能够跳转到 <code>0x80000000</code> 进入启动下一阶段的关键。在执行位于 <code>0x1010</code> 的指令之前，寄存器 <code>t0</code> 的值恰好为 <code>0x80000000</code> ，随后通过 <code>jr t0</code> 便可以跳转到该地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(gdb) si</span><br><span class="line">0x0000000000001004 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000000001008 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x000000000000100c <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000000001010 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) p/x <span class="variable">$t0</span></span><br><span class="line">1 = 0x80000000</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000080000000 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>可以看到，当位于 <code>0x1010</code> 的指令执行完毕后，下一条待执行的指令位于 RustSBI 的入口，也即 <code>0x80000000</code> ，这意味着我们即将把控制权转交给 RustSBI 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/10i $pc</span><br><span class="line">=&gt; 0x80000000:      auipc   sp,0x28</span><br><span class="line">0x80000004: mv      sp,sp</span><br><span class="line">0x80000008: lui     t0,0x4</span><br><span class="line">0x8000000a: addi    t1,a0,1</span><br><span class="line">0x8000000e: add     sp,sp,t0</span><br><span class="line">0x80000010: addi    t1,t1,-1</span><br><span class="line">0x80000012: bnez    t1,0x8000000e</span><br><span class="line">0x80000016: j       0x8001125a</span><br><span class="line">0x8000001a: unimp</span><br><span class="line">0x8000001c: addi    sp,sp,-48</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000080000004 in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x0000000080000008 in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x000000008000000a in ?? ()</span><br><span class="line">(gdb) si</span><br><span class="line">0x000000008000000e in ?? ()</span><br></pre></td></tr></table></figure>

<p>接下来我们检查控制权能否被移交给我们的内核：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b *0x80200000</span><br><span class="line">Breakpoint 1 at 0x80200000</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000080200000 in ?? ()</span><br></pre></td></tr></table></figure>

<h1 id="lab4"><a href="#lab4" class="headerlink" title="lab4"></a>lab4</h1><h2 id="编程作业-3"><a href="#编程作业-3" class="headerlink" title="编程作业"></a>编程作业</h2><h3 id="总结编程内容-3"><a href="#总结编程内容-3" class="headerlink" title="总结编程内容"></a>总结编程内容</h3><h4 id="重写-sys-get-time和sys-task-info"><a href="#重写-sys-get-time和sys-task-info" class="headerlink" title="重写 sys_get_time和sys_task_info"></a>重写 sys_get_time和sys_task_info</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_get_time</span>(ts: *<span class="keyword">mut</span> TimeVal, _tz: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    trace!(<span class="string">&quot;kernel: sys_get_time&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">us</span> = <span class="title function_ invoke__">get_time_us</span>();</span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        *ts = TimeVal &#123;</span><br><span class="line">            sec: us / <span class="number">1_000_000</span>,</span><br><span class="line">            usec: us % <span class="number">1_000_000</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以sys_get_time为例，在原来的sys_get_time中，它传入的是一个TimeVal类型的指针，发起系统调用时是在用户态下传入的地址，在内核态下，该地址显然不再是传入的数据的位置，因此，我们只需要找到真实的地址即可。因此，我们只需要实现一个当前进程虚拟地址到物理地址的转换方法即可，一种实现方式为：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">current_translated_physical_address</span>(ptr:*<span class="keyword">const</span> <span class="type">u8</span>)<span class="punctuation">-&gt;</span><span class="type">usize</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">token</span> = <span class="title function_ invoke__">current_user_token</span>();</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">page_table</span>=PageTable::<span class="title function_ invoke__">from_token</span>(token);</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">va</span>=VirtAddr::<span class="title function_ invoke__">from</span>(ptr <span class="keyword">as</span> <span class="type">usize</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vpn</span> = va.<span class="title function_ invoke__">floor</span>();<span class="comment">//va-&gt;virt page num</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">ppn</span> = page_table.<span class="title function_ invoke__">translate</span>(vpn).<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">ppn</span>();</span><br><span class="line">	PhysAddr::<span class="title function_ invoke__">from</span>(ppn).<span class="number">0</span>+va.<span class="title function_ invoke__">page_offset</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由此可以得到的答案方法：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_get_time</span>(_ts: *<span class="keyword">mut</span> TimeVal, _tz: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_us</span> = <span class="title function_ invoke__">get_time_us</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ts</span>=<span class="title function_ invoke__">current_translated_physical_address</span>(_ts <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">u8</span>) <span class="keyword">as</span> *<span class="keyword">mut</span> TimeVal;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        *ts = TimeVal &#123;</span><br><span class="line">            sec: _us / <span class="number">1_000_000</span>,</span><br><span class="line">            usec: _us % <span class="number">1_000_000</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_task_info</span>(ti: *<span class="keyword">mut</span> TaskInfo) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_ti</span> = <span class="title function_ invoke__">current_translated_physical_address</span>(ti <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">u8</span>) <span class="keyword">as</span> *<span class="keyword">mut</span> TaskInfo;</span><br><span class="line">    trace!(<span class="string">&quot;kernel: sys_task_info&quot;</span>);</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        *_ti = TaskInfo &#123;</span><br><span class="line">            status: <span class="title function_ invoke__">get_current_status</span>(),</span><br><span class="line">            syscall_times: <span class="title function_ invoke__">get_syscall_times</span>(),</span><br><span class="line">            time:(<span class="title function_ invoke__">get_time_us</span>()-<span class="title function_ invoke__">get_current_start_time</span>())/<span class="number">1000</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现-mmap和munmap"><a href="#实现-mmap和munmap" class="headerlink" title="实现 mmap和munmap"></a>实现 mmap和munmap</h4><p>我们观察到，MemorySet函数有如下方法：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">insert_framed_area</span>(</span><br><span class="line">    &amp;<span class="keyword">mut</span> <span class="keyword">self</span>,</span><br><span class="line">    start_va: VirtAddr,</span><br><span class="line">    end_va: VirtAddr,</span><br><span class="line">    permission: MapPermission,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">self</span>.<span class="title function_ invoke__">push</span>(</span><br><span class="line">        MapArea::<span class="title function_ invoke__">new</span>(start_va, end_va, MapType::Framed, permission),</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法与我们要实现的函数参数基本一致，因此我们把它作为主体函数，同时，不要忘了对特殊情况进行排查，最终我们的实现方法如下：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">MemorySet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">mmap</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,start:<span class="type">usize</span>,len:<span class="type">usize</span>,port:<span class="type">usize</span>)<span class="punctuation">-&gt;</span><span class="type">isize</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> start % PAGE_SIZE != <span class="number">0</span> </span><br><span class="line">        <span class="comment">/* start need to be page aligned */</span> </span><br><span class="line">        || port &amp; !<span class="number">0x7</span> != <span class="number">0</span> </span><br><span class="line">        <span class="comment">/* other bits of port needs to be zero */</span> </span><br><span class="line">        ||port &amp; <span class="number">0x7</span> ==<span class="number">0</span> </span><br><span class="line">        <span class="comment">/* No permission set, meaningless */</span> </span><br><span class="line">        ||start &gt;= MAXVA</span><br><span class="line">        <span class="comment">/* mapping range should be an legal address */</span> </span><br><span class="line">        &#123;<span class="keyword">return</span> -<span class="number">1</span>;&#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vpnrange</span> =VPNRange::<span class="title function_ invoke__">new</span>(VirtAddr::<span class="title function_ invoke__">from</span>(start).<span class="title function_ invoke__">floor</span>(),VirtAddr::<span class="title function_ invoke__">from</span>(start+len).<span class="title function_ invoke__">ceil</span>());</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">vpn</span> <span class="keyword">in</span> vpnrange&#123;</span><br><span class="line">    		<span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(pte) = <span class="keyword">self</span>.page_table.<span class="title function_ invoke__">find_pte</span>(vpn)&#123;</span><br><span class="line">    			<span class="keyword">if</span> pte.<span class="title function_ invoke__">is_valid</span>()&#123;</span><br><span class="line">    				<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    			&#125;</span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map_prem</span> = MapPermission::U;</span><br><span class="line">    	<span class="keyword">if</span> (port &amp; <span class="number">1</span>)!=<span class="number">0</span>&#123;</span><br><span class="line">    		map_prem|=MapPermission::R;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">if</span> (port &amp; <span class="number">2</span>)!=<span class="number">0</span>&#123;</span><br><span class="line">    		map_prem|=MapPermission::W;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">if</span> (port &amp; <span class="number">4</span>)!=<span class="number">0</span>&#123;</span><br><span class="line">    		map_prem|=MapPermission::X;</span><br><span class="line">    	&#125;		  			<span class="keyword">self</span>.<span class="title function_ invoke__">insert_framed_area</span>(VirtAddr::<span class="title function_ invoke__">from</span>(start),VirtAddr::<span class="title function_ invoke__">from</span>(start+len),map_prem);</span><br><span class="line">    	<span class="number">0</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>此后,由系统调用函数直接调用当前进程的MemorySet的该方法即可。</p>
<p>同样，我们也可以在MemorySet中加入munmap方法：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">MemorySet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">munmap</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,start:<span class="type">usize</span>,len:<span class="type">usize</span>)<span class="punctuation">-&gt;</span><span class="type">isize</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> start &gt;= MAXVA || start % PAGE_SIZE != <span class="number">0</span> &#123;<span class="keyword">return</span> -<span class="number">1</span>;&#125;</span><br><span class="line">    	<span class="keyword">let</span> <span class="variable">vpnrange</span> = VPNRange::<span class="title function_ invoke__">new</span>(VirtAddr::<span class="title function_ invoke__">from</span>(start).<span class="title function_ invoke__">floor</span>(),VirtAddr::<span class="title function_ invoke__">from</span>(start+len).<span class="title function_ invoke__">ceil</span>());</span><br><span class="line">    	<span class="keyword">for</span> <span class="variable">vpn</span> <span class="keyword">in</span> vpnrange&#123;</span><br><span class="line">    		<span class="keyword">let</span> <span class="variable">pte</span> = <span class="keyword">self</span>.page_table.<span class="title function_ invoke__">find_pte</span>(vpn);</span><br><span class="line">    		<span class="keyword">if</span> pte.<span class="title function_ invoke__">is_none</span>() || !pte.<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">is_valid</span>()&#123;</span><br><span class="line">    			<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">for</span> <span class="variable">vpn</span> <span class="keyword">in</span> vpnrange&#123;</span><br><span class="line">    		<span class="keyword">for</span> <span class="variable">area</span> <span class="keyword">in</span> &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.areas&#123;</span><br><span class="line">    			<span class="keyword">if</span> vpn &lt; area.vpn_range.<span class="title function_ invoke__">get_end</span>() &amp;&amp; vpn &gt;= area.vpn_range.<span class="title function_ invoke__">get_start</span>()&#123;</span><br><span class="line">    				area.<span class="title function_ invoke__">unmap_one</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.page_table,vpn);</span><br><span class="line">    			&#125;</span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="number">0</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>第二个循环不仅取消了页表的映射，而且消除了对应的MapArea中对应的键值对，如此才能保证结构的一致性。</p>
<h3 id="运行结果-2"><a href="#运行结果-2" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240525214501761.png" alt="image-20240525214501761"></p>
<h1 id="lab5"><a href="#lab5" class="headerlink" title="lab5"></a>lab5</h1><h2 id="编程作业-4"><a href="#编程作业-4" class="headerlink" title="编程作业"></a>编程作业</h2><h3 id="总结编程内容-4"><a href="#总结编程内容-4" class="headerlink" title="总结编程内容"></a>总结编程内容</h3><h4 id="编程作业一-完成sys-spawn函数"><a href="#编程作业一-完成sys-spawn函数" class="headerlink" title="编程作业一:完成sys_spawn函数"></a>编程作业一:完成sys_spawn函数</h4><p>借鉴fork()和exec()的过程，我们可以看到spawn()只需要进行如下几步即可：</p>
<ol>
<li>根据exec()中的参数创建新的地址空间memory_set。</li>
<li>创建新的TaskControlBlock，模仿fork()进行初始化赋值工作，除了把复制地址空间的操作修改为把地址空间赋值为memory_set。</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">sys_spawn</span>(_path: *<span class="keyword">const</span> <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">isize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">current_task</span> = <span class="title function_ invoke__">current_task</span>();</span><br><span class="line">    <span class="keyword">if</span> current_task.<span class="title function_ invoke__">is_none</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">current_task</span> = current_task.<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current_inner</span> = current_task.<span class="title function_ invoke__">inner_exclusive_access</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">token</span> = current_inner.memory_set.<span class="title function_ invoke__">token</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">path</span> = <span class="title function_ invoke__">translated_str</span>(token, _path);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(data) = <span class="title function_ invoke__">get_app_data_by_name</span>(path.<span class="title function_ invoke__">as_str</span>()) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">child_block</span> = Arc::<span class="title function_ invoke__">new</span>(TaskControlBlock::<span class="title function_ invoke__">new</span>(data));</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">child_inner</span> = child_block.<span class="title function_ invoke__">inner_exclusive_access</span>();</span><br><span class="line">        child_inner.parent = <span class="title function_ invoke__">Some</span>(Arc::<span class="title function_ invoke__">downgrade</span>(&amp;current_task));</span><br><span class="line">        current_inner.children.<span class="title function_ invoke__">push</span>(child_block.<span class="title function_ invoke__">clone</span>());</span><br><span class="line">        <span class="title function_ invoke__">add_task</span>(child_block.<span class="title function_ invoke__">clone</span>());</span><br><span class="line">        <span class="keyword">return</span> child_block.pid.<span class="number">0</span> <span class="keyword">as</span> <span class="type">isize</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    -<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编程作业二：stride-调度算法"><a href="#编程作业二：stride-调度算法" class="headerlink" title="编程作业二：stride 调度算法"></a>编程作业二：stride 调度算法</h4><ol>
<li><p>在TCB中增加新字段</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(elf_data: &amp;[<span class="type">u8</span>]) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">		……</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">task_control_block</span> = <span class="keyword">Self</span> &#123;</span><br><span class="line">            pid: pid_handle,</span><br><span class="line">            kernel_stack,</span><br><span class="line">            inner: <span class="keyword">unsafe</span> &#123;</span><br><span class="line">                UPSafeCell::<span class="title function_ invoke__">new</span>(TaskControlBlockInner &#123;</span><br><span class="line">                    trap_cx_ppn,</span><br><span class="line">                    base_size: user_sp,</span><br><span class="line">                    task_cx: TaskContext::<span class="title function_ invoke__">goto_trap_return</span>(kernel_stack_top),</span><br><span class="line">                    task_status: TaskStatus::Ready,</span><br><span class="line">                    memory_set,</span><br><span class="line">                    parent: <span class="literal">None</span>,</span><br><span class="line">                    children: <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">                    exit_code: <span class="number">0</span>,</span><br><span class="line">                    heap_bottom: user_sp,</span><br><span class="line">                    program_brk: user_sp,</span><br><span class="line">                    task_start_time: <span class="number">0</span>,</span><br><span class="line">                    task_syscall_times: [<span class="number">0</span>; MAX_SYSCALL_NUM],</span><br><span class="line">                    stride: <span class="number">0</span>,</span><br><span class="line">                    priority: <span class="number">16</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意之后修改所有与TCB赋值和初始化有关的操作</p>
</li>
<li><p>在每次 fetch 下一个 task 之前对这个队列中的 task 做检查， 找到最小的 stride。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">=<span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">fetch</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;Arc&lt;TaskControlBlock&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">min_index</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">min_stride</span> = <span class="number">0x7FFF_FFFF</span>;</span><br><span class="line">        <span class="keyword">for</span> (idx, task) <span class="keyword">in</span> <span class="keyword">self</span>.ready_queue.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>()		  &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">inner</span> = task.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">            <span class="keyword">if</span> inner.task_status == TaskStatus::Ready &#123;</span><br><span class="line">                <span class="keyword">if</span> inner.stride &lt; min_stride &#123;</span><br><span class="line">                    min_stride = inner.stride;</span><br><span class="line">                    min_index = idx;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(task) = <span class="keyword">self</span>.ready_queue.<span class="title function_ invoke__">get</span>(min_index) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">inner</span> = task.inner.<span class="title function_ invoke__">exclusive_access</span>();</span><br><span class="line">            inner.stride += BIG_STRIDE / inner.priority;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.ready_queue.<span class="title function_ invoke__">remove</span>(min_index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="运行截图-1"><a href="#运行截图-1" class="headerlink" title="运行截图"></a>运行截图</h3><h4 id="lab3测例检查"><a href="#lab3测例检查" class="headerlink" title="lab3测例检查"></a>lab3测例检查</h4><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240526173032754.png" alt="image-20240526173032754"></p>
<h4 id="lab4测例检查"><a href="#lab4测例检查" class="headerlink" title="lab4测例检查"></a>lab4测例检查</h4><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240526173119390.png" alt="image-20240526173119390"></p>
<h4 id="lab5测例检查"><a href="#lab5测例检查" class="headerlink" title="lab5测例检查"></a>lab5测例检查</h4><ol>
<li><p>编程作业一:完成sys_spawn函数</p>
<p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240526173236555.png" alt="image-20240526173236555"></p>
</li>
<li><p>编程作业二：stride 调度算法</p>
<p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240526173252748.png" alt="image-20240526173252748"></p>
</li>
</ol>
<p>1386266&#x2F;1292240 &#x3D; 0.995&lt;1.5 通过测例</p>
<h4 id="所有测例检查"><a href="#所有测例检查" class="headerlink" title="所有测例检查"></a>所有测例检查</h4><p><img src="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/image-20240526173620130.png" alt="image-20240526173620130"></p>
<h2 id="问答作业-3"><a href="#问答作业-3" class="headerlink" title="问答作业"></a>问答作业</h2><h3 id="fork-exec-的一个比较大的问题是-fork-之后的内存页-文件等资源完全没有使用就废弃了，针对这一点，有什么改进策略？"><a href="#fork-exec-的一个比较大的问题是-fork-之后的内存页-文件等资源完全没有使用就废弃了，针对这一点，有什么改进策略？" class="headerlink" title="fork + exec 的一个比较大的问题是 fork 之后的内存页&#x2F;文件等资源完全没有使用就废弃了，针对这一点，有什么改进策略？"></a>fork + exec 的一个比较大的问题是 fork 之后的内存页&#x2F;文件等资源完全没有使用就废弃了，针对这一点，有什么改进策略？</h3><p><strong>Answer:</strong></p>
<ol>
<li><p>使用 Copy-on-Write（写时复制）技术：在 fork 时，父子进程共享相同的内存页，直到其中一个进程试图对共享内存进行写操作时，才会复制出一个新的内存页。这样可以避免不必要的内存复制，减少资源浪费。</p>
</li>
<li><p>非阻塞地执行 fork 和 exec：在执行 fork 和 exec 时，可以考虑使用异步方式，即父进程继续执行，而子进程在需要时再进行资源初始化和 exec 调用。这样可以避免不必要的资源浪费，提高系统的资源利用率。</p>
</li>
<li><p>考虑使用其他机制替代 fork 和 exec：有些情况下，可以考虑使用线程或者其他机制来实现类似的功能，避免不必要的资源复制和浪费。</p>
</li>
</ol>
<h3 id="选做，不占分-其实使用了题-1-的策略之后，fork-exec-所带来的无效资源的问题已经基本被解决了，但是近年来-fork-还是在被不断的批判，那么到底是什么正在”杀死”fork？可以参考-论文-。"><a href="#选做，不占分-其实使用了题-1-的策略之后，fork-exec-所带来的无效资源的问题已经基本被解决了，但是近年来-fork-还是在被不断的批判，那么到底是什么正在”杀死”fork？可以参考-论文-。" class="headerlink" title="[选做，不占分]其实使用了题(1)的策略之后，fork + exec 所带来的无效资源的问题已经基本被解决了，但是近年来 fork 还是在被不断的批判，那么到底是什么正在”杀死”fork？可以参考 论文 。"></a>[选做，不占分]其实使用了题(1)的策略之后，fork + exec 所带来的无效资源的问题已经基本被解决了，但是近年来 fork 还是在被不断的批判，那么到底是什么正在”杀死”fork？可以参考 <a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/research/uploads/prod/2019/04/fork-hotos19.pdf">论文</a> 。</h3><p><strong>Answer:</strong></p>
<p>fork 和其他的操作不正交,也就是 os 每增加一个功能,都要改 fork, 这导致新功能开发困难,设计受限.有些和硬件相关的甚至根本无法支持 fork.</p>
<p>fork 得到的父子进程可能产生共享资源的冲突；</p>
<p>子进程继承父进程，如果父进程处理不当，子进程可以找到父进程的安全漏洞进而威胁父进程；</p>
<p>还有比如 fork 必须要虚存, SAS 无法支持等等.</p>
<h3 id="请阅读下列代码，并分析程序的输出，假定不发生运行错误，不考虑行缓冲："><a href="#请阅读下列代码，并分析程序的输出，假定不发生运行错误，不考虑行缓冲：" class="headerlink" title="请阅读下列代码，并分析程序的输出，假定不发生运行错误，不考虑行缓冲："></a>请阅读下列代码，并分析程序的输出，假定不发生运行错误，不考虑行缓冲：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int main()&#123;</span><br><span class="line">    int val = 2;</span><br><span class="line"></span><br><span class="line">    printf(&quot;%d&quot;, 0);</span><br><span class="line">    int pid = fork();</span><br><span class="line">    if (pid == 0) &#123;</span><br><span class="line">        val++;</span><br><span class="line">        printf(&quot;%d&quot;, val);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        val--;</span><br><span class="line">        printf(&quot;%d&quot;, val);</span><br><span class="line">        wait(NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    val++;</span><br><span class="line">    printf(&quot;%d&quot;, val);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 fork() 之后主程序先运行，则结果如何？如果 fork() 之后 child 先运行，则结果如何？</p>
<p><strong>Answer:</strong></p>
<ol>
<li>主程序先运行:01342</li>
<li>child 先运行:03412</li>
</ol>
<h3 id="选做，不占分-更进一步，如果给出一个-的序列，如何设计一个程序来得到答案？"><a href="#选做，不占分-更进一步，如果给出一个-的序列，如何设计一个程序来得到答案？" class="headerlink" title="[选做，不占分] 更进一步，如果给出一个 &amp;&amp; || 的序列，如何设计一个程序来得到答案？"></a>[选做，不占分] 更进一步，如果给出一个 <code>&amp;&amp;</code> <code>||</code> 的序列，如何设计一个程序来得到答案？</h3><p><strong>Anser:</strong></p>
<p>如果需要设计一个程序以及给定一个 <code>&amp;&amp;</code> <code>||</code> 的序列，来计算输出的数量，可以考虑使用递归的方式实现。每次调用递归函数时，根据当前操作符是 <code>&amp;&amp;</code> 还是 <code>||</code>，分别判断左右子表达式的结果，从而更新当前表达式的计算结果。通过递归调用，可以一步步计算出最终的结果，得到预期的输出数量。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 enum 来表示操作符的类型</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Operator</span> &#123;</span> AND = <span class="number">0</span>, OR = <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归计算并输出 &#x27;A&#x27; 的数量</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">evaluateExpression</span><span class="params">(<span class="type">int</span>* sequence, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (start == end) &#123;</span><br><span class="line">        <span class="keyword">return</span> sequence[start];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> op = sequence[start];  <span class="comment">// 当前操作符</span></span><br><span class="line">    <span class="type">int</span> countA = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (op == AND) &#123;</span><br><span class="line">        <span class="comment">// 递归计算左右子表达式</span></span><br><span class="line">        <span class="type">int</span> left = evaluateExpression(sequence, start + <span class="number">1</span>, end);</span><br><span class="line">        <span class="type">int</span> right = evaluateExpression(sequence, left + <span class="number">1</span>, end);</span><br><span class="line">        <span class="comment">// 计算并返回 &#x27;A&#x27; 的数量</span></span><br><span class="line">        countA = left + right;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == OR) &#123;</span><br><span class="line">        <span class="comment">// 递归计算左子表达式</span></span><br><span class="line">        <span class="type">int</span> left = evaluateExpression(sequence, start + <span class="number">1</span>, end);</span><br><span class="line">        <span class="comment">// 递归计算右子表达式</span></span><br><span class="line">        <span class="type">int</span> right = evaluateExpression(sequence, left + <span class="number">1</span>, end);</span><br><span class="line">        <span class="comment">// 计算并返回 &#x27;A&#x27; 的数量</span></span><br><span class="line">        countA = left &gt; right ? left : right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> countA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> sequence[] = &#123;AND, AND, OR, AND, OR, AND&#125;;</span><br><span class="line">    <span class="type">int</span> result = evaluateExpression(sequence, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Total count of &#x27;A&#x27;: %d\n&quot;</span>, result);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="stride-算法深入"><a href="#stride-算法深入" class="headerlink" title="stride 算法深入"></a>stride 算法深入</h3><p>stride 算法原理非常简单，但是有一个比较大的问题。例如两个 pass &#x3D; 10 的进程，使用 8bit 无符号整形储存  stride， p1.stride &#x3D; 255, p2.stride &#x3D; 250，在 p2 执行一个时间片后，理论上下一次应该 p1 执行。</p>
<h4 id="实际情况是轮到-p1-执行吗？为什么？"><a href="#实际情况是轮到-p1-执行吗？为什么？" class="headerlink" title="实际情况是轮到 p1 执行吗？为什么？"></a>实际情况是轮到 p1 执行吗？为什么？</h4><p><strong>Answer</strong>: 实际情况还是p2执⾏，因为8位⽆符号整型取值范围是0-255，如果p2.stride加了10溢出了，变成了4，对⽐的时候还是⽐p1.stride⼩，所以还是p2执⾏。</p>
<p>我们之前要求进程优先级 &gt;&#x3D; 2 其实就是为了解决这个问题。可以证明，<strong>在不考虑溢出的情况下</strong>, 在进程优先级全部 &gt;&#x3D; 2 的情况下，如果严格按照算法执行，那么 STRIDE_MAX – STRIDE_MIN &lt;&#x3D; BigStride &#x2F; 2。</p>
<h4 id="为什么？尝试简单说明（传达思想即可，不要求严格证明）。"><a href="#为什么？尝试简单说明（传达思想即可，不要求严格证明）。" class="headerlink" title="为什么？尝试简单说明（传达思想即可，不要求严格证明）。"></a>为什么？尝试简单说明（传达思想即可，不要求严格证明）。</h4><p>**Answer:**因为优先级全部⼤于等于2，所以pass⼀定是⼩于⼆分之⼀的BigStride。在不考虑溢出的情况下，假设a进程的stride⼩于b进程，且⼆者差⼩于⼆分之⼀BigStride，则a进程的stride + pass⼀定⼤于b，且新的差不会⼤于⼆分之⼀BigStride。开始时⼆者stride都为零，经过⼀次调度后满⾜上述情况，所以如此迭代下去，如果严格按照算法执⾏，那么STIDE_MAX-STRIDE_MIN&lt;&#x3D;BigStride&#x2F;2成⽴。</p>
<p>已知以上结论，<strong>考虑溢出的情况下</strong>，我们可以通过设计 Stride 的比较接口，结合 BinaryHeap 的 pop 接口可以很容易的找到真正最小的 Stride。</p>
<h4 id="请补全如下-partial-cmp-函数（假设永远不会相等）"><a href="#请补全如下-partial-cmp-函数（假设永远不会相等）" class="headerlink" title="请补全如下 partial_cmp 函数（假设永远不会相等）"></a>请补全如下 <code>partial_cmp</code> 函数（假设永远不会相等）</h4> <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> core::cmp::Ordering;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Stride</span>(<span class="type">u64</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">PartialOrd</span> <span class="keyword">for</span> <span class="title class_">Stride</span> &#123;</span><br><span class="line">  <span class="keyword">fn</span> <span class="title function_">partial_cmp</span>(&amp;<span class="keyword">self</span>, other: &amp;<span class="keyword">Self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;Ordering&gt; &#123;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">PartialEq</span> <span class="keyword">for</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">fn</span> <span class="title function_">eq</span>(&amp;<span class="keyword">self</span>, other: &amp;<span class="keyword">Self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">     <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Answer:</strong></p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">fn</span> <span class="title function_">partial_cmp</span>(&amp;<span class="keyword">self</span>, other: &amp;<span class="keyword">Self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;Ordering&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">self</span>.<span class="number">0</span> &lt; other.<span class="number">0</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (other.<span class="number">0</span> - <span class="keyword">self</span>.<span class="number">0</span>) &gt; (BigStride / <span class="number">2</span>) &#123;</span><br><span class="line">              <span class="title function_ invoke__">Some</span>(Ording::Greater)</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="title function_ invoke__">Some</span>(Ording::Less)</span><br><span class="line">       &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">self</span>.<span class="number">0</span> &gt; other.<span class="number">0</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">self</span>.<span class="number">0</span> - other.<span class="number">0</span>) &gt; (BigStride / <span class="number">2</span>) &#123;</span><br><span class="line">              <span class="title function_ invoke__">Some</span>(Ording::Less)</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="title function_ invoke__">Some</span>(Ording::Greater)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>例如使用 8 bits 存储 stride, BigStride = 255, 则:

- (125 &lt; 255) == false
- (129 &lt; 255) == true
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C/" class="post-title-link" itemprop="url">数据库实验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-06 11:14:26 / 修改时间：11:25:11" itemprop="dateCreated datePublished" datetime="2025-04-06T11:14:26+08:00">2025-04-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="实验项目一"><a href="#实验项目一" class="headerlink" title="实验项目一"></a>实验项目一</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE 实验项目一;</span><br><span class="line">USE 实验项目一;</span><br></pre></td></tr></table></figure>

<h3 id="创建后面给出的这6个表（20分）"><a href="#创建后面给出的这6个表（20分）" class="headerlink" title="创建后面给出的这6个表（20分）"></a>创建后面给出的这6个表（20分）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- 读者信息表</span><br><span class="line">CREATE TABLE 读者信息表 (</span><br><span class="line">    借书证号 CHAR(8) PRIMARY KEY,</span><br><span class="line">    姓名 VARCHAR(50),</span><br><span class="line">    性别 ENUM(&#x27;女&#x27;, &#x27;男&#x27;),</span><br><span class="line">    出生日期 DATE,</span><br><span class="line">    借书量 INT DEFAULT 0,</span><br><span class="line">    工作单位 VARCHAR(100),</span><br><span class="line">    电话 CHAR(11),</span><br><span class="line">    电子邮件 VARCHAR(50)</span><br><span class="line">);  </span><br><span class="line">INSERT INTO 读者信息表 (借书证号, 姓名, 性别, 出生日期, 借书量, 工作单位, 电话, 电子邮件)</span><br><span class="line">VALUES</span><br><span class="line">    (&#x27;29307142&#x27;, &#x27;张晓露&#x27;, &#x27;女&#x27;, &#x27;1989-02-01&#x27;, 2, &#x27;管理信息系&#x27;, &#x27;85860126&#x27;, &#x27;zxl@163.com&#x27;),</span><br><span class="line">    (&#x27;36405216&#x27;, &#x27;李阳&#x27;, &#x27;男&#x27;, &#x27;1988-12-26&#x27;, 1, &#x27;航海系&#x27;, &#x27;85860729&#x27;, &#x27;ly@sina.com.cn&#x27;),</span><br><span class="line">    (&#x27;28308208&#x27;, &#x27;王新全&#x27;, &#x27;男&#x27;, &#x27;1988-04-25&#x27;, 1, &#x27;人文艺术系&#x27;, &#x27;85860618&#x27;, &#x27;wxq@yahoo.cn&#x27;),</span><br><span class="line">    (&#x27;16406236&#x27;, &#x27;张继刚&#x27;, &#x27;男&#x27;, &#x27;1989-08-18&#x27;, 1, &#x27;轮机工程系&#x27;, &#x27;85860913&#x27;, &#x27;zjg@163.com&#x27;);</span><br><span class="line">INSERT INTO readerMessage (借书证号, 姓名, 性别, 出生日期,  工作单位, 电话, 电子邮件)</span><br><span class="line">VALUES</span><br><span class="line">	(&#x27;16406247&#x27;, &#x27;顾一帆&#x27;, &#x27;男&#x27;, &#x27;1981-12-30&#x27;, &#x27;轮机工程系&#x27;, &#x27;85860916&#x27;, &#x27;gyf@yahoo.cn&#x27;);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>借书证号</th>
<th>姓名</th>
<th>性别</th>
<th>出生日期</th>
<th>借书量</th>
<th>工作单位</th>
<th>电话</th>
<th>E-mail</th>
</tr>
</thead>
<tbody><tr>
<td>29307142</td>
<td>张晓露</td>
<td>女</td>
<td>1989-02-1</td>
<td>2</td>
<td>管理信息系</td>
<td>85860126</td>
<td><a href="mailto:&#122;&#120;&#x6c;&#x40;&#49;&#x36;&#x33;&#46;&#x63;&#x6f;&#x6d;">zxl@163.com</a></td>
</tr>
<tr>
<td>36405216</td>
<td>李阳</td>
<td>男</td>
<td>1988-12-26</td>
<td>1</td>
<td>航海系</td>
<td>85860729</td>
<td><a href="mailto:&#108;&#x79;&#64;&#x73;&#105;&#110;&#x61;&#x2e;&#x63;&#111;&#109;&#46;&#99;&#x6e;">ly@sina.com.cn</a></td>
</tr>
<tr>
<td>28308208</td>
<td>王新全</td>
<td>男</td>
<td>1988-04-25</td>
<td>1</td>
<td>人文艺术系</td>
<td>85860618</td>
<td><a href="mailto:&#119;&#x78;&#113;&#x40;&#121;&#x61;&#104;&#111;&#111;&#46;&#99;&#110;">wxq@yahoo.cn</a></td>
</tr>
<tr>
<td>16406236</td>
<td>张继刚</td>
<td>男</td>
<td>1989-08-18</td>
<td>1</td>
<td>轮机工程系</td>
<td>85860913</td>
<td><a href="mailto:&#122;&#106;&#103;&#x40;&#49;&#54;&#51;&#46;&#x63;&#111;&#x6d;">zjg@163.com</a></td>
</tr>
<tr>
<td>16406247</td>
<td>顾一帆</td>
<td>男</td>
<td>1981-12-30</td>
<td></td>
<td>轮机工程系</td>
<td>85860916</td>
<td><a href="mailto:&#x67;&#x79;&#102;&#64;&#121;&#x61;&#x68;&#111;&#x6f;&#46;&#99;&#110;">gyf@yahoo.cn</a></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 借还明细表</span><br><span class="line">CREATE TABLE 借还明细表 (</span><br><span class="line">    借书证号 VARCHAR(10),</span><br><span class="line">    图书编号 VARCHAR(10),</span><br><span class="line">    借还状态 ENUM(&#x27;还&#x27;,&#x27;借&#x27;),</span><br><span class="line">    借书日期 DATE,</span><br><span class="line">    还书日期 DATE,</span><br><span class="line">    数量 INT,</span><br><span class="line">    工号 VARCHAR(10),</span><br><span class="line">    CONSTRAINT check_borrow_date CHECK (借书日期 &lt;= &#x27;2024-12-31&#x27;),</span><br><span class="line">    FOREIGN KEY (借书证号) REFERENCES 读者信息表(借书证号)</span><br><span class="line">);</span><br><span class="line">INSERT INTO 借还明细表 (借书证号, 图书编号, 借还状态, 借书日期, 还书日期, 数量, 工号)</span><br><span class="line">VALUES</span><br><span class="line">    (&#x27;29307142&#x27;, &#x27;07108667&#x27;, &#x27;还&#x27;, &#x27;2008-03-28&#x27;, &#x27;2008-04-14&#x27;, 1, &#x27;002016&#x27;),</span><br><span class="line">    (&#x27;29307142&#x27;, &#x27;99011818&#x27;, &#x27;借&#x27;, &#x27;2008-04-27&#x27;, NULL, 1, &#x27;002016&#x27;),</span><br><span class="line">    (&#x27;36405216&#x27;, &#x27;07410802&#x27;, &#x27;借&#x27;, &#x27;2008-04-27&#x27;, NULL, 1, &#x27;002018&#x27;),</span><br><span class="line">    (&#x27;29307142&#x27;, &#x27;07410298&#x27;, &#x27;借&#x27;, &#x27;2008-04-28&#x27;, NULL, 1, &#x27;002018&#x27;),</span><br><span class="line">    (&#x27;36405216&#x27;, &#x27;00000746&#x27;, &#x27;还&#x27;, &#x27;2008-04-29&#x27;, &#x27;2008-05-09&#x27;, 1, &#x27;002016&#x27;),</span><br><span class="line">    (&#x27;28308208&#x27;, &#x27;07410139&#x27;, &#x27;借&#x27;, &#x27;2008-05-10&#x27;, NULL, 1, &#x27;002019&#x27;),</span><br><span class="line">    (&#x27;16406236&#x27;, &#x27;07410139&#x27;, &#x27;借&#x27;, &#x27;2008-05-11&#x27;, NULL, 1, &#x27;002017&#x27;);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>借书证号</th>
<th>图书编号</th>
<th>借&#x2F;还</th>
<th>借书日期</th>
<th>还书日期</th>
<th>数量</th>
<th>工号</th>
</tr>
</thead>
<tbody><tr>
<td>29307142</td>
<td>07108667</td>
<td>还</td>
<td>2008-03-28</td>
<td>2008-04-14</td>
<td>1</td>
<td>002016</td>
</tr>
<tr>
<td>29307142</td>
<td>99011818</td>
<td>借</td>
<td>2008-04-27</td>
<td></td>
<td>1</td>
<td>002016</td>
</tr>
<tr>
<td>36405216</td>
<td>07410802</td>
<td>借</td>
<td>2008-04-27</td>
<td></td>
<td>1</td>
<td>002018</td>
</tr>
<tr>
<td>29307142</td>
<td>07410298</td>
<td>借</td>
<td>2008-04-28</td>
<td></td>
<td>1</td>
<td>002018</td>
</tr>
<tr>
<td>36405216</td>
<td>00000746</td>
<td>还</td>
<td>2008-04-29</td>
<td>2008-05-09</td>
<td>1</td>
<td>002016</td>
</tr>
<tr>
<td>28308208</td>
<td>07410139</td>
<td>借</td>
<td>2008-05-10</td>
<td></td>
<td>1</td>
<td>002019</td>
</tr>
<tr>
<td>16406236</td>
<td>07410139</td>
<td>借</td>
<td>2008-05-11</td>
<td></td>
<td>1</td>
<td>002017</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- 图书类别</span><br><span class="line">CREATE TABLE 图书类别表 (</span><br><span class="line">	类别号 CHAR(10) ,</span><br><span class="line">	图书类别 CHAR(10)</span><br><span class="line">);</span><br><span class="line">INSERT INTO 图书类别表 (类别号,图书类别)</span><br><span class="line">VALUES</span><br><span class="line">	(&#x27;H31&#x27;,&#x27;英语&#x27;),</span><br><span class="line">	(&#x27;I267&#x27;,&#x27;当代作品&#x27;),</span><br><span class="line">	(&#x27;TP312&#x27;,&#x27;程序语言&#x27;),</span><br><span class="line">	(&#x27;TP393&#x27;,&#x27;计算机网络&#x27;),</span><br><span class="line">	(&#x27;U66&#x27;,&#x27;船舶工程&#x27;);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>类别号</th>
<th>图书类别</th>
</tr>
</thead>
<tbody><tr>
<td>H31</td>
<td>英语</td>
</tr>
<tr>
<td>I267</td>
<td>当代作品</td>
</tr>
<tr>
<td>TP312</td>
<td>程序语言</td>
</tr>
<tr>
<td>TP393</td>
<td>计算机网络</td>
</tr>
<tr>
<td>U66</td>
<td>船舶工程</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 图书借阅表</span><br><span class="line">CREATE TABLE 图书借阅表(</span><br><span class="line">    图书编号 VARCHAR(10),</span><br><span class="line">    图书名称 CHAR(20),</span><br><span class="line">    借书证号 CHAR(8),</span><br><span class="line">    借出日期 DATE,</span><br><span class="line">    归还日期 DATE,</span><br><span class="line">    库存数 INT,</span><br><span class="line">    CONSTRAINT check_borrow_date CHECK (借出日期 &lt;= &#x27;2024-12-31&#x27;),</span><br><span class="line">    FOREIGN KEY (图书编号) REFERENCES 图书明细表(图书编号),</span><br><span class="line">    FOREIGN KEY (借书证号) REFERENCES 读者信息表(借书证号)</span><br><span class="line">);</span><br><span class="line">INSERT INTO 图书借阅表(图书编号,图书名称,借书证号,借出日期,库存数)</span><br><span class="line">VALUES</span><br><span class="line">	(&#x27;99011818&#x27;,&#x27;文化苦旅&#x27;,&#x27;29307142&#x27;,&#x27;2008-04-27&#x27;,14),</span><br><span class="line">	(&#x27;07410802&#x27;,&#x27;航海英语&#x27;,&#x27;36405216&#x27;,&#x27;2008-04-27&#x27;,24),</span><br><span class="line">	(&#x27;07410298&#x27;,&#x27;C++程序设计语言&#x27;,&#x27;29307142&#x27;,&#x27;2008-04-28&#x27;,14),</span><br><span class="line">	(&#x27;07410139&#x27;,&#x27;艺海潮音&#x27;,&#x27;28308208&#x27;,&#x27;2008-05-10&#x27;,18),</span><br><span class="line">	(&#x27;07410139&#x27;,&#x27;艺海潮音&#x27;,&#x27;16406236&#x27;,&#x27;2008-05-11&#x27;,17);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>图书编号</th>
<th>图书名称</th>
<th>借书证号</th>
<th>借出日期</th>
<th>归还日期</th>
<th>库存数</th>
</tr>
</thead>
<tbody><tr>
<td>99011818</td>
<td>文化苦旅</td>
<td>29307142</td>
<td>2008-04-27</td>
<td></td>
<td>14</td>
</tr>
<tr>
<td>07410802</td>
<td>航海英语</td>
<td>36405216</td>
<td>2008-04-27</td>
<td></td>
<td>24</td>
</tr>
<tr>
<td>07410298</td>
<td>C++程序设计语言</td>
<td>29307142</td>
<td>2008-04-28</td>
<td></td>
<td>14</td>
</tr>
<tr>
<td>07410139</td>
<td>艺海潮音</td>
<td>28308208</td>
<td>2008-05-10</td>
<td></td>
<td>18</td>
</tr>
<tr>
<td>07410139</td>
<td>艺海潮音</td>
<td>16406236</td>
<td>2008-05-11</td>
<td></td>
<td>17</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 工作人员</span><br><span class="line">CREATE TABLE 工作人员 (</span><br><span class="line">    工号 VARCHAR(10) PRIMARY KEY,</span><br><span class="line">    姓名 VARCHAR(50),</span><br><span class="line">    性别 VARCHAR(10),</span><br><span class="line">    出生日期 DATE,</span><br><span class="line">    联系电话 VARCHAR(20),</span><br><span class="line">    E_mail VARCHAR(50), ,</span><br><span class="line">    CONSTRAINT check_birth_date CHECK (出生日期 &lt;= &#x27;2024-12-31&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO 工作人员 (工号, 姓名, 性别, 出生日期, 联系电话, E_mail)</span><br><span class="line">VALUES</span><br><span class="line">    (&#x27;002016&#x27;, &#x27;周学飞&#x27;, &#x27;男&#x27;, &#x27;1971-05-03&#x27;, &#x27;85860715&#x27;, &#x27;zxf@163.com&#x27;),</span><br><span class="line">    (&#x27;002017&#x27;, &#x27;李晓静&#x27;, &#x27;女&#x27;, &#x27;1979-09-15&#x27;, &#x27;85860716&#x27;, &#x27;lj@163.com&#x27;),</span><br><span class="line">    (&#x27;002018&#x27;, &#x27;顾彬&#x27;, &#x27;男&#x27;, &#x27;1972-04-25&#x27;, &#x27;85860717&#x27;, &#x27;gb@yahoo.cn&#x27;),</span><br><span class="line">    (&#x27;002019&#x27;, &#x27;陈欣&#x27;, &#x27;女&#x27;, &#x27;1968-11-03&#x27;, &#x27;85860718&#x27;, &#x27;cx@sina.com.cn&#x27;);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>工号</th>
<th>姓名</th>
<th>性别</th>
<th>出生日期</th>
<th>联系电话</th>
<th>E-mail</th>
</tr>
</thead>
<tbody><tr>
<td>002016</td>
<td>周学飞</td>
<td>男</td>
<td>1971-05-03</td>
<td>85860715</td>
<td><a href="mailto:&#x7a;&#x78;&#x66;&#64;&#x31;&#54;&#51;&#x2e;&#x63;&#x6f;&#109;">zxf@163.com</a></td>
</tr>
<tr>
<td>002017</td>
<td>李晓静</td>
<td>女</td>
<td>1979-09-15</td>
<td>85860716</td>
<td><a href="mailto:&#x6c;&#106;&#x40;&#49;&#x36;&#51;&#46;&#99;&#111;&#109;">lj@163.com</a></td>
</tr>
<tr>
<td>002018</td>
<td>顾彬</td>
<td>男</td>
<td>1972-04-25</td>
<td>85860717</td>
<td><a href="mailto:&#103;&#x62;&#64;&#121;&#97;&#x68;&#x6f;&#111;&#46;&#99;&#110;">gb@yahoo.cn</a></td>
</tr>
<tr>
<td>002019</td>
<td>陈欣</td>
<td>女</td>
<td>1968-11-03</td>
<td>85860718</td>
<td><a href="mailto:&#x63;&#120;&#x40;&#115;&#105;&#x6e;&#x61;&#x2e;&#x63;&#x6f;&#x6d;&#x2e;&#x63;&#x6e;">cx@sina.com.cn</a></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- 图书明细表 </span><br><span class="line">CREATE TABLE 图书明细表 (</span><br><span class="line">    类别号 VARCHAR(10),</span><br><span class="line">    图书编号 VARCHAR(10) PRIMARY KEY,</span><br><span class="line">    图书名称 VARCHAR(50),</span><br><span class="line">    作者 VARCHAR(50),</span><br><span class="line">    出版社 VARCHAR(50),</span><br><span class="line">    定价 DECIMAL(10, 2),</span><br><span class="line">    购进日期 DATE,</span><br><span class="line">    购入数 INT,</span><br><span class="line">    复本数 INT,</span><br><span class="line">    库存数 INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO 图书明细表 (类别号, 图书编号, 图书名称, 作者, 出版社, 定价, 购进日期, 购入数, 复本数, 库存数)</span><br><span class="line">VALUES</span><br><span class="line">    (&#x27;I267&#x27;, &#x27;99011818&#x27;, &#x27;文化苦旅&#x27;, &#x27;余秋雨&#x27;, &#x27;知识出版社&#x27;, 16, &#x27;2000-03-19&#x27;, 8, 15, 14),</span><br><span class="line">    (&#x27;TP312&#x27;, &#x27;00000476&#x27;, &#x27;Delphi高级开发指南&#x27;, &#x27;坎图&#x27;, &#x27;电子工业出版社&#x27;, 80, &#x27;2000-03-19&#x27;, 15, 15, 15),</span><br><span class="line">    (&#x27;U66&#x27;, &#x27;01058589&#x27;, &#x27;船舶制造基础&#x27;, &#x27;杨敏&#x27;, &#x27;国防工业出版社&#x27;, 19, &#x27;2001-07-15&#x27;, 20, 20, 20),</span><br><span class="line">    (&#x27;I267&#x27;, &#x27;07410139&#x27;, &#x27;艺海潮音&#x27;, &#x27;李叔&#x27;, &#x27;江苏文艺出版社&#x27;, 19, &#x27;2007-04-12&#x27;, 15, 20, 18),</span><br><span class="line">    (&#x27;TP312&#x27;, &#x27;07410298&#x27;, &#x27;C++程序设计&#x27;, &#x27;成颖&#x27;, &#x27;东南大学出版社&#x27;, 38, &#x27;2007-05-08&#x27;, 10, 15, 14),</span><br><span class="line">    (&#x27;H31&#x27;, &#x27;07410802&#x27;, &#x27;航海英语&#x27;, &#x27;陈宏权&#x27;, &#x27;武汉工业大学出版社&#x27;, 42, &#x27;2007-10-20&#x27;, 25, 25, 24),</span><br><span class="line">    (&#x27;H31&#x27;, &#x27;07108667&#x27;, &#x27;大学英语学习辅导&#x27;, &#x27;姜丽蓉&#x27;, &#x27;北京理工大学出版社&#x27;, 23.5, &#x27;2008-02-06&#x27;, 25, 25, 25),</span><br><span class="line">    (&#x27;TP393&#x27;, &#x27;07410810&#x27;, &#x27;网络工程实用教程&#x27;, &#x27;汪新民&#x27;, &#x27;北京大学出版社&#x27;, 34.8, &#x27;2008-08-21&#x27;, 10, 15, 15);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>类别号</th>
<th>图书编号</th>
<th>图书名称</th>
<th>作者</th>
<th>出版社</th>
<th>定价</th>
<th>购进日期</th>
<th>购入数</th>
<th>复本数</th>
<th>库存数</th>
</tr>
</thead>
<tbody><tr>
<td>I267</td>
<td>99011818</td>
<td>文化苦旅</td>
<td>余秋雨</td>
<td>知识出版社</td>
<td>16</td>
<td>2000-03-19</td>
<td>8</td>
<td>15</td>
<td>14</td>
</tr>
<tr>
<td>TP312</td>
<td>00000476</td>
<td>Delphi高级开发指南</td>
<td>坎图</td>
<td>电子工业出版社</td>
<td>80</td>
<td>2000-03-19</td>
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
<tr>
<td>U66</td>
<td>01058589</td>
<td>船舶制造基础</td>
<td>杨敏</td>
<td>国防工业出版社</td>
<td>19</td>
<td>2001-07-15</td>
<td>20</td>
<td>20</td>
<td>20</td>
</tr>
<tr>
<td>I267</td>
<td>07410139</td>
<td>艺海潮音</td>
<td>李叔</td>
<td>江苏文艺出版社</td>
<td>19</td>
<td>2007-04-12</td>
<td>15</td>
<td>20</td>
<td>18</td>
</tr>
<tr>
<td>TP312</td>
<td>07410298</td>
<td>C++程序设计</td>
<td>成颖</td>
<td>东南大学出版社</td>
<td>38</td>
<td>2007-05-08</td>
<td>10</td>
<td>15</td>
<td>14</td>
</tr>
<tr>
<td>H31</td>
<td>07410802</td>
<td>航海英语</td>
<td>陈宏权</td>
<td>武汉工业大学出版社</td>
<td>42</td>
<td>2007-10-20</td>
<td>25</td>
<td>25</td>
<td>24</td>
</tr>
<tr>
<td>H31</td>
<td>07108667</td>
<td>大学英语学习辅导</td>
<td>姜丽蓉</td>
<td>北京理工大学出版社</td>
<td>23.5</td>
<td>2008-02-06</td>
<td>25</td>
<td>25</td>
<td>25</td>
</tr>
<tr>
<td>TP393</td>
<td>07410810</td>
<td>网络工程实用教程</td>
<td>汪新民</td>
<td>北京大学出版社</td>
<td>34.8</td>
<td>2008-08-21</td>
<td>10</td>
<td>15</td>
<td>15</td>
</tr>
</tbody></table>
<h3 id="1-用不同的方法创建约束；2）查看和删除约束；-3）创建、删除默认和规则-3-5分"><a href="#1-用不同的方法创建约束；2）查看和删除约束；-3）创建、删除默认和规则-3-5分" class="headerlink" title="1)用不同的方法创建约束；2）查看和删除约束；(3）创建、删除默认和规则 (3*5分)"></a>1)用不同的方法创建约束；2）查看和删除约束；(3）创建、删除默认和规则 (3*5分)</h3><h4 id="用不同的方法创建约束-5分"><a href="#用不同的方法创建约束-5分" class="headerlink" title="用不同的方法创建约束(5分)"></a>用不同的方法创建约束(5分)</h4><ol>
<li>在表定义时直接添加约束&amp;&amp;使用 CONSTRAINT 关键字命名约束</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">-- 借还明细表</span><br><span class="line">CREATE TABLE 借还明细表 (</span><br><span class="line">    借书证号 VARCHAR(10) NOT NULL,</span><br><span class="line">    图书编号 VARCHAR(10),</span><br><span class="line">    借还状态 ENUM(&#x27;还&#x27;,&#x27;借&#x27;),</span><br><span class="line">    借书日期 DATE,</span><br><span class="line">    还书日期 DATE,</span><br><span class="line">    数量 INT,</span><br><span class="line">    工号 VARCHAR(10),</span><br><span class="line">    CONSTRAINT check_borrow_date CHECK (借书日期 &lt;= &#x27;2024-12-31&#x27;),</span><br><span class="line">    FOREIGN KEY (图书编号) REFERENCES 图书明细表(图书编号),</span><br><span class="line">    FOREIGN KEY (借书证号) REFERENCES 读者信息表(借书证号)</span><br><span class="line">);</span><br><span class="line">-- 图书明细表</span><br><span class="line">CREATE TABLE 图书明细表 (</span><br><span class="line">    类别号 VARCHAR(10),</span><br><span class="line">    图书编号 VARCHAR(10) PRIMARY KEY,</span><br><span class="line">    图书名称 VARCHAR(50),</span><br><span class="line">    作者 VARCHAR(50),</span><br><span class="line">    出版社 VARCHAR(50),</span><br><span class="line">    定价 DECIMAL(10, 2),</span><br><span class="line">    购进日期 DATE,</span><br><span class="line">    购入数 INT,</span><br><span class="line">    复本数 INT,</span><br><span class="line">    库存数 INT</span><br><span class="line">);</span><br><span class="line">-- 读者信息表</span><br><span class="line">CREATE TABLE 读者信息表 (</span><br><span class="line">    借书证号 CHAR(8) PRIMARY KEY,</span><br><span class="line">    姓名 VARCHAR(50),</span><br><span class="line">    性别 ENUM(&#x27;女&#x27;, &#x27;男&#x27;),</span><br><span class="line">    出生日期 DATE,</span><br><span class="line">    借书量 INT,</span><br><span class="line">    工作单位 VARCHAR(100),</span><br><span class="line">    电话 CHAR(11),</span><br><span class="line">    电子邮件 VARCHAR(50)</span><br><span class="line">);  </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用ALTER TABLE 语句添加约束</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表</span><br><span class="line">ADD CONSTRAINT check_birth_date CHECK (出生日期 &lt;= &#x27;2024-12-31&#x27;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表 </span><br><span class="line">ADD CONSTRAINT RMP PRIMARY KEY (借书证号);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 借还明细表</span><br><span class="line">ADD CONSTRAINT fk_借书证号 FOREIGN KEY (借书证号) REFERENCES 读者信息表(借书证号);</span><br></pre></td></tr></table></figure>

<h4 id="用不同的方法查看和删除约束（5分）"><a href="#用不同的方法查看和删除约束（5分）" class="headerlink" title="用不同的方法查看和删除约束（5分）"></a>用不同的方法查看和删除约束（5分）</h4><h5 id="查看约束："><a href="#查看约束：" class="headerlink" title="查看约束："></a>查看约束：</h5><p>使用DESCRIBE命令查看表结构，约束信息通常会显示在表结构描述中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE 表名;</span><br><span class="line">mysql&gt; DESCRIBE 借还明细表;</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br><span class="line">| 借书证号 | varchar(10) | YES  | MUL | NULL    |       |</span><br><span class="line">| 图书编号 | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">| 借还状态 | varchar(5)  | YES  |     | NULL    |       |</span><br><span class="line">| 借书日期 | date        | YES  |     | NULL    |       |</span><br><span class="line">| 还书日期 | date        | YES  |     | NULL    |       |</span><br><span class="line">| 数量     | int         | YES  |     | NULL    |       |</span><br><span class="line">| 工号     | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">+----------+-------------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure>

<p>使用SHOW CREATE TABLE命令查看表的创建语句，约束信息会包含在创建语句中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE TABLE 表名;</span><br><span class="line">| 借还明细表 | CREATE TABLE `借还明细表` (</span><br><span class="line">  `借书证号` varchar(10) DEFAULT NULL,</span><br><span class="line">  `图书编号` varchar(10) DEFAULT NULL,</span><br><span class="line">  `借还状态` varchar(5) DEFAULT NULL,</span><br><span class="line">  `借书日期` date DEFAULT NULL,</span><br><span class="line">  `还书日期` date DEFAULT NULL,</span><br><span class="line">  `数量` int DEFAULT NULL,</span><br><span class="line">  `工号` varchar(10) DEFAULT NULL,</span><br><span class="line">  KEY `fk_借书证号` (`借书证号`),</span><br><span class="line">  CONSTRAINT `fk_借书证号` FOREIGN KEY (`借书证号`) REFERENCES `读者信息表` (`借书证号`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |</span><br></pre></td></tr></table></figure>

<p>查看某个约束的具体信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM information_schema.table_constraints</span><br><span class="line">WHERE table_name = &#x27;借还明细表&#x27; AND table_schema = &#x27;实验项目一&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="删除约束："><a href="#删除约束：" class="headerlink" title="删除约束："></a>删除约束：</h5><p>使用ALTER TABLE语句删除约束。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表</span><br><span class="line">DROP CONSTRAINT check_birth_date;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 借还明细表 DROP FOREIGN KEY fk_借书证号;</span><br><span class="line">ALTER TABLE 读者信息表</span><br><span class="line">DROP PRIMARY KEY;</span><br></pre></td></tr></table></figure>

<h4 id="用不同的方法创建、删除默认值和规则-（5分）"><a href="#用不同的方法创建、删除默认值和规则-（5分）" class="headerlink" title="用不同的方法创建、删除默认值和规则 （5分）"></a>用不同的方法创建、删除默认值和规则 （5分）</h4><h5 id="创建默认值："><a href="#创建默认值：" class="headerlink" title="创建默认值："></a>创建默认值：</h5><p>在CREATE TABLE语句中定义列时指定默认值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE 读者信息表 (</span><br><span class="line">    借书证号 CHAR(8) PRIMARY KEY,</span><br><span class="line">    姓名 VARCHAR(50),</span><br><span class="line">    性别 ENUM(&#x27;女&#x27;, &#x27;男&#x27;),</span><br><span class="line">    出生日期 DATE,</span><br><span class="line">    借书量 INT DEFAULT 0,</span><br><span class="line">    工作单位 VARCHAR(100),</span><br><span class="line">    电话 CHAR(11),</span><br><span class="line">    电子邮件 VARCHAR(50)</span><br><span class="line">);  </span><br></pre></td></tr></table></figure>

<p>使用ALTER TABLE语句添加默认值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表 MODIFY COLUMN 借书量 INT DEFAULT 0;</span><br></pre></td></tr></table></figure>

<h5 id="删除默认值："><a href="#删除默认值：" class="headerlink" title="删除默认值："></a>删除默认值：</h5><p>使用ALTER TABLE语句删除列的默认值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表 ALTER COLUMN 借书量 DROP DEFAULT;</span><br></pre></td></tr></table></figure>

<p>使用ALTER TABLE语句修改列的默认值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表 ALTER COLUMN 借书量 SET DEFAULT NULL;</span><br></pre></td></tr></table></figure>

<h5 id="创建规则："><a href="#创建规则：" class="headerlink" title="创建规则："></a>创建规则：</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建规则</span></span><br><span class="line"><span class="keyword">CREATE</span> RULE rule_name <span class="keyword">AS</span> <span class="keyword">ON</span> <span class="keyword">INSERT</span> <span class="keyword">TO</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span></span><br><span class="line">DO INSTEAD <span class="keyword">INSERT INTO</span> table_name <span class="keyword">VALUES</span> (value1, value2, ...);</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，您可以使用 <code>CREATE RULE</code> 语句来创建规则，规则会在满足条件时执行指定的操作。</p>
<h5 id="删除规则："><a href="#删除规则：" class="headerlink" title="删除规则："></a>删除规则：</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除规则</span></span><br><span class="line"><span class="keyword">DROP</span> RULE rule_name <span class="keyword">ON</span> table_name;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，您可以使用 <code>DROP RULE</code> 语句来删除表上的规则。</p>
<h3 id="1）掌握主键约束的特点和用法；2）掌握惟一性约束的用法；3）掌握默认约束和默认对象的用法；4）掌握CHECK约束和规则对象的用法；5）掌握利用主键与外键约束实现参照完整性的方法-5-5分-。"><a href="#1）掌握主键约束的特点和用法；2）掌握惟一性约束的用法；3）掌握默认约束和默认对象的用法；4）掌握CHECK约束和规则对象的用法；5）掌握利用主键与外键约束实现参照完整性的方法-5-5分-。" class="headerlink" title="1）掌握主键约束的特点和用法；2）掌握惟一性约束的用法；3）掌握默认约束和默认对象的用法；4）掌握CHECK约束和规则对象的用法；5）掌握利用主键与外键约束实现参照完整性的方法(5*5分)。"></a>1）掌握主键约束的特点和用法；2）掌握惟一性约束的用法；3）掌握默认约束和默认对象的用法；4）掌握CHECK约束和规则对象的用法；5）掌握利用主键与外键约束实现参照完整性的方法(5*5分)。</h3><h4 id="掌握主键约束的特点和用法（5分）"><a href="#掌握主键约束的特点和用法（5分）" class="headerlink" title="掌握主键约束的特点和用法（5分）"></a>掌握主键约束的特点和用法（5分）</h4><p>主键约束是关系型数据库中非常重要的概念，它具有以下特点和用法：</p>
<ol>
<li><p>唯一性：主键约束要求表中的每一行数据都具有唯一的主键值。这意味着主键值在整个表中必须是唯一的，不允许重复。</p>
</li>
<li><p>非空性：主键列的值不能为 NULL。主键值必须在每一行中存在且不为空。</p>
</li>
<li><p>数据完整性：主键约束确保了表中数据的完整性和一致性。通过主键约束，可以确保每一行数据都可以唯一地被标识和访问。</p>
</li>
<li><p>索引：主键约束会自动创建索引，以加速对主键列的查询和访问。这样可以提高数据检索的效率。</p>
</li>
<li><p>外键关系：主键约束常用于定义表与表之间的关系。在另一个表中，可以通过外键约束引用主键，建立表与表之间的关联关系。</p>
</li>
</ol>
<p>用法：</p>
<ul>
<li>在创建表时定义主键约束：可以在 CREATE TABLE 语句中通过 PRIMARY KEY 关键字定义主键约束。</li>
<li>修改表结构时添加主键约束：可以使用 ALTER TABLE 语句来添加主键约束。</li>
<li>主键的选择：主键通常选择具有唯一性且不会经常变化的列作为主键，例如自增长的整数列。</li>
<li>主键的作用：主键可以作为表中每一行数据的唯一标识符，便于数据的检索、更新和删除操作。</li>
</ul>
<p>总之，主键约束是数据库设计中非常重要的概念，它确保了数据的完整性和唯一性，并在数据库操作中起着重要的作用。</p>
<h4 id="掌握惟一性约束的用法（5分）"><a href="#掌握惟一性约束的用法（5分）" class="headerlink" title="掌握惟一性约束的用法（5分）"></a>掌握惟一性约束的用法（5分）</h4><p>惟一性约束（Unique Constraint）是关系型数据库中的一种约束，用于确保表中某个列或一组列的取值在整个表中是唯一的。惟一性约束与主键约束类似，但不要求被约束的列是主键，可以是任意列或组合列。</p>
<p>以下是关于惟一性约束的用法：</p>
<ol>
<li><strong>定义唯一性约束</strong>：在创建表时，可以使用 UNIQUE 关键字定义唯一性约束。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> 表名 (</span><br><span class="line">    列名<span class="number">1</span> 数据类型,</span><br><span class="line">    列名<span class="number">2</span> 数据类型,</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">UNIQUE</span> (列名<span class="number">1</span>, 列名<span class="number">2</span>, ...)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>添加唯一性约束</strong>：在已有表中添加唯一性约束，可以使用 ALTER TABLE 语句。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ADD CONSTRAINT</span> 约束名 <span class="keyword">UNIQUE</span> (列名);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><strong>唯一性约束的作用</strong>：</p>
<ul>
<li>确保表中的某列或组合列的取值是唯一的，不允许重复。</li>
<li>可以用于定义候选键（Candidate Key），即在主键外的另一个唯一标识符。</li>
<li>可以提高数据的完整性和准确性，避免数据重复和冲突。</li>
</ul>
</li>
<li><p><strong>唯一性约束与主键的区别</strong>：</p>
<ul>
<li>主键约束要求被约束的列是唯一的且不为空，而唯一性约束只要求唯一性，允许 NULL 值。</li>
<li>表只能有一个主键，但可以有多个唯一性约束。</li>
</ul>
</li>
<li><p><strong>唯一性约束的使用场景</strong>：</p>
<ul>
<li>用于确保某列或组合列的取值是唯一的，如用户名、邮箱等。</li>
<li>用于定义候选键，提供多个唯一标识符供查询和关联。</li>
</ul>
</li>
</ol>
<p>总之，唯一性约束是一种重要的数据库约束，用于确保数据的唯一性和完整性。在设计数据库时，根据实际需求考虑是否需要添加唯一性约束来提高数据的质量和准确性。</p>
<h4 id="掌握默认约束和默认对象的用法（5分）"><a href="#掌握默认约束和默认对象的用法（5分）" class="headerlink" title="掌握默认约束和默认对象的用法（5分）"></a>掌握默认约束和默认对象的用法（5分）</h4><p>默认约束（Default Constraint）和默认对象（Default Object）是关系型数据库中用于指定列默认值的概念。它们的主要作用是在插入数据时，如果未显式提供该列的值，则自动使用默认值。</p>
<p>以下是关于默认约束和默认对象的用法：</p>
<ol>
<li><strong>默认约束的定义</strong>：默认约束是在创建表时定义的约束，用于指定列的默认值。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> 表名 (</span><br><span class="line">    列名 数据类型 <span class="keyword">DEFAULT</span> 默认值,</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>添加默认约束</strong>：在已有表中添加默认约束，可以使用 ALTER TABLE 语句。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> 列名 <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> 默认值;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>默认对象的定义</strong>：默认对象是数据库中的一个对象，用于指定列的默认值。默认对象通常是一个函数或表达式，用于计算默认值。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 默认对象名 ()</span><br><span class="line"><span class="keyword">RETURNS</span> 数据类型</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">RETURN</span> 默认值;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> 列名 <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> 默认对象名();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p><strong>默认约束和默认对象的作用</strong>：</p>
<ul>
<li>确保在插入数据时，如果未提供指定列的值，则自动使用默认值。</li>
<li>提高数据的完整性和准确性，避免数据缺失或错误。</li>
</ul>
</li>
<li><p><strong>默认约束和默认对象的区别</strong>：</p>
<ul>
<li>默认约束直接指定默认值，而默认对象可以是一个函数或表达式。</li>
<li>默认约束适用于简单的默认值设定，而默认对象适用于复杂的默认值计算。</li>
</ul>
</li>
<li><p><strong>使用场景</strong>：</p>
<ul>
<li>默认约束适用于简单的默认值设置，如固定值或常量。</li>
<li>默认对象适用于复杂的默认值计算，如根据其他列的值计算默认值。</li>
</ul>
</li>
</ol>
<p>总之，默认约束和默认对象是数据库中用于指定列默认值的重要概念。在设计数据库时，根据实际需求选择合适的方式来设置默认值，以提高数据的完整性和准确性。</p>
<h4 id="掌握CHECK约束和规则对象的用法（5分）"><a href="#掌握CHECK约束和规则对象的用法（5分）" class="headerlink" title="掌握CHECK约束和规则对象的用法（5分）"></a>掌握CHECK约束和规则对象的用法（5分）</h4><p>CHECK 约束和规则对象是关系型数据库中用于限制列值的约束和规则。它们可以确保数据的完整性和准确性，只允许符合指定条件的数据被插入或更新。</p>
<h5 id="CHECK-约束的用法："><a href="#CHECK-约束的用法：" class="headerlink" title="CHECK 约束的用法："></a>CHECK 约束的用法：</h5><ol>
<li><strong>定义 CHECK 约束</strong>：在创建表时，可以使用 CHECK 约束限制列的取值范围或条件。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> 表名 (</span><br><span class="line">    列名 数据类型 <span class="keyword">CHECK</span> (条件),</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>添加 CHECK 约束</strong>：在已有表中添加 CHECK 约束，可以使用 ALTER TABLE 语句。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ADD CONSTRAINT</span> 约束名 <span class="keyword">CHECK</span> (条件);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>使用场景</strong>：<ul>
<li>限制列的取值范围，如年龄不能为负数。</li>
<li>确保数据符合特定条件，如性别只能为”男”或”女”。</li>
</ul>
</li>
</ol>
<h5 id="规则对象的用法"><a href="#规则对象的用法" class="headerlink" title="规则对象的用法"></a>规则对象的用法</h5><ol>
<li><strong>定义规则对象</strong>：规则对象是数据库中的一个对象，用于定义数据的规则或条件。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> RULE 规则名 <span class="keyword">AS</span> @条件;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>将规则对象应用到列上</strong>：可以通过 ALTER TABLE 添加规则对象到列上，用于限制数据的取值范围或条件。语法如下：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ADD CONSTRAINT</span> 约束名 <span class="keyword">CHECK</span> (规则名(列名));</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>使用场景</strong>：<ul>
<li>定义复杂的数据规则，如联合多个列的取值条件。</li>
<li>可以被多个列引用，提高数据的一致性和准确性。</li>
</ul>
</li>
</ol>
<p>总之，CHECK 约束和规则对象是数据库中重要的约束和规则定义工具，用于确保数据的完整性和准确性。在设计数据库时，根据实际需求选择合适的方式来定义数据规则，以提高数据的质量和准确性。</p>
<h4 id="掌握利用主键与外键约束实现参照完整性的方法（5分）"><a href="#掌握利用主键与外键约束实现参照完整性的方法（5分）" class="headerlink" title="掌握利用主键与外键约束实现参照完整性的方法（5分）"></a>掌握利用主键与外键约束实现参照完整性的方法（5分）</h4><p>主键约束和外键约束是关系型数据库中用于实现参照完整性（Referential Integrity）的重要工具。通过主键约束和外键约束，可以确保数据之间的关联关系正确并且保持一致性。</p>
<p>利用主键与外键约束实现参照完整性的方法：</p>
<ol>
<li><p><strong>主键约束</strong>：</p>
<ul>
<li>主键约束用于唯一标识表中的每条记录，确保每条记录都有唯一的标识符。</li>
<li>在创建表时，通过指定主键约束可以将某列或某组列定义为主键。</li>
<li>主键约束可以保证表中每条记录的唯一性，且不允许为空值。</li>
</ul>
</li>
<li><p><strong>外键约束</strong>：</p>
<ul>
<li>外键约束用于建立表与表之间的关联关系，确保参照表中的外键值必须在被参照表的主键中存在。</li>
<li>在创建表时，通过指定外键约束可以将某列定义为外键，参照另一张表的主键。</li>
<li>外键约束可以确保数据之间的关联关系正确，防止出现不一致或无效的引用。</li>
</ul>
</li>
<li><p><strong>实现参照完整性的步骤</strong>：</p>
<ul>
<li>在被参照表中定义主键约束，确保每条记录有唯一的标识符。</li>
<li>在参照表中定义外键约束，将外键与被参照表的主键关联起来。</li>
<li>当插入或更新数据时，数据库会自动检查外键约束，确保外键值在被参照表的主键中存在。</li>
</ul>
</li>
<li><p><strong>示例</strong>：</p>
<ul>
<li>假设有两张表：<code>users</code> 和 <code>orders</code>，其中 <code>orders</code> 表中有一个 <code>user_id</code> 列用于表示订单所属用户。</li>
<li>在 <code>users</code> 表中定义主键约束，将 <code>user_id</code> 列定义为主键。</li>
<li>在 <code>orders</code> 表中定义外键约束，将 <code>user_id</code> 列定义为外键，参照 <code>users</code> 表的主键。</li>
<li>这样可以确保每个订单都必须属于一个已存在的用户，保证数据的参照完整性。</li>
</ul>
</li>
</ol>
<p>总之，利用主键约束和外键约束可以实现参照完整性，确保数据之间的关联关系正确并保持一致性。在设计数据库时，合理设置主键和外键约束是保证数据完整性的重要步骤。</p>
<h3 id="1-增加一个字段；2-删除一个字段-3-增加一个约束-4-修改字段的数据类型-4-5分-；"><a href="#1-增加一个字段；2-删除一个字段-3-增加一个约束-4-修改字段的数据类型-4-5分-；" class="headerlink" title="1)增加一个字段；2)删除一个字段; 3)增加一个约束; 4)修改字段的数据类型(4*5分)；"></a>1)增加一个字段；2)删除一个字段; 3)增加一个约束; 4)修改字段的数据类型(4*5分)；</h3><h4 id="增加一个字段-5分"><a href="#增加一个字段-5分" class="headerlink" title="增加一个字段(5分)"></a>增加一个字段(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表</span><br><span class="line">ADD 身份证号 CHAR(29);</span><br></pre></td></tr></table></figure>

<h4 id="删除一个字段-5分"><a href="#删除一个字段-5分" class="headerlink" title="删除一个字段(5分)"></a>删除一个字段(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表</span><br><span class="line">DROP COLUMN 身份证号;</span><br></pre></td></tr></table></figure>

<h4 id="增加一个约束-5分"><a href="#增加一个约束-5分" class="headerlink" title="增加一个约束(5分)"></a>增加一个约束(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 读者信息表 </span><br><span class="line">ADD CONSTRAINT RMP PRIMARY KEY (借书证号);</span><br></pre></td></tr></table></figure>

<h4 id="修改字段的数据类型-5分"><a href="#修改字段的数据类型-5分" class="headerlink" title="修改字段的数据类型(5分)"></a>修改字段的数据类型(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 图书明细表</span><br><span class="line">MODIFY 图书编号 VARCHAR(10);</span><br></pre></td></tr></table></figure>

<h3 id="1）创建索引；2）重建索引-2-5分-。"><a href="#1）创建索引；2）重建索引-2-5分-。" class="headerlink" title="1）创建索引；2）重建索引(2*5分)。"></a>1）创建索引；2）重建索引(2*5分)。</h3><h4 id="创建索引-5分"><a href="#创建索引-5分" class="headerlink" title="创建索引(5分)"></a>创建索引(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_reader_card_number ON  读者信息表(借书证号);</span><br></pre></td></tr></table></figure>

<h4 id="重建索引-5分"><a href="#重建索引-5分" class="headerlink" title="重建索引(5分)"></a>重建索引(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX idx_reader_card_number;</span><br><span class="line">CREATE INDEX idx_reader_card_number</span><br><span class="line">ON 读者信息表(借书证号);</span><br></pre></td></tr></table></figure>

<h3 id="1-创建视图；-2）删除视图-2-5分-。"><a href="#1-创建视图；-2）删除视图-2-5分-。" class="headerlink" title="1) 创建视图； 2）删除视图(2*5分)。"></a>1) 创建视图； 2）删除视图(2*5分)。</h3><h4 id="创建视图-5分"><a href="#创建视图-5分" class="headerlink" title="创建视图(5分)"></a>创建视图(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW reader_borrow_return_view AS</span><br><span class="line">SELECT r.借书证号, r.姓名, r.性别, r.出生日期, r.借书量, r.工作单位, r.电话, r.电子邮件,</span><br><span class="line">b.图书编号, b.借还状态, b.借书日期, b.还书日期, b.数量, b.工号</span><br><span class="line">FROM 读者信息表 r,借还明细表 b </span><br><span class="line">WHERE r.借书证号 = b.借书证号;</span><br></pre></td></tr></table></figure>

<h4 id="删除视图-5分"><a href="#删除视图-5分" class="headerlink" title="删除视图(5分)"></a>删除视图(5分)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW reader_borrow_return_view;</span><br></pre></td></tr></table></figure>

<h2 id="实验项目二"><a href="#实验项目二" class="headerlink" title="实验项目二"></a>实验项目二</h2><h3 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建学生信息表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> student (</span><br><span class="line">    sno <span class="type">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">    sname <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    sex <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthday <span class="type">DATE</span>,</span><br><span class="line">    class <span class="type">CHAR</span>(<span class="number">5</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入学生信息数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> student <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;108&#x27;</span>, <span class="string">&#x27;曾华&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1977-09-01&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;匡明&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1975-10-02&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;107&#x27;</span>, <span class="string">&#x27;王丽&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1976-01-23&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;李军&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1976-02-20&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;王芳&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1975-02-10&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;陆军&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1974-06-03&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建老师信息表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> teacher (</span><br><span class="line">    tno <span class="type">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">    tname <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    sex <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthday <span class="type">DATE</span>,</span><br><span class="line">    prof <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">    depart <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入老师信息数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> teacher <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;804&#x27;</span>, <span class="string">&#x27;李诚&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1958-12-02&#x27;</span>, <span class="string">&#x27;副教授&#x27;</span>, <span class="string">&#x27;计算机系&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;856&#x27;</span>, <span class="string">&#x27;李旭&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1969-03-12&#x27;</span>, <span class="string">&#x27;讲师&#x27;</span>, <span class="string">&#x27;电子工程系&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;825&#x27;</span>, <span class="string">&#x27;王萍&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1972-05-05&#x27;</span>, <span class="string">&#x27;助教&#x27;</span>, <span class="string">&#x27;计算机系&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;831&#x27;</span>, <span class="string">&#x27;刘冰&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1977-08-14&#x27;</span>, <span class="string">&#x27;助教&#x27;</span>, <span class="string">&#x27;电子工程系&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建课程表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> course (</span><br><span class="line">    cno <span class="type">CHAR</span>(<span class="number">5</span>),</span><br><span class="line">    cname <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    tno <span class="type">CHAR</span>(<span class="number">3</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入课程信息数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> course <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;计算机导论&#x27;</span>, <span class="string">&#x27;825&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;3-245&#x27;</span>, <span class="string">&#x27;操作系统&#x27;</span>, <span class="string">&#x27;804&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;6-166&#x27;</span>, <span class="string">&#x27;数字电路&#x27;</span>, <span class="string">&#x27;856&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;9-888&#x27;</span>, <span class="string">&#x27;高等数学&#x27;</span>, <span class="string">&#x27;825&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建成绩表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> score (</span><br><span class="line">    sno <span class="type">CHAR</span>(<span class="number">3</span>),</span><br><span class="line">    cno <span class="type">CHAR</span>(<span class="number">5</span>),</span><br><span class="line">    degree <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入成绩数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> score <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;3-245&#x27;</span>, <span class="number">86</span>),</span><br><span class="line">(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;3-245&#x27;</span>, <span class="number">75</span>),</span><br><span class="line">(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;3-245&#x27;</span>, <span class="number">68</span>),</span><br><span class="line">(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="number">92</span>),</span><br><span class="line">(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="number">88</span>),</span><br><span class="line">(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="number">76</span>),</span><br><span class="line">(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="number">64</span>),</span><br><span class="line">(<span class="string">&#x27;107&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="number">91</span>),</span><br><span class="line">(<span class="string">&#x27;108&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="number">78</span>),</span><br><span class="line">(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;6-166&#x27;</span>, <span class="number">85</span>),</span><br><span class="line">(<span class="string">&#x27;107&#x27;</span>, <span class="string">&#x27;6-166&#x27;</span>, <span class="number">79</span>),</span><br><span class="line">(<span class="string">&#x27;108&#x27;</span>, <span class="string">&#x27;6-166&#x27;</span>, <span class="number">81</span>);</span><br></pre></td></tr></table></figure>

<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><h4 id="1-列出student表中所有记录的sname、sex和class列。"><a href="#1-列出student表中所有记录的sname、sex和class列。" class="headerlink" title="1. 列出student表中所有记录的sname、sex和class列。"></a>1. 列出student表中所有记录的sname、sex和class列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sname, sex, class</span><br><span class="line"><span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----+-------+</span><br><span class="line">| sname | sex | class |</span><br><span class="line">+-------+-----+-------+</span><br><span class="line">| 曾华  | 男  | 95033 |</span><br><span class="line">| 匡明  | 男  | 95031 |</span><br><span class="line">| 王丽  | 女  | 95033 |</span><br><span class="line">| 李军  | 男  | 95033 |</span><br><span class="line">| 王芳  | 女  | 95031 |</span><br><span class="line">| 陆军  | 男  | 95031 |</span><br><span class="line">+-------+-----+-------+</span><br></pre></td></tr></table></figure>

<h4 id="2-显示教师所有的单位即不重复的depart列。"><a href="#2-显示教师所有的单位即不重复的depart列。" class="headerlink" title="2. 显示教师所有的单位即不重复的depart列。"></a>2. 显示教师所有的单位即不重复的depart列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> depart </span><br><span class="line"><span class="keyword">FROM</span> teacher;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------------+</span><br><span class="line">| depart     |</span><br><span class="line">+------------+</span><br><span class="line">| 计算机系   |</span><br><span class="line">| 电子工程系 |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure>

<h4 id="3-显示学生表的所有记录。"><a href="#3-显示学生表的所有记录。" class="headerlink" title="3. 显示学生表的所有记录。"></a>3. 显示学生表的所有记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| sno | sname | sex | birthday   | class |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| 108 | 曾华  | 男  | 1977-09-01 | 95033 |</span><br><span class="line">| 105 | 匡明  | 男  | 1975-10-02 | 95031 |</span><br><span class="line">| 107 | 王丽  | 女  | 1976-01-23 | 95033 |</span><br><span class="line">| 101 | 李军  | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 109 | 王芳  | 女  | 1975-02-10 | 95031 |</span><br><span class="line">| 103 | 陆军  | 男  | 1974-06-03 | 95031 |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="4-显示score表中成绩在60到80之间的所有记录。"><a href="#4-显示score表中成绩在60到80之间的所有记录。" class="headerlink" title="4. 显示score表中成绩在60到80之间的所有记录。"></a>4. 显示score表中成绩在60到80之间的所有记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="keyword">BETWEEN</span> <span class="number">60</span> <span class="keyword">AND</span> <span class="number">80</span>;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 105 | 3-245 |     75 |</span><br><span class="line">| 109 | 3-245 |     68 |</span><br><span class="line">| 109 | 3-105 |     76 |</span><br><span class="line">| 101 | 3-105 |     64 |</span><br><span class="line">| 108 | 3-105 |     78 |</span><br><span class="line">| 107 | 6-166 |     79 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="5-显示score表中成绩为85，86或88的记录。"><a href="#5-显示score表中成绩为85，86或88的记录。" class="headerlink" title="5. 显示score表中成绩为85，86或88的记录。"></a>5. 显示score表中成绩为85，86或88的记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="keyword">IN</span> (<span class="number">85</span>, <span class="number">86</span>, <span class="number">88</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 103 | 3-245 |     86 |</span><br><span class="line">| 105 | 3-105 |     88 |</span><br><span class="line">| 101 | 6-166 |     85 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="6-显示student表中“95031”班或性别为“女”的同学记录。"><a href="#6-显示student表中“95031”班或性别为“女”的同学记录。" class="headerlink" title="6. 显示student表中“95031”班或性别为“女”的同学记录。"></a>6. 显示student表中“95031”班或性别为“女”的同学记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;95031&#x27;</span> <span class="keyword">OR</span> sex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| sno | sname | sex | birthday   | class |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| 105 | 匡明  | 男  | 1975-10-02 | 95031 |</span><br><span class="line">| 107 | 王丽  | 女  | 1976-01-23 | 95033 |</span><br><span class="line">| 109 | 王芳  | 女  | 1975-02-10 | 95031 |</span><br><span class="line">| 103 | 陆军  | 男  | 1974-06-03 | 95031 |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="7-以class降序显示student表的所有记录。"><a href="#7-以class降序显示student表的所有记录。" class="headerlink" title="7. 以class降序显示student表的所有记录。"></a>7. 以class降序显示student表的所有记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> class <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| sno | sname | sex | birthday   | class |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| 108 | 曾华  | 男  | 1977-09-01 | 95033 |</span><br><span class="line">| 107 | 王丽  | 女  | 1976-01-23 | 95033 |</span><br><span class="line">| 101 | 李军  | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 105 | 匡明  | 男  | 1975-10-02 | 95031 |</span><br><span class="line">| 109 | 王芳  | 女  | 1975-02-10 | 95031 |</span><br><span class="line">| 103 | 陆军  | 男  | 1974-06-03 | 95031 |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="8-以cno升序、degree降序显示score表的所有记录。"><a href="#8-以cno升序、degree降序显示score表的所有记录。" class="headerlink" title="8. 以cno升序、degree降序显示score表的所有记录。"></a>8. 以cno升序、degree降序显示score表的所有记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cno <span class="keyword">ASC</span>, degree <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 103 | 3-105 |     92 |</span><br><span class="line">| 107 | 3-105 |     91 |</span><br><span class="line">| 105 | 3-105 |     88 |</span><br><span class="line">| 108 | 3-105 |     78 |</span><br><span class="line">| 109 | 3-105 |     76 |</span><br><span class="line">| 101 | 3-105 |     64 |</span><br><span class="line">| 103 | 3-245 |     86 |</span><br><span class="line">| 105 | 3-245 |     75 |</span><br><span class="line">| 109 | 3-245 |     68 |</span><br><span class="line">| 101 | 6-166 |     85 |</span><br><span class="line">| 108 | 6-166 |     81 |</span><br><span class="line">| 107 | 6-166 |     79 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="9-显示“98031”班的学生人数。"><a href="#9-显示“98031”班的学生人数。" class="headerlink" title="9. 显示“98031”班的学生人数。"></a>9. 显示“98031”班的学生人数。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;98031&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------+</span><br><span class="line">| COUNT(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        0 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>

<h4 id="10-显示score表中的最高分的学生学号和课程号。"><a href="#10-显示score表中的最高分的学生学号和课程号。" class="headerlink" title="10. 显示score表中的最高分的学生学号和课程号。"></a>10. 显示score表中的最高分的学生学号和课程号。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sno, cno</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(degree) <span class="keyword">FROM</span> score);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+</span><br><span class="line">| sno | cno   |</span><br><span class="line">+-----+-------+</span><br><span class="line">| 103 | 3-105 |</span><br><span class="line">+-----+-------+</span><br></pre></td></tr></table></figure>

<h4 id="11-显示“3-105”号课程的平均分。"><a href="#11-显示“3-105”号课程的平均分。" class="headerlink" title="11. 显示“3-105”号课程的平均分。"></a>11. 显示“3-105”号课程的平均分。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(degree)</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------------+</span><br><span class="line">| AVG(degree) |</span><br><span class="line">+-------------+</span><br><span class="line">| 81.5000     |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure>

<h4 id="12-显示score表中至少有5名学生选修的并以3开头的课程号的平均分数。"><a href="#12-显示score表中至少有5名学生选修的并以3开头的课程号的平均分数。" class="headerlink" title="12. 显示score表中至少有5名学生选修的并以3开头的课程号的平均分数。"></a>12. 显示score表中至少有5名学生选修的并以3开头的课程号的平均分数。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cno, <span class="built_in">AVG</span>(degree)</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="keyword">LIKE</span> <span class="string">&#x27;3%&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cno</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(sno) <span class="operator">&gt;=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------------+</span><br><span class="line">| cno   | AVG(degree) |</span><br><span class="line">+-------+-------------+</span><br><span class="line">| 3-105 | 81.5000     |</span><br><span class="line">+-------+-------------+</span><br></pre></td></tr></table></figure>

<h4 id="13-显示最低分大于70，最高分小于90-的sno列。"><a href="#13-显示最低分大于70，最高分小于90-的sno列。" class="headerlink" title="13. 显示最低分大于70，最高分小于90 的sno列。"></a>13. 显示最低分大于70，最高分小于90 的sno列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sno</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sno</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MIN</span>(degree) <span class="operator">&gt;</span> <span class="number">70</span> <span class="keyword">AND</span> <span class="built_in">MAX</span>(degree) <span class="operator">&lt;</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-----+</span><br><span class="line">| sno |</span><br><span class="line">+-----+</span><br><span class="line">| 105 |</span><br><span class="line">| 108 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>

<h4 id="14-显示所有学生的-sname、-cno和degree列。"><a href="#14-显示所有学生的-sname、-cno和degree列。" class="headerlink" title="14. 显示所有学生的 sname、 cno和degree列。"></a>14. 显示所有学生的 sname、 cno和degree列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student.sname, score.cno, score.degree</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">JOIN</span> score <span class="keyword">ON</span> student.sno <span class="operator">=</span> score.sno;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------+--------+</span><br><span class="line">| sname | cno   | degree |</span><br><span class="line">+-------+-------+--------+</span><br><span class="line">| 陆军  | 3-245 |     86 |</span><br><span class="line">| 匡明  | 3-245 |     75 |</span><br><span class="line">| 王芳  | 3-245 |     68 |</span><br><span class="line">| 陆军  | 3-105 |     92 |</span><br><span class="line">| 匡明  | 3-105 |     88 |</span><br><span class="line">| 王芳  | 3-105 |     76 |</span><br><span class="line">| 李军  | 3-105 |     64 |</span><br><span class="line">| 王丽  | 3-105 |     91 |</span><br><span class="line">| 曾华  | 3-105 |     78 |</span><br><span class="line">| 李军  | 6-166 |     85 |</span><br><span class="line">| 王丽  | 6-166 |     79 |</span><br><span class="line">| 曾华  | 6-166 |     81 |</span><br><span class="line">+-------+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="15-显示所有学生的-sname、-cname和degree列。"><a href="#15-显示所有学生的-sname、-cname和degree列。" class="headerlink" title="15. 显示所有学生的 sname、 cname和degree列。"></a>15. 显示所有学生的 sname、 cname和degree列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student.sname, course.cname, score.degree</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">JOIN</span> score <span class="keyword">ON</span> student.sno <span class="operator">=</span> score.sno</span><br><span class="line"><span class="keyword">JOIN</span> course <span class="keyword">ON</span> score.cno <span class="operator">=</span> course.cno;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-------+------------+--------+</span><br><span class="line">| sname | cname      | degree |</span><br><span class="line">+-------+------------+--------+</span><br><span class="line">| 曾华  | 数字电路   |     81 |</span><br><span class="line">| 曾华  | 计算机导论 |     78 |</span><br><span class="line">| 匡明  | 计算机导论 |     88 |</span><br><span class="line">| 匡明  | 操作系统   |     75 |</span><br><span class="line">| 王丽  | 数字电路   |     79 |</span><br><span class="line">| 王丽  | 计算机导论 |     91 |</span><br><span class="line">| 李军  | 数字电路   |     85 |</span><br><span class="line">| 李军  | 计算机导论 |     64 |</span><br><span class="line">| 王芳  | 计算机导论 |     76 |</span><br><span class="line">| 王芳  | 操作系统   |     68 |</span><br><span class="line">| 陆军  | 计算机导论 |     92 |</span><br><span class="line">| 陆军  | 操作系统   |     86 |</span><br><span class="line">+-------+------------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="16-列出“95033”班所选课程的平均分。"><a href="#16-列出“95033”班所选课程的平均分。" class="headerlink" title="16. 列出“95033”班所选课程的平均分。"></a>16. 列出“95033”班所选课程的平均分。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cno, <span class="built_in">AVG</span>(degree)</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> sno <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;95033&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cno;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------------+</span><br><span class="line">| cno   | AVG(degree) |</span><br><span class="line">+-------+-------------+</span><br><span class="line">| 3-245 | 76.3333     |</span><br><span class="line">| 3-105 | 81.5000     |</span><br><span class="line">| 6-166 | 81.6667     |</span><br><span class="line">+-------+-------------+</span><br></pre></td></tr></table></figure>

<h4 id="17-显示选修“3-105”课程的成绩高于“109”号同学成绩的所有同学的记录。"><a href="#17-显示选修“3-105”课程的成绩高于“109”号同学成绩的所有同学的记录。" class="headerlink" title="17. 显示选修“3-105”课程的成绩高于“109”号同学成绩的所有同学的记录。"></a>17. 显示选修“3-105”课程的成绩高于“109”号同学成绩的所有同学的记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span> <span class="keyword">AND</span> degree <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> sno <span class="operator">=</span> <span class="string">&#x27;109&#x27;</span> <span class="keyword">AND</span> cno <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 103 | 3-105 |     92 |</span><br><span class="line">| 105 | 3-105 |     88 |</span><br><span class="line">| 107 | 3-105 |     91 |</span><br><span class="line">| 108 | 3-105 |     78 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="18-显示score中选修多门课程的同学中分数为非最高分成绩的记录。"><a href="#18-显示score中选修多门课程的同学中分数为非最高分成绩的记录。" class="headerlink" title="18. 显示score中选修多门课程的同学中分数为非最高分成绩的记录。"></a>18. 显示score中选修多门课程的同学中分数为非最高分成绩的记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> sno </span><br><span class="line">    <span class="keyword">FROM</span> course </span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cno) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">AND</span> sno <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> sno </span><br><span class="line">    <span class="keyword">FROM</span> score </span><br><span class="line">    <span class="keyword">WHERE</span> degree <span class="operator">&lt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(degree) <span class="keyword">FROM</span> score)</span><br><span class="line">);<span class="comment">-- 注意AND只能这么连接</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 103 | 3-245 |     86 |</span><br><span class="line">| 105 | 3-245 |     75 |</span><br><span class="line">| 109 | 3-245 |     68 |</span><br><span class="line">| 103 | 3-105 |     92 |</span><br><span class="line">| 105 | 3-105 |     88 |</span><br><span class="line">| 109 | 3-105 |     76 |</span><br><span class="line">| 101 | 3-105 |     64 |</span><br><span class="line">| 107 | 3-105 |     91 |</span><br><span class="line">| 108 | 3-105 |     78 |</span><br><span class="line">| 101 | 6-166 |     85 |</span><br><span class="line">| 107 | 6-166 |     79 |</span><br><span class="line">| 108 | 6-166 |     81 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="19-显示成绩高于学号为“109”、课程号为“3-105”的成绩的所有记录。"><a href="#19-显示成绩高于学号为“109”、课程号为“3-105”的成绩的所有记录。" class="headerlink" title="19. 显示成绩高于学号为“109”、课程号为“3-105”的成绩的所有记录。"></a>19. 显示成绩高于学号为“109”、课程号为“3-105”的成绩的所有记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> sno <span class="operator">=</span> <span class="string">&#x27;109&#x27;</span> <span class="keyword">AND</span> cno <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 103 | 3-245 |     86 |</span><br><span class="line">| 103 | 3-105 |     92 |</span><br><span class="line">| 105 | 3-105 |     88 |</span><br><span class="line">| 107 | 3-105 |     91 |</span><br><span class="line">| 108 | 3-105 |     78 |</span><br><span class="line">| 101 | 6-166 |     85 |</span><br><span class="line">| 107 | 6-166 |     79 |</span><br><span class="line">| 108 | 6-166 |     81 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="20-显示出和学号为“108”的同学同年出生的所有学生的sno、sname和-birthday列。"><a href="#20-显示出和学号为“108”的同学同年出生的所有学生的sno、sname和-birthday列。" class="headerlink" title="20. 显示出和学号为“108”的同学同年出生的所有学生的sno、sname和 birthday列。"></a>20. 显示出和学号为“108”的同学同年出生的所有学生的sno、sname和 birthday列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sno, sname, birthday</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> birthday <span class="operator">=</span> (<span class="keyword">SELECT</span> birthday <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sno <span class="operator">=</span> <span class="string">&#x27;108&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+------------+</span><br><span class="line">| sno | sname | birthday   |</span><br><span class="line">+-----+-------+------------+</span><br><span class="line">| 108 | 曾华  | 1977-09-01 |</span><br><span class="line">+-----+-------+------------+</span><br></pre></td></tr></table></figure>

<h4 id="21-显示“张旭”老师任课的学生成绩。"><a href="#21-显示“张旭”老师任课的学生成绩。" class="headerlink" title="21. 显示“张旭”老师任课的学生成绩。"></a>21. 显示“张旭”老师任课的学生成绩。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> score.degree</span><br><span class="line"><span class="keyword">FROM</span> student,score,teacher,course</span><br><span class="line"><span class="keyword">WHERE</span> student.sno <span class="operator">=</span> score.sno <span class="keyword">AND</span> score.cno <span class="operator">=</span> course.cno <span class="keyword">AND</span> course.tno <span class="operator">=</span> teacher.tno <span class="keyword">AND</span> teacher.tname <span class="operator">=</span> <span class="string">&#x27;张旭&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="22-显示选修某课程的同学人数多于5人的老师姓名。"><a href="#22-显示选修某课程的同学人数多于5人的老师姓名。" class="headerlink" title="22. 显示选修某课程的同学人数多于5人的老师姓名。"></a>22. 显示选修某课程的同学人数多于5人的老师姓名。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> teacher.tname</span><br><span class="line"><span class="keyword">FROM</span> teacher,course,score</span><br><span class="line"><span class="keyword">where</span> teacher.tno <span class="operator">=</span> course.tno <span class="keyword">AND</span> course.cno <span class="operator">=</span> score.cno</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> teacher.tname</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> score.sno) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br><span class="line"><span class="comment">-- GROUP BY子句中指定的列应该与SELECT语句中选择的列相匹配。而且不能遗漏</span></span><br><span class="line"><span class="comment">-- IN也要有这种严格对应的规则</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------+</span><br><span class="line">| tname |</span><br><span class="line">+-------+</span><br><span class="line">| 王萍  |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure>

<h4 id="23-显示“95033”班和“95031”班全体学生的记录。"><a href="#23-显示“95033”班和“95031”班全体学生的记录。" class="headerlink" title="23. 显示“95033”班和“95031”班全体学生的记录。"></a>23. 显示“95033”班和“95031”班全体学生的记录。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> class <span class="keyword">IN</span> (<span class="string">&#x27;95033&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| sno | sname | sex | birthday   | class |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br><span class="line">| 108 | 曾华  | 男  | 1977-09-01 | 95033 |</span><br><span class="line">| 105 | 匡明  | 男  | 1975-10-02 | 95031 |</span><br><span class="line">| 107 | 王丽  | 女  | 1976-01-23 | 95033 |</span><br><span class="line">| 101 | 李军  | 男  | 1976-02-20 | 95033 |</span><br><span class="line">| 109 | 王芳  | 女  | 1975-02-10 | 95031 |</span><br><span class="line">| 103 | 陆军  | 男  | 1974-06-03 | 95031 |</span><br><span class="line">+-----+-------+-----+------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="24-显示存在有85分以上成绩的课程cno。"><a href="#24-显示存在有85分以上成绩的课程cno。" class="headerlink" title="24. 显示存在有85分以上成绩的课程cno。"></a>24. 显示存在有85分以上成绩的课程cno。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> cno</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="operator">&gt;</span> <span class="number">85</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------+</span><br><span class="line">| cno   |</span><br><span class="line">+-------+</span><br><span class="line">| 3-245 |</span><br><span class="line">| 3-105 |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure>

<h4 id="25-显示“计算机系”老师所教课程的成绩表。"><a href="#25-显示“计算机系”老师所教课程的成绩表。" class="headerlink" title="25. 显示“计算机系”老师所教课程的成绩表。"></a>25. 显示“计算机系”老师所教课程的成绩表。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cno <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> tno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> tno <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> depart <span class="operator">=</span> <span class="string">&#x27;计算机系&#x27;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-----+-------+--------+</span><br><span class="line">| sno | cno   | degree |</span><br><span class="line">+-----+-------+--------+</span><br><span class="line">| 108 | 3-105 |     78 |</span><br><span class="line">| 105 | 3-105 |     88 |</span><br><span class="line">| 105 | 3-245 |     75 |</span><br><span class="line">| 107 | 3-105 |     91 |</span><br><span class="line">| 101 | 3-105 |     64 |</span><br><span class="line">| 109 | 3-105 |     76 |</span><br><span class="line">| 109 | 3-245 |     68 |</span><br><span class="line">| 103 | 3-105 |     92 |</span><br><span class="line">| 103 | 3-245 |     86 |</span><br><span class="line">+-----+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="26-显示“计算机系”和“电子工程系”不同职称的老师的tname和prof。"><a href="#26-显示“计算机系”和“电子工程系”不同职称的老师的tname和prof。" class="headerlink" title="26. 显示“计算机系”和“电子工程系”不同职称的老师的tname和prof。"></a>26. 显示“计算机系”和“电子工程系”不同职称的老师的tname和prof。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname, prof</span><br><span class="line"><span class="keyword">FROM</span> teacher</span><br><span class="line"><span class="keyword">WHERE</span> depart <span class="keyword">IN</span> (<span class="string">&#x27;计算机系&#x27;</span>, <span class="string">&#x27;电子工程系&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> tname, prof;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------+--------+</span><br><span class="line">| tname | prof   |</span><br><span class="line">+-------+--------+</span><br><span class="line">| 李诚  | 副教授 |</span><br><span class="line">| 李旭  | 讲师   |</span><br><span class="line">| 王萍  | 助教   |</span><br><span class="line">| 刘冰  | 助教   |</span><br><span class="line">+-------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="27-显示选修编号为“3-105”课程且成绩至少高于“3-245”课程的同学的cno、sno和degree，并按degree从高到低次序排列。"><a href="#27-显示选修编号为“3-105”课程且成绩至少高于“3-245”课程的同学的cno、sno和degree，并按degree从高到低次序排列。" class="headerlink" title="27. 显示选修编号为“3-105”课程且成绩至少高于“3-245”课程的同学的cno、sno和degree，并按degree从高到低次序排列。"></a>27. 显示选修编号为“3-105”课程且成绩至少高于“3-245”课程的同学的cno、sno和degree，并按degree从高到低次序排列。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> score.cno, score.sno, score.degree</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span> <span class="keyword">AND</span> degree <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> cno <span class="operator">=</span> <span class="string">&#x27;3-245&#x27;</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> degree <span class="keyword">DESC</span>; </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----+--------+</span><br><span class="line">| cno   | sno | degree |</span><br><span class="line">+-------+-----+--------+</span><br><span class="line">| 3-105 | 103 |     92 |</span><br><span class="line">| 3-105 | 107 |     91 |</span><br><span class="line">| 3-105 | 105 |     88 |</span><br><span class="line">| 3-105 | 108 |     78 |</span><br><span class="line">| 3-105 | 109 |     76 |</span><br><span class="line">+-------+-----+--------+</span><br></pre></td></tr></table></figure>

<h4 id="28-显示选修编号为“3-105”课程且成绩高于“3-245”课程的同学的cno、sno和degree。"><a href="#28-显示选修编号为“3-105”课程且成绩高于“3-245”课程的同学的cno、sno和degree。" class="headerlink" title="28. 显示选修编号为“3-105”课程且成绩高于“3-245”课程的同学的cno、sno和degree。"></a>28. 显示选修编号为“3-105”课程且成绩高于“3-245”课程的同学的cno、sno和degree。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> score.cno, score.sno, score.degree</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span> <span class="keyword">AND</span> degree <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> cno <span class="operator">=</span> <span class="string">&#x27;3-245&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------+-----+--------+</span><br><span class="line">| cno   | sno | degree |</span><br><span class="line">+-------+-----+--------+</span><br><span class="line">| 3-105 | 103 |     92 |</span><br><span class="line">| 3-105 | 105 |     88 |</span><br><span class="line">| 3-105 | 107 |     91 |</span><br><span class="line">+-------+-----+--------+</span><br></pre></td></tr></table></figure>

<h4 id="29-列出所有任课老师的-tname-和-depart。"><a href="#29-列出所有任课老师的-tname-和-depart。" class="headerlink" title="29. 列出所有任课老师的 tname 和 depart。"></a>29. 列出所有任课老师的 tname 和 depart。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname, depart</span><br><span class="line"><span class="keyword">FROM</span> teacher</span><br><span class="line"><span class="keyword">WHERE</span> tno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> tno <span class="keyword">FROM</span> course);</span><br></pre></td></tr></table></figure>

<h4 id="30-列出所有未讲课老师的-tname-和-depart。"><a href="#30-列出所有未讲课老师的-tname-和-depart。" class="headerlink" title="30. 列出所有未讲课老师的 tname 和 depart。"></a>30. 列出所有未讲课老师的 tname 和 depart。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname, depart</span><br><span class="line"><span class="keyword">FROM</span> teacher</span><br><span class="line"><span class="keyword">WHERE</span> tno <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> tno <span class="keyword">FROM</span> course);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------+------------+</span><br><span class="line">| tname | depart     |</span><br><span class="line">+-------+------------+</span><br><span class="line">| 刘冰  | 电子工程系 |</span><br><span class="line">+-------+------------+</span><br></pre></td></tr></table></figure>

<h4 id="31-列出所有老师和同学的姓名、性别和生日。"><a href="#31-列出所有老师和同学的姓名、性别和生日。" class="headerlink" title="31. 列出所有老师和同学的姓名、性别和生日。(*)"></a>31. 列出所有老师和同学的姓名、性别和生日。(*)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname <span class="keyword">AS</span> name, sex, birthday</span><br><span class="line"><span class="keyword">FROM</span> teacher</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> sname <span class="keyword">AS</span> name, sex, birthday</span><br><span class="line"><span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+------+-----+------------+</span><br><span class="line">| name | sex | birthday   |</span><br><span class="line">+------+-----+------------+</span><br><span class="line">| 李诚 | 男  | 1958-12-02 |</span><br><span class="line">| 李旭 | 男  | 1969-03-12 |</span><br><span class="line">| 王萍 | 女  | 1972-05-05 |</span><br><span class="line">| 刘冰 | 女  | 1977-08-14 |</span><br><span class="line">| 曾华 | 男  | 1977-09-01 |</span><br><span class="line">| 匡明 | 男  | 1975-10-02 |</span><br><span class="line">| 王丽 | 女  | 1976-01-23 |</span><br><span class="line">| 李军 | 男  | 1976-02-20 |</span><br><span class="line">| 王芳 | 女  | 1975-02-10 |</span><br><span class="line">| 陆军 | 男  | 1974-06-03 |</span><br><span class="line">+------+-----+------------+</span><br></pre></td></tr></table></figure>

<h4 id="32-检索所学课程包含学生“103”所学课程的学生学号。"><a href="#32-检索所学课程包含学生“103”所学课程的学生学号。" class="headerlink" title="32. 检索所学课程包含学生“103”所学课程的学生学号。"></a>32. 检索所学课程包含学生“103”所学课程的学生学号。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sno</span><br><span class="line"><span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> cno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cno <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> sno <span class="operator">=</span> <span class="string">&#x27;103&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----+</span><br><span class="line">| sno |</span><br><span class="line">+-----+</span><br><span class="line">| 103 |</span><br><span class="line">| 105 |</span><br><span class="line">| 109 |</span><br><span class="line">| 101 |</span><br><span class="line">| 107 |</span><br><span class="line">| 108 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure>

<h4 id="33-检索选修所有课程的学生姓名。"><a href="#33-检索选修所有课程的学生姓名。" class="headerlink" title="33. 检索选修所有课程的学生姓名。(*)"></a>33. 检索选修所有课程的学生姓名。(*)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sname</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> cno</span><br><span class="line">    <span class="keyword">FROM</span> course</span><br><span class="line">    <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">        <span class="keyword">FROM</span> score</span><br><span class="line">        <span class="keyword">WHERE</span> student.sno <span class="operator">=</span> score.sno <span class="keyword">AND</span> course.cno <span class="operator">=</span> score.cno</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Empty set</span><br></pre></td></tr></table></figure>

<h2 id="实验项目三"><a href="#实验项目三" class="headerlink" title="实验项目三"></a>实验项目三</h2><h3 id="1-创建一个查询图书库存量的存储过程“cx-tskcl-proc”（如果是SQL-server数据库的话起这个名字，是其它数据库则按数据库的要求起名字，下面同），输出的内容包含类别号、图书编号、图书名称、库存数等数据内容。"><a href="#1-创建一个查询图书库存量的存储过程“cx-tskcl-proc”（如果是SQL-server数据库的话起这个名字，是其它数据库则按数据库的要求起名字，下面同），输出的内容包含类别号、图书编号、图书名称、库存数等数据内容。" class="headerlink" title="1.创建一个查询图书库存量的存储过程“cx_tskcl_proc”（如果是SQL server数据库的话起这个名字，是其它数据库则按数据库的要求起名字，下面同），输出的内容包含类别号、图书编号、图书名称、库存数等数据内容。"></a>1.创建一个查询图书库存量的存储过程“cx_tskcl_proc”（如果是SQL server数据库的话起这个名字，是其它数据库则按数据库的要求起名字，下面同），输出的内容包含类别号、图书编号、图书名称、库存数等数据内容。</h3><p>存储过程示例（MySQL）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> cx_tskcl_proc()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> 类别号, 图书编号, 图书名称, 库存数</span><br><span class="line">    <span class="keyword">FROM</span> 图书明细表;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h3 id="2-创建一个名为TS-CX-PROC的存储过程，它带有一个输入参数，用于接受图书编号，显示该图书的名称、作者、出版和复本数。"><a href="#2-创建一个名为TS-CX-PROC的存储过程，它带有一个输入参数，用于接受图书编号，显示该图书的名称、作者、出版和复本数。" class="headerlink" title="2.创建一个名为TS_CX_PROC的存储过程，它带有一个输入参数，用于接受图书编号，显示该图书的名称、作者、出版和复本数。"></a>2.创建一个名为TS_CX_PROC的存储过程，它带有一个输入参数，用于接受图书编号，显示该图书的名称、作者、出版和复本数。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> TS_CX_PROC (<span class="keyword">IN</span> book_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> 图书名称, 作者, 出版社, 复本数</span><br><span class="line">    <span class="keyword">FROM</span> 图书明细表</span><br><span class="line">    <span class="keyword">WHERE</span> 图书编号 <span class="operator">=</span> book_id;</span><br><span class="line"><span class="keyword">END</span> ;</span><br></pre></td></tr></table></figure>

<h3 id="3-修改存储修改TS-CX-PROC存储过程，使之能按图书名称查询图书的相关信息。"><a href="#3-修改存储修改TS-CX-PROC存储过程，使之能按图书名称查询图书的相关信息。" class="headerlink" title="3.修改存储修改TS_CX_PROC存储过程，使之能按图书名称查询图书的相关信息。"></a>3.修改存储修改TS_CX_PROC存储过程，使之能按图书名称查询图书的相关信息。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> TS_CX_PROC ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> TS_CX_PROC (<span class="keyword">IN</span> book_name <span class="type">VARCHAR</span>(<span class="number">255</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> 图书名称, 作者, 出版社, 复本数</span><br><span class="line">    <span class="keyword">FROM</span> 图书明细表</span><br><span class="line">    <span class="keyword">WHERE</span> 图书名称 <span class="operator">=</span> book_name;</span><br><span class="line"><span class="keyword">END</span> ;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询“航海英语”图书的信息</span></span><br><span class="line"><span class="keyword">CALL</span> TS_CX_PROC(<span class="string">&#x27;航海英语&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询“艺海潮音”图书的信息</span></span><br><span class="line"><span class="keyword">CALL</span> TS_CX_PROC(<span class="string">&#x27;艺海潮音&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------+--------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> 图书名称 <span class="operator">|</span> 作者   <span class="operator">|</span> 出版社             <span class="operator">|</span> 复本数 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------+--------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> 航海英语 <span class="operator">|</span> 陈宏权 <span class="operator">|</span> 武汉工业大学出版社 <span class="operator">|</span>     <span class="number">25</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------+--------------------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.05</span> sec)</span><br><span class="line"></span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------+----------------+--------+</span></span><br><span class="line"><span class="operator">|</span> 图书名称 <span class="operator">|</span> 作者 <span class="operator">|</span> 出版社         <span class="operator">|</span> 复本数 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------+----------------+--------+</span></span><br><span class="line"><span class="operator">|</span> 艺海潮音 <span class="operator">|</span> 李叔 <span class="operator">|</span> 江苏文艺出版社 <span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------+----------------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="4-删除存储过程"><a href="#4-删除存储过程" class="headerlink" title="4.删除存储过程"></a>4.删除存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> TS_CX_PROC;</span><br></pre></td></tr></table></figure>

<h3 id="5-图书类别表上创建一个名为tslb-insert-trigger的触发器，当执行INSERT操作时，该触发器被触发，禁止插入记录。"><a href="#5-图书类别表上创建一个名为tslb-insert-trigger的触发器，当执行INSERT操作时，该触发器被触发，禁止插入记录。" class="headerlink" title="5.图书类别表上创建一个名为tslb_insert_trigger的触发器，当执行INSERT操作时，该触发器被触发，禁止插入记录。"></a>5.图书类别表上创建一个名为tslb_insert_trigger的触发器，当执行INSERT操作时，该触发器被触发，禁止插入记录。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> tslb_insert_trigger</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> 图书类别表</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span></span><br><span class="line">    <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;插入记录被禁止&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-在图书明细表上创建一个名为ts-delete-trigger的触发器，当执行DELETE操作时，该触发器被触发，禁止删除记录。"><a href="#6-在图书明细表上创建一个名为ts-delete-trigger的触发器，当执行DELETE操作时，该触发器被触发，禁止删除记录。" class="headerlink" title="6.在图书明细表上创建一个名为ts_delete_trigger的触发器，当执行DELETE操作时，该触发器被触发，禁止删除记录。"></a>6.在图书明细表上创建一个名为ts_delete_trigger的触发器，当执行DELETE操作时，该触发器被触发，禁止删除记录。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> ts_delete_trigger</span><br><span class="line">BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> 图书明细表</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span></span><br><span class="line">    <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;删除记录被禁止&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> ;</span><br></pre></td></tr></table></figure>

<h3 id="7-在读者信息表上创建一个名为dzxx-insert-trigger的触发器，当在读者信息表中插入记录时，将该记录中的借书证号自动插入借还明细表中。"><a href="#7-在读者信息表上创建一个名为dzxx-insert-trigger的触发器，当在读者信息表中插入记录时，将该记录中的借书证号自动插入借还明细表中。" class="headerlink" title="7.在读者信息表上创建一个名为dzxx_insert_trigger的触发器，当在读者信息表中插入记录时，将该记录中的借书证号自动插入借还明细表中。"></a>7.在读者信息表上创建一个名为dzxx_insert_trigger的触发器，当在读者信息表中插入记录时，将该记录中的借书证号自动插入借还明细表中。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> dzxx_insert_trigger</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> 读者信息表</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> 借还明细表 (借书证号)</span><br><span class="line">    <span class="keyword">VALUES</span> (NEW.借书证号);</span><br><span class="line"><span class="keyword">END</span> ;</span><br></pre></td></tr></table></figure>

<h3 id="8-删除触发器"><a href="#8-删除触发器" class="headerlink" title="8.删除触发器"></a>8.删除触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> dzxx_insert_trigger;</span><br></pre></td></tr></table></figure>

<h2 id="实验项目四"><a href="#实验项目四" class="headerlink" title="实验项目四"></a>实验项目四</h2><h3 id="数据库设计报告：教材管理系统"><a href="#数据库设计报告：教材管理系统" class="headerlink" title="数据库设计报告：教材管理系统"></a>数据库设计报告：教材管理系统</h3><h4 id="系统需求分析报告"><a href="#系统需求分析报告" class="headerlink" title="系统需求分析报告"></a>系统需求分析报告</h4><p><strong>项目名称：教材管理系统</strong></p>
<p><strong>项目背景：</strong> 教材管理系统旨在帮助学校或教育机构管理教材的信息，包括教材的库存、借阅、归还等操作，以提高教材管理的效率和准确性。</p>
<p><strong>功能需求：</strong></p>
<ol>
<li>教材信息维护：包括教材信息的添加、修改、删除等操作。</li>
<li>学生信息维护：包括学生信息的添加、修改、删除等操作。</li>
<li>借阅管理：记录学生借阅教材的信息，包括借阅日期、归还日期等。</li>
<li>教材库存管理：跟踪教材的库存数量，及时更新库存信息。</li>
</ol>
<p><strong>非功能需求：</strong></p>
<ol>
<li>界面简洁清晰，易于操作。</li>
<li>数据安全性和保密性。</li>
<li>高效的数据查询和管理功能。</li>
</ol>
<h4 id="2-概念模型的设计（E-R图）"><a href="#2-概念模型的设计（E-R图）" class="headerlink" title="2. 概念模型的设计（E-R图）"></a>2. 概念模型的设计（E-R图）</h4><p>在概念模型设计中，我们定义以下实体和它们之间的关系：</p>
<ul>
<li><p>实体：教材、学生、借阅记录、教材库存</p>
</li>
<li><p>属性：每个实体的属性，如教材的编号、名称等，学生的学号、姓名等</p>
</li>
<li><p><img src="/2025/04/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C/B987B0639EA31FA3AB372B72C941534A.png"></p>
</li>
</ul>
<p>在这个E-R图中：</p>
<ul>
<li>学生（Student）和教材（Textbook）之间是多对多的关系，用关联实体借阅记录（BorrowRecord）表示。</li>
<li>教材（Textbook）和教材库存（Inventory）是一对多的关系，即一个教材可以有多本库存。</li>
<li>借阅记录（BorrowRecord）包含了学生借阅教材的信息，如借阅日期、归还日期等。</li>
</ul>
<h4 id="3-关系数据模型的设计"><a href="#3-关系数据模型的设计" class="headerlink" title="3. 关系数据模型的设计"></a>3. 关系数据模型的设计</h4><ul>
<li>学生表（学生学号,姓名,性别）</li>
<li>教材表（编号,教材名,作者，出版日期，出版社）</li>
<li>借阅记录表（借阅日期,归还日期，学生学号，教材编号）</li>
<li>教材库存表（教材编号，数量，位置）</li>
</ul>
<h3 id="图书馆日常事务管理系统数据库设计"><a href="#图书馆日常事务管理系统数据库设计" class="headerlink" title="图书馆日常事务管理系统数据库设计"></a>图书馆日常事务管理系统数据库设计</h3><h4 id="（1）图书馆日常事务管理系统功能简析"><a href="#（1）图书馆日常事务管理系统功能简析" class="headerlink" title="（1）图书馆日常事务管理系统功能简析"></a>（1）图书馆日常事务管理系统功能简析</h4><ul>
<li>图书信息维护：主要完成图书信息登记、修改、删除等操作。</li>
<li>读者信息维护：主要完成读者信息的添加、修改和删除等操作。</li>
<li>工作人员信息维护：主要完成工作人员信息的添加、修改和删除等操作。</li>
<li>图书类别的管理：主要完成图书类别的添加、修改和删除等操作</li>
<li>图书借还管理：主要完成读者图书借还信息的记录。</li>
</ul>
<h4 id="（2）图书馆日常事务管理系统中的实体和属性的设计"><a href="#（2）图书馆日常事务管理系统中的实体和属性的设计" class="headerlink" title="（2）图书馆日常事务管理系统中的实体和属性的设计"></a>（2）图书馆日常事务管理系统中的实体和属性的设计</h4><ul>
<li><p>读者（借书证号，姓名，性别，出生日期，借书量，单位，电话，E-mail）</p>
</li>
<li><p>图书（图书编号，图书名称，作者，出版社，定价，购进日期，购入数，复本数，库存数）</p>
</li>
<li><p>工作人员（工号，姓名，性别，出生日期，联系电话，E-mail）</p>
</li>
<li><p>图书类别（类别号，图书类别）</p>
</li>
</ul>
<p>其中，每本图书都有惟一的一个图书类别，每个图书类别有多本图书；每个读者可以借阅多本图书；工作人员负责读者的借、还工作。</p>
<h4 id="（3）设计该系统数据库的E-R图"><a href="#（3）设计该系统数据库的E-R图" class="headerlink" title="（3）设计该系统数据库的E-R图"></a>（3）设计该系统数据库的E-R图</h4><p><img src="/2025/04/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C/img.png" alt="img"></p>
<h4 id="（4）将设计好的E-R图转换为关系模式"><a href="#（4）将设计好的E-R图转换为关系模式" class="headerlink" title="（4）将设计好的E-R图转换为关系模式"></a>（4）将设计好的E-R图转换为关系模式</h4><ul>
<li>读者（借书证号，姓名，性别，出生日期，借书量，单位，电话，E-mail）</li>
<li>图书（图书编号，图书名称，作者，出版社，定价，购进日期，购入数，复本数，库存数）</li>
<li>工作人员（工号，姓名，性别，出生日期，联系电话，E-mail）</li>
<li>图书类别（类别号，图书类别）</li>
<li>图书借阅（图书编号，借书证号，借出日期，归还日期）</li>
<li>图书借还（图书编号，工号，借还，数量，借书日期，还书日期）</li>
</ul>
<h4 id="（5-对设计好的关系模式进行规范化的处理"><a href="#（5-对设计好的关系模式进行规范化的处理" class="headerlink" title="（5)对设计好的关系模式进行规范化的处理"></a>（5)对设计好的关系模式进行规范化的处理</h4><p>上述的关系模式已经符合第三范式，在这里不需要进行规范化处理。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/06/%E6%88%91%E7%9A%84%E7%94%B5%E8%84%91%E7%9A%84%E7%A3%81%E7%9B%98%E8%AE%BE%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/06/%E6%88%91%E7%9A%84%E7%94%B5%E8%84%91%E7%9A%84%E7%A3%81%E7%9B%98%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">我的电脑的磁盘设置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-06 11:10:07 / 修改时间：11:12:56" itemprop="dateCreated datePublished" datetime="2025-04-06T11:10:07+08:00">2025-04-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>G盘(存储github上的代码和博客网站)：code代码盘，blog博客盘</p>
<p>F盘：installation文件夹存放软件安装包，app文件夹存放软件，image文件夹放镜像文件</p>
<p>D盘：中转站</p>
<p>C盘：系统文件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">操作系统与安全笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-06 10:31:38" itemprop="dateCreated datePublished" datetime="2025-04-06T10:31:38+08:00">2025-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-08 13:18:51" itemprop="dateModified" datetime="2025-04-08T13:18:51+08:00">2025-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8A%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">操作系统及安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          正在努力编辑中...
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/04/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyaxiao.github.io/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wuyaxiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学习小屋">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/" class="post-title-link" itemprop="url">Hexo Next 主题配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-06 10:18:39" itemprop="dateCreated datePublished" datetime="2025-04-06T10:18:39+08:00">2025-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-08 13:31:12" itemprop="dateModified" datetime="2025-04-08T13:31:12+08:00">2025-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">使用指南</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul>
<li>站点配置文件: <code>/your-hexo-blog/config.yml</code></li>
<li>Next 主题配置文件: <code>/your-hexo-blog/themes/next/_config.yml</code></li>
<li><a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/getting-started.html">Next 官方教程 - 开始使用</a></li>
<li><a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/theme-settings.html">Next 官方教程 - 主题配置</a></li>
<li><a target="_blank" rel="noopener" href="http://theme-next.iissnan.com/faqs.html">Next 官方教程 - 常见问题</a></li>
<li><a target="_blank" rel="noopener" href="https://www.techgrow.cn/posts/755ff30d.html">其它配置博文</a></li>
</ul>
<h2 id="Hexo基本操作"><a href="#Hexo基本操作" class="headerlink" title="Hexo基本操作"></a>Hexo基本操作</h2><p>创建博客：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo n</span><br></pre></td></tr></table></figure>

<p>编辑完毕后，您需要重新生成您的Hexo站点。运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean  </span><br><span class="line">hexo generate  </span><br></pre></td></tr></table></figure>

<p>然后可以使用下面的命令启动本地服务器查看效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server  </span><br></pre></td></tr></table></figure>

<p>打包上传文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<p>在本地运行代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo s -g</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure>

<h2 id="设置分类和标签"><a href="#设置分类和标签" class="headerlink" title="设置分类和标签"></a>设置分类和标签</h2><h3 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h3><p>在 Next 主题下找到hex-theme-next_config.yml 这个路径的配置文件,然后打开这个文件并修改代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || fa fa-home</span><br><span class="line">  # about: /about/ || fa fa-user</span><br><span class="line">  tags: /tags/ || fa fa-tags # 取消注释，开启标签</span><br><span class="line">  categories: /categories/ || fa fa-th # 取消注释，开启分类</span><br><span class="line">  archives: /archives/ || fa fa-archive</span><br><span class="line">  # schedule: /schedule/ || fa fa-calendar</span><br><span class="line">  # sitemap: /sitemap.xml || fa fa-sitemap</span><br><span class="line">  # commonweal: /404/ || fa fa-heartbeat</span><br></pre></td></tr></table></figure>

<h3 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h3><h4 id="创建标签文件"><a href="#创建标签文件" class="headerlink" title="创建标签文件"></a>创建标签文件</h4><p>在博客项目所在文件夹下执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>

<p>成功后会提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/blog/source/tags/index.md</span><br></pre></td></tr></table></figure>

<p>根据成功后到提示路径打开<code>index.md</code>这个页面文件并增加一行<code>type: &quot;tags&quot;</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">title: tags</span><br><span class="line">date: 2025-04-06 08:16:29</span><br><span class="line">type: &quot;tags&quot;</span><br></pre></td></tr></table></figure>

<h4 id="创建分类文件"><a href="#创建分类文件" class="headerlink" title="创建分类文件"></a>创建分类文件</h4><p>在博客项目所在文件夹下执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br></pre></td></tr></table></figure>

<p>成功后会提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/blog/source/categories/index.md</span><br></pre></td></tr></table></figure>

<p>根据成功后到提示路径打开<code>index.md</code>这个页面文件并增加一行<code>type: &quot;categories&quot;</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">title: categories</span><br><span class="line">date: 2025-04-06 08:10:09</span><br><span class="line">type: &quot;categories&quot;</span><br></pre></td></tr></table></figure>

<h2 id="添加动态背景"><a href="#添加动态背景" class="headerlink" title="添加动态背景"></a>添加动态背景</h2><p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/20230825-1dd7a39c-1743905946665-1.gif" alt="img"></p>
<p>由于<a target="_blank" rel="noopener" href="https://theme-next.js.org/next-8-0-0-rc-2-released/?highlight=canvas+nest#%F0%9F%8C%80-External-Changes">NexT 8.0.0-rc.2</a>移除了<code>canvas-nest</code>集成，所以我们要自行创建文件，根据官网的操作来就可以了。</p>
<p>在<code>your-hexo-blog/source/_data</code>目录下新建文件<code>footer.swig</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script color=&quot;0,0,255&quot; opacity=&quot;0.5&quot; zIndex=&quot;-1&quot; count=&quot;99&quot; src=&quot;https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>修改站点配置文件，配置<code>footer</code>路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">解释# Define custom file paths.</span><br><span class="line"># Create your custom files in site directory `source/_data` and uncomment needed files below.</span><br><span class="line">custom_file_path:</span><br><span class="line">  #head: source/_data/head.swig</span><br><span class="line">  #header: source/_data/header.swig</span><br><span class="line">  #sidebar: source/_data/sidebar.swig</span><br><span class="line">  #postMeta: source/_data/post-meta.swig</span><br><span class="line">  #postBodyEnd: source/_data/post-body-end.swig</span><br><span class="line">  footer: source/_data/footer.swig</span><br><span class="line">  #bodyEnd: source/_data/body-end.swig</span><br><span class="line">  #variable: source/_data/variables.styl</span><br><span class="line">  #mixin: source/_data/mixins.styl</span><br><span class="line">  #style: source/_data/styles.styl</span><br></pre></td></tr></table></figure>

<h2 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h2><h3 id="站点配置"><a href="#站点配置" class="headerlink" title="站点配置"></a>站点配置</h3><p>将站点配置中的post_asset_folder设为true</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="typora中的图像保存位置设置"><a href="#typora中的图像保存位置设置" class="headerlink" title="typora中的图像保存位置设置"></a>typora中的图像保存位置设置</h3><p>点开文件——&gt;偏好设置，设置如下：</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/993af5c7afec466eaec981af9ac662edtplv-k3u1fbpfcp-jj-mark3024000q75.webp" alt="image-20230831180845755.png"></p>
<h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><p>在根目录下打开git bash，然后运行以下命令中的一个（我在网上查资料的时候发现这两个命令其中有一个可能实现不了，具体是哪个要看环境）</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install https:<span class="comment">//github.com/xcodebuild/hexo-asset-image.git</span></span><br><span class="line">npm install hexo-asset-image -- save</span><br></pre></td></tr></table></figure>

<p>Note：由于本身Hexo带有缓存会导致插件第一次使用可能会出现无效果，请使用<code>hexo clean</code>清除缓存后即可正常使用；</p>
<h2 id="设置博文目录"><a href="#设置博文目录" class="headerlink" title="设置博文目录"></a>设置博文目录</h2><p>Hexo 的 Next 主题是可以自动展开文章目录的，其在默认情况下并未开启，需要手动开启。</p>
<h3 id="1-修改主题配置文件-config-yml"><a href="#1-修改主题配置文件-config-yml" class="headerlink" title="1.修改主题配置文件 _config.yml"></a>1.修改主题配置文件 _config.yml</h3><p>打开 next 主题的 <code>_config.yml</code> 文件，搜索 <code>custom_file_path</code>，可以看到如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">custom_file_path:</span><br><span class="line">  #head: source/_data/head.swig</span><br><span class="line">  #header: source/_data/header.swig</span><br><span class="line">  #sidebar: source/_data/sidebar.swig</span><br><span class="line">  #postMeta: source/_data/post-meta.swig</span><br><span class="line">  #postBodyEnd: source/_data/post-body-end.swig</span><br><span class="line">  #footer: source/_data/footer.swig</span><br><span class="line">  #bodyEnd: source/_data/body-end.swig</span><br><span class="line">  #variable: source/_data/variables.styl</span><br><span class="line">  #mixin: source/_data/mixins.styl</span><br><span class="line">  #style: source/_data/styles.styl</span><br></pre></td></tr></table></figure>

<p>修改 <code>style</code> 属性，即取消相应注释</p>
<h3 id="2-创建-data-文件夹并添加-styles-styl-文件"><a href="#2-创建-data-文件夹并添加-styles-styl-文件" class="headerlink" title="2.创建 _data 文件夹并添加 styles.styl 文件"></a>2.创建 _data 文件夹并添加 styles.styl 文件</h3><p>找到博客所在的根目录下的 <code>source</code> 文件夹，也之后，创建 <code>_data/styles.styl</code> 文件</p>
<h3 id="3-修改-styles-styl-文件"><a href="#3-修改-styles-styl-文件" class="headerlink" title="3.修改 styles.styl 文件"></a>3.修改 styles.styl 文件</h3><p>在文件中添加如下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//文章目录默认展开</span><br><span class="line">.post-toc .nav .nav-child &#123; </span><br><span class="line">    display: block; </span><br><span class="line">&#125;</span><br><span class="line">//文章目录字体大小调整</span><br><span class="line">.post-toc ol &#123;  </span><br><span class="line">    font-size : 13px;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-修改主题配置文件"><a href="#4-修改主题配置文件" class="headerlink" title="4.修改主题配置文件"></a>4.修改主题配置文件</h3><p>最后，修改主题配置文件 </p>
<p>搜索 <code>toc</code> 配置项，进行以下更改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 文章目录</span><br><span class="line">toc:</span><br><span class="line">  # 开启文章目录</span><br><span class="line">  enable: true</span><br><span class="line"></span><br><span class="line">  # 自动将列表编号添加到 toc</span><br><span class="line">  number: true</span><br><span class="line"></span><br><span class="line">  # 当设为 true 时，如果标题宽度大于侧边栏宽度，则将文字放在下一行</span><br><span class="line">  wrap: true</span><br></pre></td></tr></table></figure>

<h2 id="开启搜索功能"><a href="#开启搜索功能" class="headerlink" title="开启搜索功能"></a>开启搜索功能</h2><h3 id="安装相关插件"><a href="#安装相关插件" class="headerlink" title="安装相关插件"></a>安装相关插件</h3><p>在博客根目录下执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<h3 id="配置博客"><a href="#配置博客" class="headerlink" title="配置博客"></a>配置博客</h3><p>编写站点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure>

<h3 id="配置主题"><a href="#配置主题" class="headerlink" title="配置主题"></a>配置主题</h3><p>编写主题配置文件</p>
<p>找到文件中 Local search 的相关配置，设为 <code>true</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Local search</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure>

<h2 id="增加阅读统计-不蒜子统计"><a href="#增加阅读统计-不蒜子统计" class="headerlink" title="增加阅读统计(不蒜子统计)"></a>增加阅读统计(不蒜子统计)</h2><p>更改 Next 主题的配置文件 <code>themes/next/_config.yml</code>，设置以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">busuanzi_count:</span><br><span class="line">  enable: true</span><br><span class="line">  total_visitors: true</span><br><span class="line">  total_visitors_icon: fa fa-user</span><br><span class="line">  total_views: true</span><br><span class="line">  total_views_icon: fa fa-eye</span><br><span class="line">  post_views: true</span><br><span class="line">  post_views_icon: fa fa-eye</span><br></pre></td></tr></table></figure>

<h2 id="增加评论功能-utterances"><a href="#增加评论功能-utterances" class="headerlink" title="增加评论功能(utterances)"></a>增加评论功能(utterances)</h2><ol>
<li><p>首先保证自己的博客是 public 仓库，以便于存储评论数据。</p>
</li>
<li><p>安装 Utterances 申请 GitHub App<br>打开 <a target="_blank" rel="noopener" href="https://utteranc.es/">utterances</a> - <a target="_blank" rel="noopener" href="https://github.com/apps/utterances">GitHub App</a> 点击 Configure 进入安装页面。</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250407155226746.png" alt="image-20250407155226746"></p>
<p>选择对应的博客仓库</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250407155426041.png" alt="image-20250407155426041"></p>
<p>在打开的页面中选择 Only select repositories，并在下拉框中选择自己的博客仓库（比如我就是 wuyaxiao&#x2F;wuyaxiao.github.io，也可以安装到其他仓库），然后点击 Install。</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250407155618022.png" alt="image-20250407155618022"></p>
<p>不过utterances没有集成在NexT主题中，需要手动添加。</p>
<p>打开主题文件夹，在<code>layout/_third-party/comments/</code>中新建文件<code>utterances.swig</code>，并添加下面的内容：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme<span class="selector-class">.utterances</span><span class="selector-class">.enable</span> %&#125;</span><br><span class="line">  &lt;script <span class="attribute">src</span>=&quot;https://utteranc.es/client.js<span class="string">&quot;</span></span><br><span class="line"><span class="string">    repo=&quot;</span>&#123;&#123; theme<span class="selector-class">.utterances</span><span class="selector-class">.repo</span> &#125;&#125;&quot;</span><br><span class="line">    issue-term=&quot;&#123;&#123; theme<span class="selector-class">.utterances</span><span class="selector-class">.issue_term</span> &#125;&#125;&quot;</span><br><span class="line">    theme=&quot;&#123;&#123; theme<span class="selector-class">.utterances</span><span class="selector-class">.theme</span> &#125;&#125;&quot;</span><br><span class="line">    crossorigin=&quot;anonymous&quot;</span><br><span class="line">    async&gt;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>然后在<code>layout/_partials/comments.swig</code>中<code>script</code>标签前添加下面的内容：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme<span class="selector-class">.valine</span><span class="selector-class">.enable</span> and theme<span class="selector-class">.valine</span><span class="selector-class">.appid</span> and theme<span class="selector-class">.valine</span><span class="selector-class">.appkey</span> %&#125;  </span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;comments&quot; id=&quot;comments&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;  </span><br><span class="line">&#123;% elif theme<span class="selector-class">.utterances</span><span class="selector-class">.enable</span> %&#125; </span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;comments&quot; id=&quot;comments&quot;&gt;  </span><br><span class="line">    &#123;% include &#x27;../_third-party/comments/utterances<span class="selector-class">.swig</span>&#x27; %&#125;  </span><br><span class="line">  &lt;/<span class="selector-tag">div</span>&gt;  </span><br><span class="line">&#123;% endif %&#125;  </span><br></pre></td></tr></table></figure>

<p>最后在主题配置文件中添加如下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">utterances:  </span><br><span class="line">  enable: true  </span><br><span class="line">  repo: &quot;wuyaxiao/wuyaxiao.github.io&quot;                     # github用户名/仓库名  </span><br><span class="line">  issue_term: &quot;title&quot;                    # 可以根据需求选择其他值  </span><br><span class="line">  theme: &quot;github-light&quot;                     # 设置主题，也可以设置为github-dark</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于issue_term的选择可以查看<a target="_blank" rel="noopener" href="https://utteranc.es/">官网</a></p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250407161852343.png" alt="image-20250407161852343"></p>
<p>然后就可以在下面查看对应的issue_term</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250407161953259.png" alt="image-20250407161953259"></p>
</blockquote>
<p>Note:如果Uttenrances的重定向网址不对可以检查一下站点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># URL</span><br><span class="line">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span><br><span class="line">url: https://wuyaxiao.github.io #这个位置是重定向网址，不要写错了</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br><span class="line">pretty_urls:</span><br><span class="line">  trailing_index: true # Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span><br><span class="line">  trailing_html: true # Set to false to remove tgithub.iorailing &#x27;.html&#x27; from permalinks</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="启用图片点击居中预览"><a href="#启用图片点击居中预览" class="headerlink" title="启用图片点击居中预览"></a>启用图片点击居中预览</h2><p>更改 Next 主题的配置文件，设置以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mediumzoom: true</span><br></pre></td></tr></table></figure>

<h2 id="代码块高亮样式"><a href="#代码块高亮样式" class="headerlink" title="代码块高亮样式"></a>代码块高亮样式</h2><p>更改 Next 主题的配置文件 <code>themes/next/_config.yml</code>，设置以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">codeblock:</span><br><span class="line">  highlight_theme: &#x27;night eighties&#x27;           # 代码高亮可选样式: normal | night | night eighties | night blue | night bright | solarized | solarized dark | galactic</span><br><span class="line">  copy_button:</span><br><span class="line">    enable: true                    # 启用代码复制按钮</span><br><span class="line">    show_result: false              # 显示代码复制结果</span><br><span class="line">    style: flat                     # 代码块可选样式: default | flat | mac</span><br></pre></td></tr></table></figure>

<h2 id="启用文章打赏"><a href="#启用文章打赏" class="headerlink" title="启用文章打赏"></a>启用文章打赏</h2><p>更改 Next 主题的配置文件，设置以下内容，需要将收款二维码图片放到 <code>themes/next/source/images</code> 文件夹下，或者使用自定义的图片目录路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">reward_settings:</span><br><span class="line">  enable: true</span><br><span class="line">  animation: false</span><br><span class="line"></span><br><span class="line">reward:</span><br><span class="line">  wechatpay: /images/wechatpay.jpg</span><br><span class="line">  alipay: /images/alipay.jpg</span><br></pre></td></tr></table></figure>

<h2 id="隐藏网页底部powered-By-Hexo-强力驱动"><a href="#隐藏网页底部powered-By-Hexo-强力驱动" class="headerlink" title="隐藏网页底部powered By Hexo &#x2F; 强力驱动"></a>隐藏网页底部powered By Hexo &#x2F; 强力驱动</h2><p>找到&#x2F;Blog&#x2F;themes&#x2F;next&#x2F;_config.yml，设置powered为false即可！</p>
<h2 id="自定义主页配置方法"><a href="#自定义主页配置方法" class="headerlink" title="自定义主页配置方法"></a>自定义主页配置方法</h2><p><strong>1.在根目录的<code>source</code>目录下，新建一个<code>index.md</code>文档</strong><br>在根目录的<code>source</code>目录下，新建一个名为<code>index.md</code>文档，这个<code>source</code>目录下的<code>index.md</code>文档即是我们自定义的主页。在文档中做出的任何修改均会体现在自定义主页中。</p>
<p><strong>2.修改站点配置文件中的<code>index_generator</code>项</strong><br>打开根目录下的<code>_config.yml</code>文件，将<code>index_generator</code>项下的<code>path</code>项的值修改为一个无效值，例如：我将这一项修改为了<code>default-index</code>。目的是使Hexo框架的默认主页指向一个无效值。</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250408004707918.png" alt="image-20250408004707918"></p>
<p><strong>3.修改NexT主题的<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=169631928&content_type=Article&match_order=1&q=%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6&zhida_source=entity">配置文件</a>（<code>themes/next/_config.yml</code>文件）的<code>Home</code>菜单指向的链接</strong><br>打开<code>themes/next/</code>目录下的<code>_config.yml</code>文件，将<code>menu</code>项下的<code>home</code>项的值修改为<code>/ || fa fa-home</code>。使得点击页面中的Home菜单时，可以返回自定义主页。</p>
<p><img src="/2025/04/06/hexo%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-%E5%9C%A8Next%E4%B8%BB%E9%A2%98%E4%B8%8B/image-20250408004642710.png" alt="image-20250408004642710"></p>
<h2 id="加密文章"><a href="#加密文章" class="headerlink" title="加密文章"></a>加密文章</h2><p>安装 hexo-blog-encrypt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-blog-encrypt</span><br></pre></td></tr></table></figure>

<p>修改站点配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">encrypt: # hexo-blog-encrypt</span><br><span class="line">  abstract: This article is encrypted!</span><br><span class="line">  message: This article is encrypted!</span><br><span class="line">  tags:</span><br><span class="line">  - &#123;name: tagName, password: passwordA&#125;</span><br><span class="line">  - &#123;name: tagName, password: passwordB&#125;</span><br><span class="line">  template: &lt;div id=&quot;hexo-blog-encrypt&quot; data-wpm=&quot;&#123;&#123;hbeWrongPassMessage&#125;&#125;&quot; data-whm=&quot;&#123;&#123;hbeWrongHashMessage&#125;&#125;&quot;&gt;&lt;div class=&quot;hbe-input-container&quot;&gt;&lt;input type=&quot;password&quot; id=&quot;hbePass&quot; placeholder=&quot;&#123;&#123;hbeMessage&#125;&#125;&quot; /&gt;&lt;label&gt;&#123;&#123;hbeMessage&#125;&#125;&lt;/label&gt;&lt;div class=&quot;bottom-line&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;script id=&quot;hbeData&quot; type=&quot;hbeData&quot; data-hmacdigest=&quot;&#123;&#123;hbeHmacDigest&#125;&#125;&quot;&gt;&#123;&#123;hbeEncryptedData&#125;&#125;&lt;/script&gt;&lt;/div&gt;</span><br><span class="line">  wrong_pass_message: Sorry,wrong password!</span><br><span class="line">  wrong_hash_message: Sorry,wrong hash!</span><br></pre></td></tr></table></figure>

<p>需要使用密码的时候,在文章头部信息加入这个配置即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password: password</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
            

  <!-- 应使用 elif 而不是 else if -->  
  <div class="comments" id="comments">  
    
  <script src="https://utteranc.es/client.js"
    repo="wuyaxiao/wuyaxiao.github.io"
    issue-term="title"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
  
  </div>  
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">wuyaxiao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="fa fa-user">
  </span>
  <span class="author" itemprop="copyrightHolder">wuyaxiao</span>
</div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
